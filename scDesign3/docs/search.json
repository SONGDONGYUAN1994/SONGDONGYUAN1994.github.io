[{"path":"/articles/scDesign3-CITEseq-vignette.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Simulate CITE-seq data","text":"tutorial, show use scDesign3 simulate CITE-seq data illustrate similarity inputted reference data synthetic data.","code":""},{"path":"/articles/scDesign3-CITEseq-vignette.html","id":"read-in-the-reference-data","dir":"Articles","previous_headings":"","what":"Read in the reference data","title":"Simulate CITE-seq data","text":"save computational time, use top 100 genes six genes protein RNA abundance information.","code":"example_sce <- readRDS((url(\"https://figshare.com/ndownloader/files/40581968\"))) print(example_sce) keep_gene <- c(\"CD4\",  \"CD14\", \"CD19\", \"CD34\", \"CD3E\", \"CD8A\") keep_adt <- c(\"ADT_CD4\", \"ADT_CD14\", \"ADT_CD19\", \"ADT_CD34\", \"ADT_CD3\", \"ADT_CD8\") keep <- c(keep_gene, keep_adt) idx <- which(rownames(example_sce) %in% keep) idx <- c(1:100,idx) example_sce <- example_sce[idx,] logcounts(example_sce) <- log1p(counts(example_sce))"},{"path":"/articles/scDesign3-CITEseq-vignette.html","id":"simulation","dir":"Articles","previous_headings":"","what":"Simulation","title":"Simulate CITE-seq data","text":"input reference data use one-shot scdesign3() function simulate CITE-seq dat using discrete cell types covariates fitting gene’s marginal distribution. simulation, can create SinglecellExperiment object using synthetic count matrix store logcounts input synthetic SinglecellExperiment objects. , obtained PCA UMAP inputted reference data synthetic data. sets embedding used visualization .","code":"set.seed(123) example_simu <- scdesign3(     sce = example_sce,     assay_use = \"counts\",     celltype = \"cell_type\",     pseudotime = NULL,     spatial = NULL,     other_covariates = NULL,     mu_formula = \"cell_type\",     sigma_formula = \"cell_type\",     family_use = \"nb\",     n_cores = 2,     usebam = FALSE,     corr_formula = \"cell_type\",     copula = \"vine\",     DT = TRUE,     pseudo_obs = FALSE,     return_model = FALSE,     nonzerovar = TRUE,     nonnegative = TRUE   ) logcounts(example_sce) <- log1p(counts(example_sce)) simu_sce <- SingleCellExperiment(list(counts = example_simu$new_count), colData = example_simu$new_covariate) logcounts(simu_sce) <- log1p(counts(simu_sce)) set.seed(123)  train_pca_fit <- irlba::prcomp_irlba(t(log1p(counts(example_sce))),                                            center = TRUE,                                            scale. = FALSE,                                            n = 50) reducedDim(simu_sce, \"PCA\") <- predict(train_pca_fit, newdata= t(log1p(counts(simu_sce)))) simu_pac_fit <- predict(train_pca_fit, newdata= t(logcounts(simu_sce))) train_umap_fit <- umap::umap(train_pca_fit$x, n_neighbors = 15, min_dist = 0.1) simu_umap_fit <-  predict(object = train_umap_fit, data= (reducedDim(simu_sce, \"PCA\"))) colnames(simu_umap_fit ) <- c(\"UMAP1\", \"UMAP2\") reducedDim(simu_sce, \"UMAP\") <- simu_umap_fit  train_umap <- train_umap_fit$layout rownames(train_umap) <- colnames(example_sce) colnames(train_umap) <- c(\"UMAP1\", \"UMAP2\")"},{"path":"/articles/scDesign3-CITEseq-vignette.html","id":"visualization","dir":"Articles","previous_headings":"","what":"Visualization","title":"Simulate CITE-seq data","text":"visualize results, select six genes reformat UMAP embedding got previous step. Six genes’ protein RNA abundances shown cell UMAP embeddings inputted reference data synthetic data .","code":"expression_train <- as.matrix(logcounts(example_sce))[c(keep_gene ,keep_adt), ] %>% t()  %>% as_tibble() %>% bind_cols(train_umap) %>% dplyr::mutate(Method = \"Train data\") expression_scDesign3 <- as.matrix(logcounts(simu_sce))[c(keep_gene ,keep_adt), ] %>% t() %>% as_tibble() %>% bind_cols(simu_umap_fit) %>% dplyr::mutate(Method = \"scDesign3\") CITE_dat <- bind_rows(expression_train, expression_scDesign3) %>% as_tibble() %>%             dplyr::mutate_at(vars(-c(UMAP1, UMAP2, Method)), funs(scales::rescale)) %>% tidyr::pivot_longer(-c(\"UMAP1\", \"UMAP2\", \"Method\"), names_to = \"Feature\", values_to = \"Expression\") %>% dplyr::mutate(Type = if_else(str_detect(Feature, \"ADT\"), \"Protein\", \"RNA\")) %>% dplyr::mutate(Gene = str_replace(Feature, \"ADT_\", \"\")) %>% dplyr::mutate(Gene = if_else(Gene == \"CD3E\", \"CD3\", Gene))%>% dplyr::mutate(Gene = if_else(Gene == \"CD8A\", \"CD8\", Gene))%>% dplyr::filter(Gene %in% c(\"CD14\", \"CD3\", \"CD8\", \"CD19\")) %>% dplyr::mutate(Gene = factor(Gene, levels = c(\"CD3\", \"CD8\", \"CD14\", \"CD19\"))) %>% dplyr::mutate(Method = factor(Method, levels = c(\"Train data\", \"scDesign3\"))) #> Warning: `funs()` was deprecated in dplyr 0.8.0. #> ℹ Please use a list of either functions or lambdas: #>  #> # Simple named list: list(mean = mean, median = median) #>  #> # Auto named with `tibble::lst()`: tibble::lst(mean, median) #>  #> # Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE)) #> Call `lifecycle::last_lifecycle_warnings()` to see where this warning was #> generated. head(CITE_dat) #> # A tibble: 6 × 7 #>    UMAP1 UMAP2 Method     Feature  Expression Type    Gene  #>    <dbl> <dbl> <fct>      <chr>         <dbl> <chr>   <fct> #> 1 -0.883  14.5 Train data CD14          0     RNA     CD14  #> 2 -0.883  14.5 Train data CD19          0     RNA     CD19  #> 3 -0.883  14.5 Train data CD3E          0     RNA     CD3   #> 4 -0.883  14.5 Train data CD8A          0     RNA     CD8   #> 5 -0.883  14.5 Train data ADT_CD14      0.623 Protein CD14  #> 6 -0.883  14.5 Train data ADT_CD19      0.527 Protein CD19 CITE_dat  %>% ggplot(aes(x = UMAP1, y = UMAP2, color = Expression)) + geom_point(size = 0.1, alpha = 0.5) + scale_colour_gradientn(colors = viridis_pal(option = \"A\", direction = -1)(10), limits=c(0, 1)) + coord_fixed(ratio = 1) + facet_nested(Method ~ Gene + Type ) + theme(aspect.ratio = 1, legend.position = \"bottom\")  + theme(aspect.ratio = 1, legend.position = \"right\") + theme(     panel.grid.minor = element_blank(),     panel.grid.major = element_blank(),     axis.text.x=element_blank(),     axis.ticks.x=element_blank(),     axis.text.y=element_blank(),     axis.ticks.y=element_blank())"},{"path":"/articles/scDesign3-CITEseq-vignette.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Simulate CITE-seq data","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Ubuntu 20.04.6 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0 #>  #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Los_Angeles #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] ggh4x_0.2.5                 scales_1.2.1                #>  [3] tidyr_1.3.0                 stringr_1.5.0               #>  [5] ggplot2_3.4.2               dplyr_1.1.2                 #>  [7] SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2 #>  [9] Biobase_2.60.0              GenomicRanges_1.52.0        #> [11] GenomeInfoDb_1.36.1         IRanges_2.34.1              #> [13] S4Vectors_0.38.1            BiocGenerics_0.46.0         #> [15] MatrixGenerics_1.12.2       matrixStats_1.0.0           #> [17] scDesign3_0.99.6            BiocStyle_2.28.0            #>  #> loaded via a namespace (and not attached): #>  [1] tidyselect_1.2.0        viridisLite_0.4.2       farver_2.1.1            #>  [4] bitops_1.0-7            fastmap_1.1.1           RCurl_1.98-1.12         #>  [7] kde1d_1.0.5             digest_0.6.33           lifecycle_1.0.3         #> [10] survival_3.5-5          gamlss.dist_6.0-5       magrittr_2.0.3          #> [13] compiler_4.3.1          rlang_1.1.1             sass_0.4.7              #> [16] tools_4.3.1             utf8_1.2.3              yaml_2.3.7              #> [19] knitr_1.43              labeling_0.4.2          askpass_1.1             #> [22] S4Arrays_1.0.4          mclust_6.0.0            reticulate_1.30         #> [25] DelayedArray_0.26.6     withr_2.5.0             purrr_1.0.1             #> [28] rvinecopulib_0.6.3.1.1  desc_1.4.2              grid_4.3.1              #> [31] fansi_1.0.4             colorspace_2.1-0        MASS_7.3-60             #> [34] cli_3.6.1               rmarkdown_2.23          crayon_1.5.2            #> [37] ragg_1.2.5              generics_0.1.3          umap_0.2.10.0           #> [40] RSpectra_0.16-1         cachem_1.0.8            zlibbioc_1.46.0         #> [43] splines_4.3.1           assertthat_0.2.1        parallel_4.3.1          #> [46] BiocManager_1.30.21.1   XVector_0.40.0          vctrs_0.6.3             #> [49] Matrix_1.6-0            jsonlite_1.8.7          bookdown_0.34           #> [52] gamlss_5.4-12           irlba_2.3.5.1           systemfonts_1.0.4       #> [55] jquerylib_0.1.4         glue_1.6.2              pkgdown_2.0.7           #> [58] rngWELL_0.10-9          stringi_1.7.12          gtable_0.3.3            #> [61] randtoolbox_2.0.4       munsell_0.5.0           tibble_3.2.1            #> [64] pillar_1.9.0            htmltools_0.5.5         openssl_2.1.0           #> [67] gamlss.data_6.0-2       GenomeInfoDbData_1.2.10 R6_2.5.1                #> [70] textshaping_0.3.6       rprojroot_2.0.3         evaluate_0.21           #> [73] lattice_0.21-8          highr_0.10              png_0.1-8               #> [76] memoise_2.0.1           bslib_0.5.0             Rcpp_1.0.11             #> [79] nlme_3.1-162            mgcv_1.9-0              xfun_0.39               #> [82] fs_1.6.3                pkgconfig_2.0.3"},{"path":[]},{"path":"/articles/scDesign3-DEanalysis-vignette.html","id":"read-in-the-reference-data","dir":"Articles","previous_headings":"Identification of DE genes between discrete cell types","what":"Read in the reference data","title":"Benchmarking DE Analysis with scDesign3","text":"raw data R package DuoClustering2018 contain set datasets various clustering results. top 200 highly variable genes kept generating synthetic data. extract B cells regulatory T cells use cells two cell types simulate synthetic data.","code":"Zhengmix4eq_sce <- get(\"sce_filteredExpr10_Zhengmix4eq\")(metadata = FALSE) ngene <- 200 logcounts(Zhengmix4eq_sce) <- log1p(counts(Zhengmix4eq_sce)) zheng_sce <- modelGeneVar(Zhengmix4eq_sce) chosen <- getTopHVGs(zheng_sce, n = ngene) example_sce <- Zhengmix4eq_sce[chosen,] selected_cells <- which(colData(example_sce)$phenoid %in% c(\"b.cells\",\"regulatory.t\")) example_sce <- example_sce[,selected_cells] colData(example_sce)$cell_type <- as.factor(colData(example_sce)$phenoid) example_sce head(colData(example_sce))"},{"path":"/articles/scDesign3-DEanalysis-vignette.html","id":"simulation","dir":"Articles","previous_headings":"Identification of DE genes between discrete cell types","what":"Simulation","title":"Benchmarking DE Analysis with scDesign3","text":"use step--step functions instead one-shot function generate synthetic data since step--step functions allow us alter estimated parameters generate new data based desired parameters. , examine mean_mat, one outputs previous function extract_para(). gene, calculate difference maximum mean parameter minimum mean parameter across cells. select genes gene’s mean difference across cells top 50 largest differences. regard genes DE genes. , manually set mean parameters rest genes across cells. regard genes mean parameter across cells non-DE genes. course, flexible step users may choose ideas modify mean matrix.","code":"set.seed(123) example_data <- construct_data(     sce = example_sce,     assay_use = \"counts\",     celltype = \"cell_type\",     pseudotime = NULL,     spatial = NULL,     other_covariates = NULL,     corr_by = \"1\"   ) example_marginal <- fit_marginal(     data = example_data,     predictor = \"gene\",     mu_formula = \"cell_type\",     sigma_formula = \"1\",     family_use = \"nb\",     n_cores = 2,     usebam = FALSE   ) set.seed(123) example_copula <- fit_copula(     sce = example_sce,     assay_use = \"counts\",     marginal_list = example_marginal,     family_use = \"nb\",     copula = \"gaussian\",     n_cores = 2,     input_data = example_data$dat   ) example_para <- extract_para(     sce = example_sce,     marginal_list = example_marginal,     n_cores = 2,     family_use = \"nb\",     new_covariate = example_data$newCovariate,     data = example_data$dat   ) diff <- apply(example_para$mean_mat, 2, function(x){max(x,na.rm = TRUE)-min(x,na.rm = TRUE)}) diff_ordered <- order(diff, decreasing = TRUE) diff <- diff[diff_ordered] num_de <- 50 de_idx <- names(diff[1:num_de]) non_de_idx <- names(diff[-(1:num_de)]) non_de_mat <- apply(example_para$mean_mat[,non_de_idx], 2, function(x){   avg <- (max(x,na.rm = TRUE)+min(x,na.rm = TRUE))/2   new_mean <- rep(avg, length(x))   return(new_mean) }) example_para$mean_mat[,non_de_idx] <- non_de_mat set.seed(123)  example_newcount <- simu_new(     sce = example_sce,     mean_mat = example_para$mean_mat,     sigma_mat = example_para$sigma_mat,     zero_mat = example_para$zero_mat,     quantile_mat = NULL,     copula_list = example_copula$copula_list,     n_cores = 1,     family_use = \"nb\",     input_data = example_data$dat,     new_covariate = example_data$newCovariate,     important_feature = example_copula$important_feature,     filtered_gene = example_data$filtered_gene   )"},{"path":"/articles/scDesign3-DEanalysis-vignette.html","id":"de-genes-identification","dir":"Articles","previous_headings":"Identification of DE genes between discrete cell types","what":"DE genes identification","title":"Benchmarking DE Analysis with scDesign3","text":", follow Seurat’s pipeline preprocess simulated data. Since already ground truth cell type annotations simulated dataset, can directly use cell type annotations instead running FindClusters Seurat avoid double-dipping issue. , follow Seurat’s tutorial conduct DE test. Since manually created non-DE genes extra_para() step, now can calculate actual false discovery proportion(FDP) power DE tests conducted various target FDR threshold. Lastly, visualize Target FDR vs Actual FDP Target FDR vs Power .","code":"seurat_obj <- CreateSeuratObject(counts = example_newcount, project = \"seurat_obj\", min.cells = 0, min.features = 0) seurat_obj[[\"percent.mt\"]] <- PercentageFeatureSet(seurat_obj, pattern = \"^MT-\") seurat_obj <- NormalizeData(seurat_obj, normalization.method = \"LogNormalize\", scale.factor = 10000) seurat_obj <- FindVariableFeatures(seurat_obj, selection.method = \"vst\",nfeatures = 200) all.genes <- rownames(seurat_obj) seurat_obj <- ScaleData(seurat_obj, features = all.genes) seurat_obj <- RunPCA(seurat_obj, features = VariableFeatures(object = seurat_obj)) seurat_obj <- JackStraw(seurat_obj, num.replicate = 100) seurat_obj <- ScoreJackStraw(seurat_obj, dims = 1:20) seurat_obj <- FindNeighbors(seurat_obj, dims = 1:10) ct <- colData(example_sce)$cell_type names(ct) <- colnames(example_sce) seurat_obj[[\"cell_type\"]] <- ct Idents(seurat_obj) <- \"cell_type\" seurat_obj <- RunUMAP(seurat_obj, dims = 1:10) test <- c(\"wilcox\", \"bimod\", \"t\", \"poisson\", \"negbinom\", \"LR\", \"MAST\", \"DESeq2\") qvals <- matrix(0, nrow = dim(seurat_obj)[1], ncol = length(test)) for (x in 1:length(test)) {   markers <- FindMarkers(seurat_obj, ident.1 = \"b.cells\", ident.2 = \"regulatory.t\", test.use = test[x],                          logfc.threshold = 0, min.pct = 0, min.cells.feature = 1, min.cells.group = 1)   qvals[,x] <- p.adjust(markers[rownames(seurat_obj),\"p_val\"], method = \"BH\", length(rownames(seurat_obj))) } colnames(qvals) <- test rownames(qvals) <- rownames(seurat_obj) targetFDR <- c(seq(0.01,0.1,by=0.01),seq(0.2,0.5,by=0.1)) de <-de_idx fdp_mat <- matrix(0, nrow = length(targetFDR), ncol = length(test)) colnames(fdp_mat) <- test rownames(fdp_mat) <- targetFDR power_mat <- matrix(0, nrow = length(targetFDR), ncol = length(test)) colnames(power_mat) <- test rownames(power_mat) <- targetFDR  for (t in 1:length(test)) {   curr_p = qvals[,t]   for (i in 1:length(targetFDR)) {     thre <- targetFDR[i]     discovery <- which(curr_p <= thre)     tp <- length(intersect(names(discovery),de))     if(length(discovery) == 0){       fdp <- 0     }else{       fdp <- (length(discovery) - tp)/length(discovery)     }     power <- tp/length(de)     fdp_mat[i, t] <- fdp     power_mat[i,t] <- power   } } fdp_long <- melt(fdp_mat) colnames(fdp_long) <- c(\"Target FDR\",\"test_method\",\"Actual FDP\") fdp_plot <- ggplot(fdp_long) +   geom_line(aes(x=`Target FDR`, y=`Actual FDP`,color=test_method))+   geom_point(aes(x=`Target FDR`, y=`Actual FDP`,color=test_method))+   geom_abline(intercept = 0, slope=1,linetype=\"dashed\",color=\"grey\")+   theme(aspect.ratio = 1) + expand_limits(x = 0, y = c(0,1)) fdp_plot power_long <- melt(power_mat) colnames(power_long) <- c(\"Target FDR\",\"test_method\",\"Power\") power_plot <- ggplot(power_long) +   geom_line(aes(x=`Target FDR`, y=Power,color=test_method))+   geom_point(aes(x=`Target FDR`, y=Power,color=test_method))+   theme(aspect.ratio = 1) power_plot"},{"path":[]},{"path":"/articles/scDesign3-DEanalysis-vignette.html","id":"read-in-the-reference-data-1","dir":"Articles","previous_headings":"Identification of DE genes along a trajectory","what":"Read in the reference data","title":"Benchmarking DE Analysis with scDesign3","text":"raw data scvelo, describes pancreatic endocrinogenesis. pre-select top 1000 highly variable genes filter cell types ensure single trajectory. save computational time, use top 200 genes.","code":"example_sce <- readRDS((url(\"https://figshare.com/ndownloader/files/40581992\"))) print(example_sce) #> class: SingleCellExperiment  #> dim: 1000 2087  #> metadata(5): clusters_coarse_colors clusters_colors day_colors #>   neighbors pca #> assays(6): X spliced ... cpm logcounts #> rownames(1000): Pyy Iapp ... Eya2 Kif21a #> rowData names(1): highly_variable_genes #> colnames(2087): AAACCTGAGAGGGATA AAACCTGGTAAGTGGC ... TTTGTCAAGTGACATA #>   TTTGTCAAGTGTGGCA #> colData names(7): clusters_coarse clusters ... sizeFactor pseudotime #> reducedDimNames(4): X_pca X_umap PCA UMAP #> mainExpName: NULL #> altExpNames(0): example_sce <- example_sce[1:200, ]"},{"path":"/articles/scDesign3-DEanalysis-vignette.html","id":"simulation-1","dir":"Articles","previous_headings":"Identification of DE genes along a trajectory","what":"Simulation","title":"Benchmarking DE Analysis with scDesign3","text":"use step--step functions instead one-shot function generate synthetic data since step--step functions allow us alter estimated parameters generate new data based desired parameters. , examine mean_mat, one outputs previous function extract_para(). gene, calculate difference maximum mean parameter minimum mean parameter across cells. select genes gene’s mean difference across cells top 50 largest differences. regard genes DE genes(DEG). , manually set mean parameters rest genes across cells. regard genes mean parameter across cells non-DE genes.","code":"set.seed(1) PANCREAS_data <- construct_data(     sce = example_sce,     assay_use = \"counts\",     celltype = \"cell_type\",     pseudotime = \"pseudotime\",     spatial = NULL,     other_covariates = NULL,     corr_by = \"1\"   ) PANCREAS_marginal <- fit_marginal(     data = PANCREAS_data,     predictor = \"gene\",     mu_formula = \"s(pseudotime, k = 10, bs = 'cr')\",     sigma_formula = \"s(pseudotime, k = 5, bs = 'cr')\",     family_use = \"nb\",     n_cores = 2,     usebam = FALSE   ) set.seed(1) PANCREAS_copula <- fit_copula(     sce = example_sce,     assay_use = \"counts\",     marginal_list = PANCREAS_marginal,     family_use = \"nb\",     copula = \"gaussian\",     n_cores = 2,     input_data = PANCREAS_data$dat   ) PANCREAS_para <- extract_para(     sce = example_sce,     marginal_list = PANCREAS_marginal,     n_cores = 1,     family_use = \"nb\",     new_covariate = PANCREAS_data$newCovariate,     data = PANCREAS_data$dat   ) diff <- apply(PANCREAS_para$mean_mat, 2, function(x){max(x)-min(x)}) diff_ordered <- order(diff, decreasing = TRUE) diff <- diff[diff_ordered] num_de <- 50 de_idx <- names(diff[1:num_de]) non_de_idx <- names(diff[-(1:num_de)]) non_de_mat <- apply(PANCREAS_para$mean_mat[,non_de_idx], 2, function(x){   avg <- mean(x)   new_mean <- rep(avg, length(x))   return(new_mean) }) PANCREAS_para$mean_mat[,non_de_idx] <- non_de_mat set.seed(1)  PANCREAS_newcount <- simu_new(     sce = example_sce,     mean_mat = PANCREAS_para$mean_mat,     sigma_mat = PANCREAS_para$sigma_mat,     zero_mat = PANCREAS_para$zero_mat,     quantile_mat = NULL,     copula_list = PANCREAS_copula$copula_list,     n_cores = 1,     family_use = \"nb\",     input_data = PANCREAS_data$dat,     new_covariate = PANCREAS_data$newCovariate,     important_feature = PANCREAS_copula$important_feature,     filtered_gene = PANCREAS_data$filtered_gene   ) simu_sce <- SingleCellExperiment(list(counts = PANCREAS_newcount), colData = PANCREAS_data$newCovariate) logcounts(simu_sce) <- log1p(counts(simu_sce))"},{"path":"/articles/scDesign3-DEanalysis-vignette.html","id":"de-genes-identification-1","dir":"Articles","previous_headings":"Identification of DE genes along a trajectory","what":"DE genes identification","title":"Benchmarking DE Analysis with scDesign3","text":"Now, use simulated data benchmark performance four DEG identification methods. p-values two methods Benjamini-Hochberg(BH) corretion stored qvals following code.","code":"qvals <- matrix(0, ncol = 4, nrow = dim(simu_sce)[1]) colnames(qvals) <- c(\"Monocle3-DE\",\"tradeSeq\",\"NBAMseq\",\"PseudotimeDE\") rownames(qvals) <- rownames(simu_sce)"},{"path":"/articles/scDesign3-DEanalysis-vignette.html","id":"monocle3","dir":"Articles","previous_headings":"Identification of DE genes along a trajectory > DE genes identification","what":"Monocle3","title":"Benchmarking DE Analysis with scDesign3","text":"follow tutorial Monocle3 conduct DE test obtain p-values BH correction.","code":"rowdata <- rowData(simu_sce) rowdata$gene_short_name <- rownames(rowData(simu_sce)) coldata <- colData(simu_sce) cds <- new_cell_data_set(counts(simu_sce),                            cell_metadata = coldata,                            gene_metadata = rowdata) gene_fits <- fit_models(cds, model_formula_str = \"~pseudotime\") fit_coefs <- coefficient_table(gene_fits) fit <- fit_coefs %>% dplyr::filter(term == \"pseudotime\") %>% dplyr::select(p_value, q_value) %>% dplyr::mutate(gene = rownames(simu_sce)) fit qvals[fit$gene,\"Monocle3-DE\"] <- fit$q_value"},{"path":"/articles/scDesign3-DEanalysis-vignette.html","id":"tradeseq","dir":"Articles","previous_headings":"Identification of DE genes along a trajectory > DE genes identification","what":"tradeSeq","title":"Benchmarking DE Analysis with scDesign3","text":"follow tutorial tradeSeq conduct DE test obtain p-values BH correction.","code":"pseudo <- colData(simu_sce)$pseudotime icMat <- evaluateK(counts = counts(simu_sce), pseudotime  = pseudo, cellWeights = rep(1, dim(simu_sce)[2]), k = 3:10, nGenes = 100, verbose = FALSE, plot = TRUE) res_tradeSeq <- fitGAM(counts = as.matrix(assays(simu_sce)$counts), pseudotime = pseudo, cellWeights = rep(1, length(pseudo)),nknots = 10) assoRes <- associationTest(res_tradeSeq, lineages = FALSE) assoRes <- assoRes %>% as_tibble(rownames = \"gene\") %>% dplyr::mutate(qvalue = p.adjust(pvalue, method = \"BH\")) qvals[assoRes$gene,\"tradeSeq\"] <- assoRes$qvalue"},{"path":"/articles/scDesign3-DEanalysis-vignette.html","id":"nbamseq","dir":"Articles","previous_headings":"Identification of DE genes along a trajectory > DE genes identification","what":"NBAMseq","title":"Benchmarking DE Analysis with scDesign3","text":"follow tutorial NBAMseq conduct DE test obtain p-values BH correction.","code":"countdata <- counts(simu_sce) coldata <- colData(simu_sce) design = ~s(pseudotime) gsd = NBAMSeqDataSet(countData = countdata, colData = coldata, design = design) gsd = NBAMSeq(gsd)  res1 = NBAMSeq::results(gsd, name = \"pseudotime\") head(res1) qvals[rownames(res1),\"NBAMseq\"] = res1$padj"},{"path":"/articles/scDesign3-DEanalysis-vignette.html","id":"pseudotimede","dir":"Articles","previous_headings":"Identification of DE genes along a trajectory > DE genes identification","what":"PseudotimeDE","title":"Benchmarking DE Analysis with scDesign3","text":"follow tutorial PseudotimeDE conduct DE test obtain p-values BH correction. save computational time, use fix-mode PseudotimeDE. Since tradeSeq’s result contains NA, convert NA 1 first. Since manually created non-DE genes extra_para() step, now can calculate actual false discovery proportion(FDP) power DE tests conducted various target FDR threshold. Lastly, visualize Target FDR vs Actual FDP Target FDR vs Power .","code":"ori_tbl <- tibble(cell = colnames(simu_sce), pseudotime = colData(simu_sce)$pseudotime) res <- runPseudotimeDE(gene.vec = rownames(simu_sce),                                      ori.tbl = ori_tbl,                                      sub.tbl = NULL,                                       mat = simu_sce,                                       model = \"nb\") qvals[res$gene,\"PseudotimeDE\"] <- p.adjust(res$fix.pv, method = \"BH\", length(res$gene)) qvals[is.na(qvals)] <- 1 print(head(qvals)) test = colnames(qvals) targetFDR <- c(seq(0.01,0.1,by=0.01),seq(0.2,0.5,by=0.1)) de <- colnames(PANCREAS_para$mean_mat[,de_idx]) fdp_mat <- matrix(0, nrow = length(targetFDR), ncol = length(test)) colnames(fdp_mat) <- test rownames(fdp_mat) <- targetFDR power_mat <- matrix(0, nrow = length(targetFDR), ncol = length(test)) colnames(power_mat) <- test rownames(power_mat) <- targetFDR for (t in 1:length(test)) {   curr_p = qvals[,t]   for (i in 1:length(targetFDR)) {     thre <- targetFDR[i]     discovery <- which(curr_p <= thre)     tp <- length(intersect(names(discovery),de))     if(length(discovery) == 0){       fdp <- 0     }else{       fdp <- (length(discovery) - tp)/length(discovery)     }        power <- tp/length(de)     fdp_mat[i, t] <- fdp     power_mat[i,t] <- power   } } fdp_long <- melt(fdp_mat) colnames(fdp_long) <- c(\"Target FDR\",\"test_method\",\"Actual FDP\") fdp_plot <- ggplot(fdp_long) +   geom_line(aes(x=`Target FDR`, y=`Actual FDP`,color=test_method))+   geom_point(aes(x=`Target FDR`, y=`Actual FDP`,color=test_method))+   geom_abline(intercept = 0, slope=1,linetype=\"dashed\",color=\"grey\")+   theme(aspect.ratio = 1) + expand_limits(x = 0, y = c(0,1)) fdp_plot power_long <- melt(power_mat) colnames(power_long) <- c(\"Target FDR\",\"test_method\",\"Power\") power_plot <- ggplot(power_long) +   geom_line(aes(x=`Target FDR`, y=Power,color=test_method))+   geom_point(aes(x=`Target FDR`, y=Power,color=test_method))+   theme(aspect.ratio = 1) power_plot"},{"path":[]},{"path":"/articles/scDesign3-DEanalysis-vignette.html","id":"read-in-the-reference-data-2","dir":"Articles","previous_headings":"Identification of Spatially Variable Genes (SVG) in spatial transcriptomic data","what":"Read in the reference data","title":"Benchmarking DE Analysis with scDesign3","text":"raw data Seurat, dataset generated Visium technology 10x Genomics. pre-select top spatial variable genes. save time, subset top 200 genes. remove mitochondrial genes since preprocessing step SPARK-X, one method use identify spatially variable genes.","code":"example_sce <- readRDS((url(\"https://figshare.com/ndownloader/files/40582019\"))) print(example_sce) #> class: SingleCellExperiment  #> dim: 1000 2696  #> metadata(0): #> assays(2): counts logcounts #> rownames(1000): Calb2 Gng4 ... Fndc5 Gda #> rowData names(0): #> colnames(2696): AAACAAGTATCTCCCA-1 AAACACCAATAACTGC-1 ... #>   TTGTTTCACATCCAGG-1 TTGTTTCCATACAACT-1 #> colData names(12): orig.ident nCount_Spatial ... spatial2 cell_type #> reducedDimNames(0): #> mainExpName: NULL #> altExpNames(0): example_sce <- example_sce[1:200, ] mt_idx<- grep(\"mt-\",rownames(example_sce)) if(length(mt_idx)!=0){     example_sce   <- example_sce[-mt_idx,] }"},{"path":"/articles/scDesign3-DEanalysis-vignette.html","id":"simulation-2","dir":"Articles","previous_headings":"Identification of Spatially Variable Genes (SVG) in spatial transcriptomic data","what":"Simulation","title":"Benchmarking DE Analysis with scDesign3","text":"use step--step functions instead one-shot function generate synthetic data since step--step functions allow us alter estimated parameters generate new data based desired parameters. , examine mean_mat, one outputs previous function extract_para(). gene, calculate deviance explained spatial locations regression model, select top 50. regard genes spatially variable genes (SVGs). , manually set mean parameters rest genes across cells. regard genes mean parameter across cells non-SVG genes. Another way select SVG based Moran’s . rescale log count 5 synthetic SVG 0 1 scale visualize .  also rescale log count 5 synthetic non-SVG 0 1 scale visualize .","code":"set.seed(1) example_data <- construct_data(     sce = example_sce,     assay_use = \"counts\",     celltype = \"cell_type\",     pseudotime = NULL,     spatial = c(\"spatial1\", \"spatial2\"),     other_covariates = NULL,     corr_by = \"1\"   ) example_marginal <- fit_marginal(     data = example_data,     predictor = \"gene\",     mu_formula = \"s(spatial1, spatial2, bs = 'gp', k= 50)\",     sigma_formula = \"1\",     family_use = \"nb\",     n_cores = 2,     usebam = FALSE   ) set.seed(1) example_copula <- fit_copula(     sce = example_sce,     assay_use = \"counts\",     marginal_list = example_marginal,     family_use = \"nb\",     copula = \"gaussian\",     n_cores = 2,     input_data = example_data$dat   ) example_para <- extract_para(     sce = example_sce,     marginal_list = example_marginal,     n_cores = 2,     family_use = \"nb\",     new_covariate = example_data$newCovariate,     data = example_data$dat   ) dev_explain <- sapply(example_marginal, function(x){   sum = summary(x$fit)   return(sum$dev.expl) }) dev_ordered <- order(dev_explain, decreasing = TRUE) num_de <- 50 ordered <- dev_explain[dev_ordered] de_idx <- names(ordered)[1:num_de] non_de_idx <- names(ordered)[-(1:num_de)] non_de_mat <- apply(example_para$mean_mat[,non_de_idx], 2, function(x){   avg <- (max(x)+min(x))/2   new_mean <- rep(avg, length(x))   return(new_mean) }) example_para$mean_mat[,non_de_idx] <- non_de_mat # num_de <- 50 # loc = colData(simu_sce)[,c(\"spatial1\",\"spatial2\")] # features = FindSpatiallyVariableFeatures(counts(simu_sce), spatial.location = loc, selection.method = \"moransi\",nfeatures = num_de) # top.features = features[order(features$p.value),] # top.features= rownames(top.features[1:num_de,]) # de_idx <- which(rownames(simu_sce) %in% top.features) # non_de_idx <-which(!rownames(simu_sce) %in% top.features) # non_de_mat <- apply(example_para$mean_mat[,non_de_idx], 2, function(x){ #   avg <- (max(x)+min(x))/2 #   new_mean <- rep(avg, length(x)) #   return(new_mean) # }) # example_para$mean_mat[,non_de_idx] <- non_de_mat set.seed(1)  example_newcount <- simu_new(     sce = example_sce,     mean_mat = example_para$mean_mat,     sigma_mat = example_para$sigma_mat,     zero_mat = example_para$zero_mat,     quantile_mat = NULL,     copula_list = example_copula$copula_list,     n_cores = 1,     family_use = \"nb\",     input_data = example_data$dat,     new_covariate = example_data$newCovariate,     important_feature = rep(TRUE, dim(example_sce)[1]),     filtered_gene = example_data$filtered_gene   ) simu_sce <- SingleCellExperiment(list(counts =example_newcount), colData = example_data$newCovariate) logcounts(simu_sce) <- log1p(counts(simu_sce)) de_genes = de_idx[1:5] loc = colData(simu_sce)[,c(\"spatial1\",\"spatial2\")] expre = lapply(de_genes, function(x){     curr = as.matrix(counts(simu_sce)[x,])     curr = log1p(curr)     return(rescale(curr))   }) long = do.call(rbind, expre) long = as.data.frame(long) colnames(long) <- \"Expression\" long$gene = do.call(c, lapply(de_genes, function(x){rep(x,dim(expre[[1]])[1])})) long$x = rep(loc[,1],5) long$y = rep(loc[,2],5) as_tibble(long, rownames = \"Cell\") %>% ggplot(aes(x = x, y = y, color = Expression)) +geom_point(size = 0.1)+facet_grid(~gene)+ scale_colour_gradientn(colors = viridis_pal(option = \"magma\")(10), limits=c(0, 1)) + coord_fixed(ratio = 1) + theme(axis.text.x = element_text(angle = 45)) non_de_genes = non_de_idx[1:5] loc = colData(simu_sce)[,c(\"spatial1\",\"spatial2\")] expre = lapply(non_de_genes, function(x){     curr = as.matrix(counts(simu_sce)[x,])     curr = log1p(curr)     return(rescale(curr))   }) long = do.call(rbind, expre) long = as.data.frame(long) colnames(long) <- \"Expression\" long$gene = do.call(c, lapply(non_de_genes, function(x){rep(x,dim(expre[[1]])[1])})) long$x = rep(loc[,1],5) long$y = rep(loc[,2],5) as_tibble(long, rownames = \"Cell\") %>% ggplot(aes(x = x, y = y, color = Expression)) +geom_point(size = 0.1)+facet_grid(~gene)+ scale_colour_gradientn(colors = viridis_pal(option = \"magma\")(10), limits=c(0, 1)) + coord_fixed(ratio = 1) + theme(axis.text.x = element_text(angle = 45))"},{"path":"/articles/scDesign3-DEanalysis-vignette.html","id":"svg-identification","dir":"Articles","previous_headings":"Identification of Spatially Variable Genes (SVG) in spatial transcriptomic data","what":"SVG identification","title":"Benchmarking DE Analysis with scDesign3","text":"Now, use simulated data benchmark performance three SVG identification methods. p-values two methods Benjamini-Hochberg(BH) correction stored qvals following code.","code":"qvals <- matrix(0, ncol = 3, nrow = dim(simu_sce)[1]) colnames(qvals) <- c(\"spatialDE\",\"SPARK\",\"SPARK-X\") rownames(qvals) <- rownames(simu_sce)"},{"path":"/articles/scDesign3-DEanalysis-vignette.html","id":"spatialde","dir":"Articles","previous_headings":"Identification of Spatially Variable Genes (SVG) in spatial transcriptomic data > SVG identification","what":"spatialDE","title":"Benchmarking DE Analysis with scDesign3","text":"follow tutorial spatialDE conduct hypothesis test obtain p-values BH correction.","code":"count <- counts(simu_sce) sample_info <- colData(simu_sce)[, c(\"spatial1\",\"spatial2\")] sample_info <- as.data.frame(sample_info) colnames(sample_info) <- c(\"x\",\"y\") count <- count[rowSums(count) >=3, ] count <- count[, row.names(sample_info)] sample_info$total_counts <- colSums(count) X <- sample_info[,c(\"x\",\"y\")] norm_expr <- stabilize(count) resid_expr <- regress_out(norm_expr, sample_info = sample_info) results_spatialDE <- spatialDE::run(resid_expr, coordinates = X) rownames(results_spatialDE) <- results_spatialDE$g qvals[,\"spatialDE\"] <- results_spatialDE[rownames(simu_sce),\"qval\"]"},{"path":"/articles/scDesign3-DEanalysis-vignette.html","id":"spark","dir":"Articles","previous_headings":"Identification of Spatially Variable Genes (SVG) in spatial transcriptomic data > SVG identification","what":"SPARK","title":"Benchmarking DE Analysis with scDesign3","text":"follow tutorial SPARK conduct hypothesis test obtain p-values BH correction.","code":"rawcount <- counts(simu_sce) info <- as.data.frame(colData(simu_sce)[, c(\"spatial1\",\"spatial2\")]) colnames(info) <- c(\"x\",\"y\") info$total_count <- apply(rawcount,2,sum) rownames(info) <- colnames(rawcount) spark <- CreateSPARKObject(counts=rawcount,                               location=info[,1:2],                              percentage = 0,                               min_total_counts = 10) spark@lib_size <- apply(spark@counts, 2, sum) spark <- spark.vc(spark,                     covariates = NULL,                     lib_size = spark@lib_size,                     num_core = 2,                    verbose = FALSE) spark <- spark.test(spark,                       check_positive = TRUE,                       verbose = FALSE) qvals[,\"SPARK\"] <- spark@res_mtest$adjusted_pvalue"},{"path":"/articles/scDesign3-DEanalysis-vignette.html","id":"spark-x","dir":"Articles","previous_headings":"Identification of Spatially Variable Genes (SVG) in spatial transcriptomic data > SVG identification","what":"SPARK-X","title":"Benchmarking DE Analysis with scDesign3","text":"follow tutorial SPARK-X conduct hypothesis test obtain p-values BH correction. Since manually created non-SVG extra_para() step, now can calculate actual false discovery proportion(FDP) power tests conducted various target FDR threshold. Lastly, visualize Target FDR vs Actual FDP Target FDR vs Power .","code":"sp_count <- counts(simu_sce) info <- as.data.frame(colData(simu_sce)[, c(\"spatial1\",\"spatial2\")]) colnames(info) <- c(\"x\",\"y\") info$total_count <- apply(sp_count ,2,sum) rownames(info) <- colnames(sp_count ) location <- as.matrix(info) mt_idx      <- grep(\"mt-\",rownames(sp_count)) if(length(mt_idx)!=0){     sp_count    <- sp_count[-mt_idx,] } sparkX <- sparkx(sp_count,location,numCores=1,option=\"mixture\") head(sparkX$res_mtest) qvals[,\"SPARK-X\"] <-sparkX$res_mtest$adjustedPval test = colnames(qvals) targetFDR <- c(0.01,0.05,0.1,0.2,0.5) de <- de_idx fdp_mat <- matrix(0, nrow = length(targetFDR), ncol = length(test)) colnames(fdp_mat) <- test rownames(fdp_mat) <- targetFDR power_mat <- matrix(0, nrow = length(targetFDR), ncol = length(test)) colnames(power_mat) <- test rownames(power_mat) <- targetFDR  for (t in 1:length(test)) {   curr_p <- qvals[,t]   curr_test <- test[t]   for (i in 1:length(targetFDR)) {     thre <- targetFDR[i]     if(curr_test == \"spatialDE\"){       de_results <- results_spatialDE[results_spatialDE$qval < thre, ]       ms_results <- model_search(       resid_expr,       coordinates = X,       de_results = de_results       )       discovery <- ms_results$g       tp <- length(intersect(ms_results$g,de))     }else{       discovery <- which(curr_p <= thre)       tp <- length(intersect(names(discovery),de))     }     if(length(discovery) == 0){       fdp <- 0     }else{       fdp <- (length(discovery) - tp)/length(discovery)     }     power <- tp/length(de)     fdp_mat[i, t] <- fdp     power_mat[i,t] <- power   } } fdp_long <- melt(fdp_mat) colnames(fdp_long) <- c(\"Target FDR\",\"test_method\",\"Actual FDP\") fdp_plot <- ggplot(fdp_long) +   geom_line(aes(x=`Target FDR`, y=`Actual FDP`,color=test_method))+   geom_point(aes(x=`Target FDR`, y=`Actual FDP`,color=test_method))+   geom_abline(intercept = 0, slope=1,linetype=\"dashed\",color=\"grey\")+   theme(aspect.ratio = 1) + expand_limits(x = 0, y = c(0,1)) fdp_plot power_long <- melt(power_mat) colnames(power_long) <- c(\"Target FDR\",\"test_method\",\"Power\") power_plot <- ggplot(power_long) +   geom_line(aes(x=`Target FDR`, y=Power,color=test_method))+   geom_point(aes(x=`Target FDR`, y=Power,color=test_method))+   theme(aspect.ratio = 1) power_plot"},{"path":"/articles/scDesign3-DEanalysis-vignette.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Benchmarking DE Analysis with scDesign3","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Ubuntu 20.04.6 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0 #>  #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Los_Angeles #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] parallel  stats4    stats     graphics  grDevices utils     datasets  #> [8] methods   base      #>  #> other attached packages: #>  [1] tidyr_1.3.0                 scales_1.2.1                #>  [3] SPARK_1.1.1                 spatialDE_1.6.0             #>  [5] reshape2_1.4.4              tradeSeq_1.14.0             #>  [7] dplyr_1.1.2                 PseudotimeDE_1.0.0          #>  [9] NBAMSeq_1.16.0              BiocParallel_1.34.2         #> [11] DESeq2_1.40.2               monocle3_1.3.1              #> [13] scran_1.28.1                scuttle_1.10.1              #> [15] SeuratObject_4.1.3          Seurat_4.3.0.1              #> [17] DuoClustering2018_1.18.0    ggplot2_3.4.2               #> [19] SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2 #> [21] Biobase_2.60.0              GenomicRanges_1.52.0        #> [23] GenomeInfoDb_1.36.1         IRanges_2.34.1              #> [25] S4Vectors_0.38.1            BiocGenerics_0.46.0         #> [27] MatrixGenerics_1.12.2       matrixStats_1.0.0           #> [29] scDesign3_0.99.6            BiocStyle_2.28.0            #>  #> loaded via a namespace (and not attached): #>   [1] fs_1.6.3                      spatstat.sparse_3.0-2         #>   [3] bitops_1.0-7                  doParallel_1.0.17             #>   [5] httr_1.4.6                    RColorBrewer_1.1-3            #>   [7] backports_1.4.1               tools_4.3.1                   #>   [9] sctransform_0.3.5             utf8_1.2.3                    #>  [11] R6_2.5.1                      HDF5Array_1.28.1              #>  [13] mgcv_1.9-0                    lazyeval_0.2.2                #>  [15] uwot_0.1.16                   rhdf5filters_1.12.1           #>  [17] withr_2.5.0                   sp_2.0-0                      #>  [19] prettyunits_1.1.1             gridExtra_2.3                 #>  [21] progressr_0.13.0              cli_3.6.1                     #>  [23] textshaping_0.3.6             spatstat.explore_3.2-1        #>  [25] biglm_0.9-2.1                 labeling_0.4.2                #>  [27] sass_0.4.7                    mvtnorm_1.2-2                 #>  [29] spatstat.data_3.0-1           genefilter_1.82.1             #>  [31] gamlss_5.4-12                 ggridges_0.5.4                #>  [33] pbapply_1.7-2                 slingshot_2.8.0               #>  [35] pkgdown_2.0.7                 systemfonts_1.0.4             #>  [37] R.utils_2.12.2                parallelly_1.36.0             #>  [39] limma_3.56.2                  RSQLite_2.3.1                 #>  [41] generics_0.1.3                gamlss.data_6.0-2             #>  [43] ica_1.0-3                     spatstat.random_3.1-5         #>  [45] Matrix_1.6-0                  fansi_1.0.4                   #>  [47] abind_1.4-5                   R.methodsS3_1.8.2             #>  [49] terra_1.7-39                  lifecycle_1.0.3               #>  [51] yaml_2.3.7                    edgeR_3.42.4                  #>  [53] CompQuadForm_1.4.3            rhdf5_2.44.0                  #>  [55] BiocFileCache_2.8.0           Rtsne_0.16                    #>  [57] grid_4.3.1                    blob_1.2.4                    #>  [59] promises_1.2.0.1              dqrng_0.3.0                   #>  [61] ExperimentHub_2.8.1           crayon_1.5.2                  #>  [63] dir.expiry_1.8.0              miniUI_0.1.1.1                #>  [65] lattice_0.21-8                beachmat_2.16.0               #>  [67] cowplot_1.1.1                 annotate_1.78.0               #>  [69] KEGGREST_1.40.0               magick_2.7.4                  #>  [71] pillar_1.9.0                  knitr_1.43                    #>  [73] metapod_1.8.0                 rjson_0.2.21                  #>  [75] boot_1.3-28.1                 future.apply_1.11.0           #>  [77] codetools_0.2-19              leiden_0.4.3                  #>  [79] glue_1.6.2                    data.table_1.14.8             #>  [81] vctrs_0.6.3                   png_0.1-8                     #>  [83] gtable_0.3.3                  assertthat_0.2.1              #>  [85] cachem_1.0.8                  xfun_0.39                     #>  [87] DropletUtils_1.20.0           princurve_2.1.6               #>  [89] S4Arrays_1.0.4                mime_0.12                     #>  [91] pracma_2.4.2                  survival_3.5-5                #>  [93] iterators_1.0.14              statmod_1.5.0                 #>  [95] bluster_1.10.0                interactiveDisplayBase_1.38.0 #>  [97] ellipsis_0.3.2                fitdistrplus_1.1-11           #>  [99] ROCR_1.0-11                   nlme_3.1-162                  #> [101] bit64_4.0.5                   progress_1.2.2                #> [103] filelock_1.0.2                RcppAnnoy_0.0.21              #> [105] rprojroot_2.0.3               bslib_0.5.0                   #> [107] irlba_2.3.5.1                 matlab_1.0.4                  #> [109] KernSmooth_2.23-22            colorspace_2.1-0              #> [111] DBI_1.1.3                     tidyselect_1.2.0              #> [113] bit_4.0.5                     compiler_4.3.1                #> [115] curl_5.0.1                    BiocNeighbors_1.18.0          #> [117] basilisk.utils_1.12.1         desc_1.4.2                    #> [119] DelayedArray_0.26.6           plotly_4.10.2                 #> [121] bookdown_0.34                 checkmate_2.2.0               #> [123] lmtest_0.9-40                 speedglm_0.3-5                #> [125] rappdirs_0.3.3                SpatialExperiment_1.10.0      #> [127] stringr_1.5.0                 digest_0.6.33                 #> [129] goftest_1.2-3                 spatstat.utils_3.0-3          #> [131] minqa_1.2.5                   rmarkdown_2.23                #> [133] basilisk_1.12.1               XVector_0.40.0                #> [135] htmltools_0.5.5               pkgconfig_2.0.3               #> [137] lme4_1.1-34                   sparseMatrixStats_1.12.2      #> [139] highr_0.10                    dbplyr_2.3.3                  #> [141] fastmap_1.1.1                 rlang_1.1.1                   #> [143] htmlwidgets_1.6.2             ggthemes_4.2.4                #> [145] shiny_1.7.4.1                 DelayedMatrixStats_1.22.1     #> [147] farver_2.1.1                  jquerylib_0.1.4               #> [149] zoo_1.8-12                    jsonlite_1.8.7                #> [151] mclust_6.0.0                  R.oo_1.25.0                   #> [153] BiocSingular_1.16.0           RCurl_1.98-1.12               #> [155] magrittr_2.0.3                GenomeInfoDbData_1.2.10       #> [157] patchwork_1.1.2               Rhdf5lib_1.22.0               #> [159] munsell_0.5.0                 Rcpp_1.0.11                   #> [161] TrajectoryUtils_1.8.0         viridis_0.6.4                 #> [163] reticulate_1.30               stringi_1.7.12                #> [165] zlibbioc_1.46.0               MASS_7.3-60                   #> [167] MAST_1.26.0                   AnnotationHub_3.8.0           #> [169] plyr_1.8.8                    gamlss.dist_6.0-5             #> [171] listenv_0.9.0                 ggrepel_0.9.3                 #> [173] deldir_1.0-9                  Biostrings_2.68.1             #> [175] splines_4.3.1                 tensor_1.5                    #> [177] hms_1.1.3                     locfit_1.5-9.8                #> [179] igraph_1.5.0.1                spatstat.geom_3.2-4           #> [181] ScaledMatrix_1.8.1            XML_3.99-0.14                 #> [183] BiocVersion_3.17.1            evaluate_0.21                 #> [185] BiocManager_1.30.21.1         foreach_1.5.2                 #> [187] nloptr_2.0.3                  httpuv_1.6.11                 #> [189] RANN_2.6.1                    purrr_1.0.1                   #> [191] polyclip_1.10-4               future_1.33.0                 #> [193] scattermore_1.2               rsvd_1.0.5                    #> [195] xtable_1.8-4                  later_1.3.1                   #> [197] viridisLite_0.4.2             ragg_1.2.5                    #> [199] tibble_3.2.1                  memoise_2.0.1                 #> [201] AnnotationDbi_1.62.2          cluster_2.1.4                 #> [203] globals_0.16.2                here_1.0.1"},{"path":"/articles/scDesign3-batchEffect-vignette.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Simulate datasets with batch effect","text":"tutorial, show use scDesign3 simulate data original batch effects remove batch effects. also demostrate add ariticial batch effects.","code":""},{"path":"/articles/scDesign3-batchEffect-vignette.html","id":"read-in-the-reference-data","dir":"Articles","previous_headings":"","what":"Read in the reference data","title":"Simulate datasets with batch effect","text":"raw data SeuratData package. data called pbmcsca package; PBMC Systematic Comparative Analysis dataset Broad Institute. save computational time, use top 100 genes. column batch example dataset’s colData contains batch information.","code":"example_sce <- readRDS((url(\"https://figshare.com/ndownloader/files/40581965\"))) print(example_sce) #> class: SingleCellExperiment  #> dim: 1000 6276  #> metadata(0): #> assays(2): counts logcounts #> rownames(1000): LYZ GNLY ... PBXIP1 SECTM1 #> rowData names(0): #> colnames(6276): pbmc2_10X_V2_AAACCTGAGATGGGTC #>   pbmc2_10X_V2_AAACCTGAGCGTAATA ... pbmc1_10x_v3_TTGAACGCATGCAGCC #>   pbmc1_10x_v3_TTTGACTAGTGTTCCA #> colData names(13): phenoid orig.ident ... batch cell_type #> reducedDimNames(0): #> mainExpName: NULL #> altExpNames(0): example_sce <- example_sce[1:100, ] head(colData(example_sce)) #> DataFrame with 6 rows and 13 columns #>                                        phenoid orig.ident nCount_RNA #>                                    <character>   <factor>  <numeric> #> pbmc2_10X_V2_AAACCTGAGATGGGTC           B cell      pbmc2       2360 #> pbmc2_10X_V2_AAACCTGAGCGTAATA           B cell      pbmc2       1888 #> pbmc2_10X_V2_AAACCTGAGCTAGGCA Cytotoxic T cell      pbmc2       3456 #> pbmc2_10X_V2_AAACCTGAGGGTCTCC   Dendritic cell      pbmc2       3802 #> pbmc2_10X_V2_AAACCTGGTCCGAACC      CD4+ T cell      pbmc2       3826 #> pbmc2_10X_V2_AAACCTGTCGTCCGTT      CD4+ T cell      pbmc2       2345 #>                               nFeature_RNA       nGene        nUMI #>                                  <integer> <character> <character> #> pbmc2_10X_V2_AAACCTGAGATGGGTC         1044        1044        2360 #> pbmc2_10X_V2_AAACCTGAGCGTAATA          803         803        1888 #> pbmc2_10X_V2_AAACCTGAGCTAGGCA         1372        1372        3456 #> pbmc2_10X_V2_AAACCTGAGGGTCTCC         1519        1519        3802 #> pbmc2_10X_V2_AAACCTGGTCCGAACC         1451        1451        3826 #> pbmc2_10X_V2_AAACCTGTCGTCCGTT          931         931        2345 #>                                     percent.mito     Cluster  Experiment #>                                      <character> <character> <character> #> pbmc2_10X_V2_AAACCTGAGATGGGTC 0.0419491525423729           2       pbmc2 #> pbmc2_10X_V2_AAACCTGAGCGTAATA 0.0413135593220339           2       pbmc2 #> pbmc2_10X_V2_AAACCTGAGCTAGGCA 0.0353009259259259           1       pbmc2 #> pbmc2_10X_V2_AAACCTGAGGGTCTCC 0.0420831141504471           6       pbmc2 #> pbmc2_10X_V2_AAACCTGGTCCGAACC 0.0371144798745426           0       pbmc2 #> pbmc2_10X_V2_AAACCTGTCGTCCGTT 0.0652452025586354           0       pbmc2 #>                                          Method    ident             batch #>                                     <character> <factor>       <character> #> pbmc2_10X_V2_AAACCTGAGATGGGTC 10x Chromium (v2)    pbmc2 10x Chromium (v2) #> pbmc2_10X_V2_AAACCTGAGCGTAATA 10x Chromium (v2)    pbmc2 10x Chromium (v2) #> pbmc2_10X_V2_AAACCTGAGCTAGGCA 10x Chromium (v2)    pbmc2 10x Chromium (v2) #> pbmc2_10X_V2_AAACCTGAGGGTCTCC 10x Chromium (v2)    pbmc2 10x Chromium (v2) #> pbmc2_10X_V2_AAACCTGGTCCGAACC 10x Chromium (v2)    pbmc2 10x Chromium (v2) #> pbmc2_10X_V2_AAACCTGTCGTCCGTT 10x Chromium (v2)    pbmc2 10x Chromium (v2) #>                                      cell_type #>                                    <character> #> pbmc2_10X_V2_AAACCTGAGATGGGTC           B cell #> pbmc2_10X_V2_AAACCTGAGCGTAATA           B cell #> pbmc2_10X_V2_AAACCTGAGCTAGGCA Cytotoxic T cell #> pbmc2_10X_V2_AAACCTGAGGGTCTCC   Dendritic cell #> pbmc2_10X_V2_AAACCTGGTCCGAACC      CD4+ T cell #> pbmc2_10X_V2_AAACCTGTCGTCCGTT      CD4+ T cell"},{"path":"/articles/scDesign3-batchEffect-vignette.html","id":"simulation","dir":"Articles","previous_headings":"","what":"Simulation","title":"Simulate datasets with batch effect","text":"can simulate new data batch effect information. can also remove batch effect generate new data. , remove batch effect setting coefficient zero genes’ marginal fits. , use new sets coefficients generate parameters genes across cells. Additionally, can alter batch effect information mannually change estimated coefficient batch effect gene’s marginal model. , can simulate new dataset altered batch effect information. create three SingleCellExperiment objects using three count matrices generated store logcounts.","code":"set.seed(123) simu_res <- scdesign3(sce = example_sce,                                assay_use = \"counts\",                                celltype = \"cell_type\",                                pseudotime = NULL,                                spatial = NULL,                                other_covariates = c(\"batch\"),                                mu_formula = \"cell_type + batch\",                                sigma_formula = \"1\",                                family_use = \"nb\",                                n_cores = 2,                                usebam = FALSE,                                corr_formula = \"1\",                                copula = \"gaussian\",                                DT = TRUE,                                pseudo_obs = FALSE,                                return_model = FALSE) BATCH_data <- construct_data(   sce = example_sce,   assay_use = \"counts\",   celltype = \"cell_type\",   pseudotime = NULL,   spatial = NULL,   other_covariates = c(\"batch\"),   corr_by = \"1\" ) BATCH_marginal <- fit_marginal(   data = BATCH_data,   predictor = \"gene\",   mu_formula = \"cell_type + batch\",   sigma_formula = \"1\",   family_use = \"nb\",   n_cores = 2,   usebam = FALSE ) set.seed(123) BATCH_copula <- fit_copula(     sce = example_sce,     assay_use = \"counts\",     marginal_list = BATCH_marginal,     family_use = \"nb\",     copula = \"gaussian\",     n_cores = 2,     input_data = BATCH_data$dat   ) BATCH_marginal_null <- lapply(BATCH_marginal, function(x) {   x$fit$coefficients[length(x$fit$coefficients)] <- 0   x }) BATCH_para_null <- extract_para(     sce = example_sce,     marginal_list = BATCH_marginal_null,     n_cores = 2,     family_use = \"nb\",     new_covariate =  BATCH_data$newCovariate,     data = BATCH_data$dat   ) set.seed(123) BATCH_newcount_null <- simu_new(     sce = example_sce,     mean_mat = BATCH_para_null$mean_mat,     sigma_mat = BATCH_para_null$sigma_mat,     zero_mat = BATCH_para_null$zero_mat,     quantile_mat = NULL,     copula_list = BATCH_copula$copula_list,     n_cores = 2,     family_use = \"nb\",     input_data = BATCH_data$dat,     new_covariate = BATCH_data$newCovariate,     important_feature = BATCH_copula$important_feature,     filtered_gene = BATCH_data$filtered_gene   ) BATCH_marginal_alter <- lapply(BATCH_marginal, function(x) {   x$fit$coefficients[length(x$fit$coefficients)] <- rnorm(1, mean = 5, sd = 2)   x }) BATCH_para_alter <- extract_para(     sce = example_sce,     marginal_list = BATCH_marginal_alter,     n_cores = 2,     family_use = \"nb\",     new_covariate = BATCH_data$newCovariate,     data = BATCH_data$dat   ) set.seed(123) BATCH_newcount_alter <- simu_new(     sce = example_sce,     mean_mat = BATCH_para_alter$mean_mat,     sigma_mat = BATCH_para_alter$sigma_mat,     zero_mat = BATCH_para_alter$zero_mat,     quantile_mat = NULL,     copula_list = BATCH_copula$copula_list,     n_cores = 2,     family_use = \"nb\",     input_data = BATCH_data$dat,     new_covariate = BATCH_data$newCovariate,     important_feature = BATCH_copula$important_feature,     filtered_gene = BATCH_data$filtered_gene   ) simu_res_list <- lapply(list(simu_res$new_count, BATCH_newcount_null, BATCH_newcount_alter), function(x){   simu_sce <- SingleCellExperiment(list(counts = x), colData = BATCH_data$newCovariate)   logcounts(simu_sce) <- log1p(counts(simu_sce))   return(simu_sce) })"},{"path":"/articles/scDesign3-batchEffect-vignette.html","id":"visulization","dir":"Articles","previous_headings":"","what":"Visulization","title":"Simulate datasets with batch effect","text":"","code":"set.seed(123) compare_figure <- plot_reduceddim(ref_sce = example_sce,                                    sce_list = simu_res_list,                                    name_vec = c(\"Reference\", \"w/ Batch\", \"w/o Batch\",\"Aritifical Batch\"),                                   assay_use = \"logcounts\",                                    if_plot = TRUE,                                    color_by = \"cell_type\",                                    shape_by = \"batch\",                                   n_pc = 20) plot(compare_figure$p_umap)"},{"path":"/articles/scDesign3-batchEffect-vignette.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Simulate datasets with batch effect","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Ubuntu 20.04.6 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0 #>  #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Los_Angeles #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2 #>  [3] Biobase_2.60.0              GenomicRanges_1.52.0        #>  [5] GenomeInfoDb_1.36.1         IRanges_2.34.1              #>  [7] S4Vectors_0.38.1            BiocGenerics_0.46.0         #>  [9] MatrixGenerics_1.12.2       matrixStats_1.0.0           #> [11] ggplot2_3.4.2               scDesign3_0.99.6            #> [13] BiocStyle_2.28.0            #>  #> loaded via a namespace (and not attached): #>  [1] tidyselect_1.2.0        farver_2.1.1            dplyr_1.1.2             #>  [4] bitops_1.0-7            fastmap_1.1.1           RCurl_1.98-1.12         #>  [7] digest_0.6.33           lifecycle_1.0.3         survival_3.5-5          #> [10] gamlss.dist_6.0-5       magrittr_2.0.3          compiler_4.3.1          #> [13] rlang_1.1.1             sass_0.4.7              tools_4.3.1             #> [16] utf8_1.2.3              yaml_2.3.7              knitr_1.43              #> [19] labeling_0.4.2          askpass_1.1             S4Arrays_1.0.4          #> [22] mclust_6.0.0            reticulate_1.30         DelayedArray_0.26.6     #> [25] withr_2.5.0             purrr_1.0.1             desc_1.4.2              #> [28] grid_4.3.1              fansi_1.0.4             colorspace_2.1-0        #> [31] scales_1.2.1            MASS_7.3-60             cli_3.6.1               #> [34] mvtnorm_1.2-2           rmarkdown_2.23          crayon_1.5.2            #> [37] ragg_1.2.5              generics_0.1.3          umap_0.2.10.0           #> [40] RSpectra_0.16-1         cachem_1.0.8            stringr_1.5.0           #> [43] zlibbioc_1.46.0         splines_4.3.1           parallel_4.3.1          #> [46] BiocManager_1.30.21.1   XVector_0.40.0          vctrs_0.6.3             #> [49] Matrix_1.6-0            jsonlite_1.8.7          bookdown_0.34           #> [52] gamlss_5.4-12           irlba_2.3.5.1           systemfonts_1.0.4       #> [55] jquerylib_0.1.4         glue_1.6.2              pkgdown_2.0.7           #> [58] stringi_1.7.12          gtable_0.3.3            munsell_0.5.0           #> [61] tibble_3.2.1            pillar_1.9.0            htmltools_0.5.5         #> [64] openssl_2.1.0           gamlss.data_6.0-2       GenomeInfoDbData_1.2.10 #> [67] R6_2.5.1                textshaping_0.3.6       rprojroot_2.0.3         #> [70] evaluate_0.21           lattice_0.21-8          highr_0.10              #> [73] png_0.1-8               memoise_2.0.1           bslib_0.5.0             #> [76] Rcpp_1.0.11             nlme_3.1-162            mgcv_1.9-0              #> [79] xfun_0.39               fs_1.6.3                pkgconfig_2.0.3"},{"path":"/articles/scDesign3-clusterGOF-vignette.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Evaluate clustering goodness-of-fit by scDesign3","text":"tutorial, show use scDesign3 evaluate clustering goodness--fit different cell-type assignments. true labels unavailable little prior knowledge, scDesign3 BIC can serve unsupervised metric.","code":""},{"path":"/articles/scDesign3-clusterGOF-vignette.html","id":"read-in-the-reference-data","dir":"Articles","previous_headings":"","what":"Read in the reference data","title":"Evaluate clustering goodness-of-fit by scDesign3","text":"raw data R package DuoClustering2018 contain set datasets various clustering results. demonstration purpose, use Zhengmix4eq dataset package top 100 highly variable genes corresponding k-means clustering results k = \\(2 ,\\cdots, 10\\).","code":"Zhengmix4eq_sce <- get(\"sce_filteredExpr10_Zhengmix4eq\")(metadata = FALSE) res <- get(\"clustering_summary_filteredExpr10_Zhengmix4eq_v1\")(metadata = FALSE)    res_sub <- res %>% dplyr::filter(method %in% c(\"SC3\", \"Seurat\", \"PCAHC\", \"PCAKmeans\", \"CIDR\") & run == 1) res_sub_list <- res_sub %>% group_by(dataset, method, run, k, resolution) %>% group_split() kmeans_res <- Filter(function(x){all(x$method == \"PCAKmeans\")}, res_sub_list) ncell <- ncol(Zhengmix4eq_sce) ngene <- 100 zheng_sce <- modelGeneVar(Zhengmix4eq_sce) chosen <- getTopHVGs(zheng_sce, n = ngene) sce <- Zhengmix4eq_sce[chosen, ] ntrain <- round(ncell/2)    set.seed(123) train_index <- sample(seq_len(ncell), ntrain, replace = FALSE) train_sce <- sce[, train_index]"},{"path":"/articles/scDesign3-clusterGOF-vignette.html","id":"simulation","dir":"Articles","previous_headings":"","what":"Simulation","title":"Evaluate clustering goodness-of-fit by scDesign3","text":"use nine different cell-type clustering information (results k-means clustering k = \\(2, \\cdots, 10\\)) simulate nine synthetic datasets. code , iteratively run scDesign3, iteration, use different set k-means clustering labels celltype covariate.","code":"set.seed(123) scDesign3_result <- lapply(kmeans_res, function(x) {       dat <- x %>% dplyr::select(c(\"cell\", \"cluster\")) %>% data.frame()       rownames(dat) <- dat$cell       colData(train_sce)$cell_type <- factor(dat[colnames(train_sce), ]$cluster)       simu_sce <- scdesign3(sce = train_sce,                              celltype = 'cell_type',                              pseudotime = NULL,                              spatial = NULL,                              other_covariates = NULL,                              corr_formula = \"1\",                              mu_formula = \"cell_type\",                              sigma_formula = \"cell_type\",                              n_cores = 2,                              copula = \"gaussian\",                              assay_use = \"counts\",                              family_use = \"nb\")              simu_sce     })"},{"path":"/articles/scDesign3-clusterGOF-vignette.html","id":"visualization","dir":"Articles","previous_headings":"","what":"Visualization","title":"Evaluate clustering goodness-of-fit by scDesign3","text":"simulations, first extract scDesign3’s BIC, unsupervised metric evaluating goodness--fit clustering labels. Since also ground truth cell type labels DuoClustering2018, also calculate Adjusted Rand Index (ARI) using set clustering labels k-means clustering ground truth cell type labels. ARI supervised metric evaluate clustering qualities. figure demonstrates scDesign3’s BIC agrees ARI.","code":"bic_list <- lapply(scDesign3_result, function(x){return(x$model_bic)}) kmeans_ari <- sapply(kmeans_res, function(x){ARI(x$cluster, x$trueclass)}) bic_df <- data.frame(matrix(unlist(bic_list), nrow = length(bic_list), byrow = TRUE)) colnames(bic_df) <- names(bic_list[[1]]) rownames(bic_df) <- paste0(\"k = \", 2:10) bic_df #>        bic.marginal bic.copula bic.total #> k = 2      554744.7  -48866.61  505878.1 #> k = 3      508801.1  -15914.27  492886.9 #> k = 4      510224.3  -14764.58  495459.7 #> k = 5      508536.4  141223.68  649760.1 #> k = 6      490276.5   31747.20  522023.7 #> k = 7      498336.3  115753.31  614089.6 #> k = 8      500005.6  101529.59  601535.2 #> k = 9      496912.8  107714.86  604627.7 #> k = 10     492096.2  302639.74  794736.0 metric <- tibble(ari = kmeans_ari, bic = bic_df$bic.marginal, Method = paste0(\"k = \", 2:10)) p_cluster_metric <- metric %>% ggplot(aes(x =ari, y = bic,label = Method)) + geom_point() + theme_bw() + theme(aspect.ratio = 1,     panel.grid.minor = element_blank(),     panel.grid.major = element_blank()) + ggpubr::stat_cor(method = \"spearman\", cor.coef.name = \"rho\", label.x.npc = \"left\", label.y.npc = 0.5) + ylab(\"scDesign3 BIC\") + xlab(\"ARI\") p_cluster_metric"},{"path":"/articles/scDesign3-clusterGOF-vignette.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Evaluate clustering goodness-of-fit by scDesign3","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Ubuntu 20.04.6 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0 #>  #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Los_Angeles #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] ggplot2_3.4.2               aricode_1.0.2               #>  [3] scran_1.28.1                scuttle_1.10.1              #>  [5] SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2 #>  [7] Biobase_2.60.0              GenomicRanges_1.52.0        #>  [9] GenomeInfoDb_1.36.1         IRanges_2.34.1              #> [11] S4Vectors_0.38.1            BiocGenerics_0.46.0         #> [13] MatrixGenerics_1.12.2       matrixStats_1.0.0           #> [15] dplyr_1.1.2                 DuoClustering2018_1.18.0    #> [17] scDesign3_0.99.6            BiocStyle_2.28.0            #>  #> loaded via a namespace (and not attached): #>   [1] jsonlite_1.8.7                magrittr_2.0.3                #>   [3] farver_2.1.1                  rmarkdown_2.23                #>   [5] fs_1.6.3                      zlibbioc_1.46.0               #>   [7] ragg_1.2.5                    vctrs_0.6.3                   #>   [9] memoise_2.0.1                 DelayedMatrixStats_1.22.1     #>  [11] RCurl_1.98-1.12               rstatix_0.7.2                 #>  [13] htmltools_0.5.5               S4Arrays_1.0.4                #>  [15] AnnotationHub_3.8.0           curl_5.0.1                    #>  [17] broom_1.0.5                   BiocNeighbors_1.18.0          #>  [19] sass_0.4.7                    bslib_0.5.0                   #>  [21] desc_1.4.2                    plyr_1.8.8                    #>  [23] cachem_1.0.8                  igraph_1.5.0.1                #>  [25] mime_0.12                     lifecycle_1.0.3               #>  [27] pkgconfig_2.0.3               rsvd_1.0.5                    #>  [29] Matrix_1.6-0                  R6_2.5.1                      #>  [31] fastmap_1.1.1                 GenomeInfoDbData_1.2.10       #>  [33] shiny_1.7.4.1                 digest_0.6.33                 #>  [35] colorspace_2.1-0              AnnotationDbi_1.62.2          #>  [37] rprojroot_2.0.3               dqrng_0.3.0                   #>  [39] irlba_2.3.5.1                 ExperimentHub_2.8.1           #>  [41] textshaping_0.3.6             RSQLite_2.3.1                 #>  [43] ggpubr_0.6.0                  beachmat_2.16.0               #>  [45] labeling_0.4.2                filelock_1.0.2                #>  [47] fansi_1.0.4                   abind_1.4-5                   #>  [49] mgcv_1.9-0                    httr_1.4.6                    #>  [51] compiler_4.3.1                bit64_4.0.5                   #>  [53] withr_2.5.0                   backports_1.4.1               #>  [55] BiocParallel_1.34.2           carData_3.0-5                 #>  [57] viridis_0.6.4                 DBI_1.1.3                     #>  [59] highr_0.10                    ggsignif_0.6.4                #>  [61] MASS_7.3-60                   rappdirs_0.3.3                #>  [63] DelayedArray_0.26.6           bluster_1.10.0                #>  [65] tools_4.3.1                   interactiveDisplayBase_1.38.0 #>  [67] httpuv_1.6.11                 glue_1.6.2                    #>  [69] nlme_3.1-162                  promises_1.2.0.1              #>  [71] grid_4.3.1                    cluster_2.1.4                 #>  [73] reshape2_1.4.4                generics_0.1.3                #>  [75] gtable_0.3.3                  tidyr_1.3.0                   #>  [77] car_3.1-2                     metapod_1.8.0                 #>  [79] BiocSingular_1.16.0           ScaledMatrix_1.8.1            #>  [81] utf8_1.2.3                    XVector_0.40.0                #>  [83] BiocVersion_3.17.1            pillar_1.9.0                  #>  [85] stringr_1.5.0                 limma_3.56.2                  #>  [87] later_1.3.1                   splines_4.3.1                 #>  [89] BiocFileCache_2.8.0           lattice_0.21-8                #>  [91] survival_3.5-5                bit_4.0.5                     #>  [93] gamlss.data_6.0-2             tidyselect_1.2.0              #>  [95] locfit_1.5-9.8                Biostrings_2.68.1             #>  [97] knitr_1.43                    gridExtra_2.3                 #>  [99] bookdown_0.34                 edgeR_3.42.4                  #> [101] xfun_0.39                     statmod_1.5.0                 #> [103] stringi_1.7.12                yaml_2.3.7                    #> [105] evaluate_0.21                 codetools_0.2-19              #> [107] tibble_3.2.1                  BiocManager_1.30.21.1         #> [109] cli_3.6.1                     xtable_1.8-4                  #> [111] systemfonts_1.0.4             munsell_0.5.0                 #> [113] jquerylib_0.1.4               Rcpp_1.0.11                   #> [115] dbplyr_2.3.3                  png_0.1-8                     #> [117] parallel_4.3.1                ellipsis_0.3.2                #> [119] pkgdown_2.0.7                 blob_1.2.4                    #> [121] mclust_6.0.0                  sparseMatrixStats_1.12.2      #> [123] bitops_1.0-7                  gamlss.dist_6.0-5             #> [125] mvtnorm_1.2-2                 viridisLite_0.4.2             #> [127] ggthemes_4.2.4                scales_1.2.1                  #> [129] gamlss_5.4-12                 purrr_1.0.1                   #> [131] crayon_1.5.2                  rlang_1.1.1                   #> [133] KEGGREST_1.40.0"},{"path":"/articles/scDesign3-conditionEffect-vignette.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Simulate datasets with condition effect","text":"tutorial, show use scDesign3 simulate data condition effects adjust condition effects.","code":""},{"path":"/articles/scDesign3-conditionEffect-vignette.html","id":"read-in-the-reference-data","dir":"Articles","previous_headings":"","what":"Read in the reference data","title":"Simulate datasets with condition effect","text":"raw data SeuratData package. data called ifnb package; PBMC data simulated controlled IFNB. save computational time, use top 100 genes two cell types (CD14 Mono B). condition information stored colData example dataset.","code":"example_sce <- readRDS((url(\"https://figshare.com/ndownloader/files/40581977\"))) print(example_sce) #> class: SingleCellExperiment  #> dim: 1000 13999  #> metadata(0): #> assays(2): counts logcounts #> rownames(1000): FTL HBB ... AC022182.3 SCIN #> rowData names(0): #> colnames(13999): AAACATACATTTCC.1 AAACATACCAGAAA.1 ... TTTGCATGCTAAGC.1 #>   TTTGCATGGGACGA.1 #> colData names(8): orig.ident nCount_RNA ... cell_type condition #> reducedDimNames(0): #> mainExpName: RNA #> altExpNames(0): print(table(colData(example_sce)$cell_type)) #>  #>    CD14 Mono  CD4 Naive T CD4 Memory T    CD16 Mono            B        CD8 T  #>         4362         2504         1762         1044          978          814  #>  T activated           NK           DC  B Activated           Mk          pDC  #>          633          619          472          388          236          132  #>        Eryth  #>           55 example_sce <- example_sce[1:100, colData(example_sce)$cell_type %in% c(\"CD14 Mono\", \"B\")]  ## Remove unused cell type levels colData(example_sce)$cell_type <- droplevels(colData(example_sce)$cell_type) head(colData(example_sce)) #> DataFrame with 6 rows and 8 columns #>                   orig.ident nCount_RNA nFeature_RNA        stim #>                  <character>  <numeric>    <integer> <character> #> AAACATACATTTCC.1 IMMUNE_CTRL       3017          877        CTRL #> AAACATACCAGAAA.1 IMMUNE_CTRL       2481          713        CTRL #> AAACATACCTCGCT.1 IMMUNE_CTRL       3420          850        CTRL #> AAACATACGGCATT.1 IMMUNE_CTRL       1581          557        CTRL #> AAACATTGCTTCGC.1 IMMUNE_CTRL       2536          669        CTRL #> AAACGCACTCGCCT.1 IMMUNE_CTRL       3563          908        CTRL #>                  seurat_annotations       ident cell_type   condition #>                            <factor>    <factor>  <factor> <character> #> AAACATACATTTCC.1          CD14 Mono IMMUNE_CTRL CD14 Mono        CTRL #> AAACATACCAGAAA.1          CD14 Mono IMMUNE_CTRL CD14 Mono        CTRL #> AAACATACCTCGCT.1          CD14 Mono IMMUNE_CTRL CD14 Mono        CTRL #> AAACATACGGCATT.1          CD14 Mono IMMUNE_CTRL CD14 Mono        CTRL #> AAACATTGCTTCGC.1          CD14 Mono IMMUNE_CTRL CD14 Mono        CTRL #> AAACGCACTCGCCT.1          CD14 Mono IMMUNE_CTRL CD14 Mono        CTRL"},{"path":"/articles/scDesign3-conditionEffect-vignette.html","id":"simulation","dir":"Articles","previous_headings":"","what":"Simulation","title":"Simulate datasets with condition effect","text":"First, simulate new data condition effects. , can also simulate new dataset condition effects B cells removed. , condition effects B cells removed genes modifying estimated coefficients genes’ marginal models. , can generate parameters using altered marginal fits simulate new data altered paremeters. , can create SinglecellExperiment object using synthetic count matrix store logcounts input synthetic SinglecellExperiment objects.","code":"set.seed(123) simu_res <- scdesign3(     sce = example_sce,     assay_use = \"counts\",     celltype = \"cell_type\",     pseudotime = NULL,     spatial = NULL,     other_covariates = c(\"condition\"),     mu_formula = \"cell_type + condition + cell_type*condition\",     sigma_formula = \"1\",     family_use = \"nb\",     n_cores = 2,     usebam = FALSE,     corr_formula = \"cell_type\",     copula = \"gaussian\",     DT = TRUE,     pseudo_obs = FALSE,     return_model = FALSE,     nonzerovar = FALSE   ) IFNB_data <- construct_data(   sce = example_sce,   assay_use = \"counts\",   celltype = \"cell_type\",   pseudotime = NULL,   spatial = NULL,   other_covariates = c(\"condition\"),   corr_by = \"cell_type\" ) IFNB_marginal <- fit_marginal(   data = IFNB_data,   predictor = \"gene\",   mu_formula = \"cell_type + condition + cell_type*condition\",   sigma_formula = \"1\",   family_use = \"nb\",   n_cores = 2,   usebam = FALSE ) set.seed(123) IFNB_copula <- fit_copula(     sce = example_sce,     assay_use = \"counts\",     marginal_list = IFNB_marginal,     family_use = \"nb\",     copula = \"gaussian\",     n_cores = 2,     input_data = IFNB_data$dat   ) IFNB_marginal_null_B <- lapply(IFNB_marginal, function(x) {   x$fit$coefficients[\"cell_typeB:conditionSTIM\"] <- 0-x$fit$coefficients[\"conditionSTIM\"]   x }) IFNB_para_null_B <- extract_para(     sce = example_sce,     marginal_list = IFNB_marginal_null_B,     n_cores = 2,     family_use = \"nb\",     new_covariate = IFNB_data$newCovariate,     data = IFNB_data$dat   ) set.seed(123) IFNB_newcount_null_B <- simu_new(     sce = example_sce,     mean_mat = IFNB_para_null_B$mean_mat,     sigma_mat = IFNB_para_null_B$sigma_mat,     zero_mat = IFNB_para_null_B$zero_mat,     quantile_mat = NULL,     copula_list = IFNB_copula$copula_list,     n_cores = 2,     family_use = \"nb\",     input_data = IFNB_data$dat,     new_covariate = IFNB_data$newCovariate,     important_feature = IFNB_copula$important_feature,     filtered_gene = IFNB_data$filtered_gene   ) simu_res_list <- lapply(list(simu_res$new_count,IFNB_newcount_null_B), function(x){   simu_sce <- SingleCellExperiment(list(counts = x), colData = IFNB_data$newCovariate)   logcounts(simu_sce) <- log1p(counts(simu_sce))   return(simu_sce) }) logcounts(example_sce) <- log1p(counts(example_sce))"},{"path":"/articles/scDesign3-conditionEffect-vignette.html","id":"visulization","dir":"Articles","previous_headings":"","what":"Visulization","title":"Simulate datasets with condition effect","text":"","code":"set.seed(123) compare_figure <- plot_reduceddim(ref_sce = example_sce,                                    sce_list = simu_res_list,                                    name_vec = c(\"Reference\", \"w/ Condition\", \"Modified Condition\"),                                   assay_use = \"logcounts\",                                    if_plot = TRUE,                                    color_by = \"cell_type\",                                    shape_by = \"condition\",                                   n_pc = 20) plot(compare_figure$p_umap)"},{"path":"/articles/scDesign3-conditionEffect-vignette.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Simulate datasets with condition effect","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Ubuntu 20.04.6 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0 #>  #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Los_Angeles #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] ggplot2_3.4.2               SingleCellExperiment_1.22.0 #>  [3] SummarizedExperiment_1.30.2 Biobase_2.60.0              #>  [5] GenomicRanges_1.52.0        GenomeInfoDb_1.36.1         #>  [7] IRanges_2.34.1              S4Vectors_0.38.1            #>  [9] BiocGenerics_0.46.0         MatrixGenerics_1.12.2       #> [11] matrixStats_1.0.0           scDesign3_0.99.6            #> [13] BiocStyle_2.28.0            #>  #> loaded via a namespace (and not attached): #>  [1] tidyselect_1.2.0        farver_2.1.1            dplyr_1.1.2             #>  [4] bitops_1.0-7            fastmap_1.1.1           RCurl_1.98-1.12         #>  [7] digest_0.6.33           lifecycle_1.0.3         survival_3.5-5          #> [10] gamlss.dist_6.0-5       magrittr_2.0.3          compiler_4.3.1          #> [13] rlang_1.1.1             sass_0.4.7              tools_4.3.1             #> [16] utf8_1.2.3              yaml_2.3.7              knitr_1.43              #> [19] askpass_1.1             S4Arrays_1.0.4          labeling_0.4.2          #> [22] mclust_6.0.0            reticulate_1.30         DelayedArray_0.26.6     #> [25] withr_2.5.0             purrr_1.0.1             desc_1.4.2              #> [28] grid_4.3.1              fansi_1.0.4             colorspace_2.1-0        #> [31] scales_1.2.1            MASS_7.3-60             cli_3.6.1               #> [34] mvtnorm_1.2-2           rmarkdown_2.23          crayon_1.5.2            #> [37] ragg_1.2.5              generics_0.1.3          umap_0.2.10.0           #> [40] RSpectra_0.16-1         cachem_1.0.8            stringr_1.5.0           #> [43] zlibbioc_1.46.0         splines_4.3.1           parallel_4.3.1          #> [46] BiocManager_1.30.21.1   XVector_0.40.0          vctrs_0.6.3             #> [49] Matrix_1.6-0            jsonlite_1.8.7          bookdown_0.34           #> [52] gamlss_5.4-12           irlba_2.3.5.1           systemfonts_1.0.4       #> [55] jquerylib_0.1.4         glue_1.6.2              pkgdown_2.0.7           #> [58] stringi_1.7.12          gtable_0.3.3            munsell_0.5.0           #> [61] tibble_3.2.1            pillar_1.9.0            htmltools_0.5.5         #> [64] openssl_2.1.0           gamlss.data_6.0-2       GenomeInfoDbData_1.2.10 #> [67] R6_2.5.1                textshaping_0.3.6       rprojroot_2.0.3         #> [70] evaluate_0.21           lattice_0.21-8          highr_0.10              #> [73] png_0.1-8               memoise_2.0.1           bslib_0.5.0             #> [76] Rcpp_1.0.11             nlme_3.1-162            mgcv_1.9-0              #> [79] xfun_0.39               fs_1.6.3                pkgconfig_2.0.3"},{"path":"/articles/scDesign3-copulaCompare-vignette.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Compare gaussian copula and vine copula","text":"tutorial, show differences using Gaussian copula vine copula simulate new data. Vine copula can better estimate high-dimensional gene-gene correlation, however, simulation vine copula takes time Gaussian copula. reference dataset 1000 genes, recommend simulate data Gaussian copula.","code":""},{"path":"/articles/scDesign3-copulaCompare-vignette.html","id":"read-in-the-reference-data","dir":"Articles","previous_headings":"","what":"Read in the reference data","title":"Compare gaussian copula and vine copula","text":"raw data R package DuoClustering2018. demonstration purpose, use Zhengmix4eq dataset package top 100 highly variable genes. filtered highly expressed housekeeping genes added TF genes.","code":"Zhengmix4eq_sce <- get(paste0(\"sce_filteredExpr10_\", \"Zhengmix4eq\"))(metadata = FALSE) rownames(Zhengmix4eq_sce) <- rowData(Zhengmix4eq_sce)$symbol colData(Zhengmix4eq_sce)$cell_type <- colData(Zhengmix4eq_sce)$phenoid humantfs <- read_csv(\"http://humantfs.ccbr.utoronto.ca/download/v_1.01/TF_names_v_1.01.txt\", col_names = FALSE) stats <- modelGeneVar(Zhengmix4eq_sce) chosen <- getTopHVGs(stats, n = 100) ### Filter out some HKGs. chosen <- union(chosen, humantfs$X1) chosen <- chosen[!stringr::str_starts(chosen, \"RP\")] chosen <- chosen[!stringr::str_starts(chosen, \"TMSB\")] chosen <- chosen[!chosen %in% c(\"B2M\", \"MALAT1\", \"ACTB\", \"ACTG1\", \"GAPDH\", \"FTL\", \"FTH1\")] Zhengmix4eq_sce_sub <- Zhengmix4eq_sce[rownames(Zhengmix4eq_sce) %in% chosen, ] print(Zhengmix4eq_sce_sub) #> class: SingleCellExperiment  #> dim: 119 3555  #> metadata(1): log.exprs.offset #> assays(3): counts logcounts normcounts #> rownames(119): TPT1 CD74 ... PHF1 IRF7 #> rowData names(10): id symbol ... total_counts log10_total_counts #> colnames(3555): b.cells6276 b.cells6144 ... regulatory.t1084 #>   regulatory.t9696 #> colData names(16): dataset barcode ... sizeFactor cell_type #> reducedDimNames(2): PCA TSNE #> mainExpName: NULL #> altExpNames(0):"},{"path":"/articles/scDesign3-copulaCompare-vignette.html","id":"simulation","dir":"Articles","previous_headings":"","what":"Simulation","title":"Compare gaussian copula and vine copula","text":"use scdesign3 simulate two new datasets using Gaussian copula vine copula respectively.","code":"set.seed(123) Zhengmix4eq_simu_sce_gaussian <- scdesign3(sce = Zhengmix4eq_sce_sub,                             celltype = 'cell_type',                             pseudotime = NULL,                             spatial = NULL,                             other_covariates = NULL,                             corr_formula = \"cell_type\",                             mu_formula = \"cell_type\",                             sigma_formula = \"cell_type\",                             n_cores = 2,                             copula = \"gaussian\",                             assay_use = \"normcounts\",                             family_use = \"nb\",                             pseudo_obs = TRUE, return_model = TRUE) set.seed(123) Zhengmix4eq_simu_sce_vine <- scdesign3(sce = Zhengmix4eq_sce_sub,                             celltype = 'cell_type',                             pseudotime = NULL,                             spatial = NULL,                             other_covariates = NULL,                             corr_formula = \"cell_type\",                             mu_formula = \"cell_type\",                             sigma_formula = \"cell_type\",                             n_cores = 2,                             copula = \"vine\",                             assay_use = \"normcounts\",                             family_use = \"nb\",                             pseudo_obs = TRUE, return_model = TRUE)"},{"path":"/articles/scDesign3-copulaCompare-vignette.html","id":"visualization","dir":"Articles","previous_headings":"","what":"Visualization","title":"Compare gaussian copula and vine copula","text":"simulation result using Gaussian copula, return object contains corr_list gene-gene correlation matrices group user specified, case, groups cell types. simulation result using vine copula, corr_list gives vine structure group user specified, case, groups cell types. reformat two corr_list visualize . first visualize corr_list returned use Gaussian copula.  visualize corr_list returned use vine copula. Comparing visualization , plots give direct visualization genes connected vine structure show gene networks.","code":"Zhengmix4eq_corr_list <- Zhengmix4eq_simu_sce_gaussian$corr_list  names(Zhengmix4eq_corr_list) <- c(\"b.cells\", \"naive.cytotoxic\", \"cd14.monocytes\", \"regulatory.t\")  heatmap_order <- order(rowData(Zhengmix4eq_sce_sub)$mean_counts)  Zhengmix4eq_corr_list <- lapply(Zhengmix4eq_corr_list, function(x) {   x <- x[heatmap_order, heatmap_order]   x })    cor_melted <- lapply(Zhengmix4eq_corr_list, reshape2::melt)   cor_dat <- Reduce(rbind, cor_melted)   cor_dat$Method <- Reduce(c, lapply(c(\"b.cells\", \"naive.cytotoxic\", \"cd14.monocytes\", \"regulatory.t\"), function(x){     rep(x, nrow(cor_melted[[x]]))   }))   cor_dat$Method <- factor(cor_dat$Method, levels = c(\"cd14.monocytes\",  \"b.cells\",\"regulatory.t\",  \"naive.cytotoxic\")) cor_dat <- cor_dat %>% dplyr::mutate(Method = if_else(Method == \"b.cells\", \"B cell\", if_else(Method == \"cd14.monocytes\", \"CD14+ monocyte\", if_else(Method == \"regulatory.t\", \"Regulatory T cell\", \"Naive cytotoxic T cell\")))) %>% dplyr::mutate(Method = factor(Method, levels = c(\"CD14+ monocyte\", \"B cell\", \"Regulatory T cell\", \"Naive cytotoxic T cell\"))) corr_p <- cor_dat %>% ggplot(                         aes(Var2, Var1, fill = value))+       facet_wrap(~Method, nrow = 1) + #, labeller = label_parsed       geom_tile() +       scale_fill_gradient2(low = \"blue\", high = \"red\", mid = \"white\",                            midpoint = 0, limit = c(-1, 1), space = \"Lab\",                            name=\"Pearson\\nCorrelation\") +       theme(panel.spacing.x=unit(0, \"lines\"),panel.spacing.y=unit(1, \"lines\"),         legend.position = \"right\",         panel.border = element_rect(colour = \"black\", fill=NA, size=0.5),             axis.text.x = element_blank(),             axis.ticks.x = element_blank(),             axis.text.y = element_blank(),             axis.ticks.y = element_blank())+       xlab(\"\") + ylab(\"\") + coord_fixed() corr_p vine_list <- Zhengmix4eq_simu_sce_vine$corr_list plt1 <- plot(vine_list[[3]], tree = 1, var_names = \"use\")+ theme(aspect.ratio = 1, title = element_blank()) plt2 <- plot(vine_list[[1]], tree = 1, var_names = \"use\")+ theme(aspect.ratio = 1, title = element_blank()) plt3 <- plot(vine_list[[4]], tree = 1, var_names = \"use\")+ theme(aspect.ratio = 1, title = element_blank()) plt4 <- plot(vine_list[[2]], tree = 1, var_names = \"use\")+ theme(aspect.ratio = 1, title = element_blank()) degree_thresh <- 3  igr_obj1 <- get(\"g\", plt1$plot_env)[[1]]  p1 <- ggraph::ggraph(igr_obj1, \"igraph\",       algorithm = \"tree\", circular = TRUE     ) + ggraph::geom_edge_link(colour = \"#C0C0C0\")+       ggraph::geom_node_point(col = \"#56B4E9\", size = 2) +       ggplot2::theme_void()+ ggraph::geom_node_text(ggplot2::aes(filter = igraph::degree(igr_obj1) > degree_thresh, label = name),         fontface = \"bold\",         repel = TRUE, check_overlap = TRUE, size = 3       )+ theme(aspect.ratio = 1,                 panel.background = element_blank(),         panel.grid.major = element_blank(),         panel.grid.minor = element_blank(),         axis.line = element_line(colour = \"black\"),         panel.border = element_rect(colour = \"black\", fill=NA, size=1))  igr_obj2 <- get(\"g\", plt2$plot_env)[[1]]  p2 <- ggraph::ggraph(igr_obj2, \"igraph\",       algorithm = \"tree\", circular = TRUE     ) + ggraph::geom_edge_link(colour = \"#C0C0C0\")+       ggraph::geom_node_point(col = \"#56B4E9\", size = 2) +       ggplot2::theme_void()+ ggraph::geom_node_text(ggplot2::aes(filter = igraph::degree(igr_obj2) > degree_thresh, label = name),         fontface = \"bold\",         repel = TRUE, check_overlap = TRUE, size = 3       )+ theme(aspect.ratio = 1,                 panel.background = element_blank(),         panel.grid.major = element_blank(),         panel.grid.minor = element_blank(),         axis.line = element_line(colour = \"black\"),         panel.border = element_rect(colour = \"black\", fill=NA, size=1))  igr_obj3 <- get(\"g\", plt3$plot_env)[[1]]  p3 <- ggraph::ggraph(igr_obj3, \"igraph\",       algorithm = \"tree\", circular = TRUE     ) + ggraph::geom_edge_link(colour = \"#C0C0C0\")+       ggraph::geom_node_point(col = \"#56B4E9\", size = 2) +       ggplot2::theme_void()+ ggraph::geom_node_text(ggplot2::aes(filter = igraph::degree(igr_obj3) > degree_thresh, label = name),         fontface = \"bold\",         repel = TRUE, check_overlap = TRUE, size = 3       )+ theme(aspect.ratio = 1,                 panel.background = element_blank(),         panel.grid.major = element_blank(),         panel.grid.minor = element_blank(),         axis.line = element_line(colour = \"black\"),         panel.border = element_rect(colour = \"black\", fill=NA, size=1))  igr_obj4 <- get(\"g\", plt4$plot_env)[[1]]  p4 <- ggraph::ggraph(igr_obj4, \"igraph\",       algorithm = \"tree\", circular = TRUE     ) + ggraph::geom_edge_link(colour = \"#C0C0C0\")+       ggraph::geom_node_point(col = \"#56B4E9\", size = 2) +       ggplot2::theme_void()+ ggraph::geom_node_text(ggplot2::aes(filter = igraph::degree(igr_obj4) > degree_thresh, label = name),         fontface = \"bold\",         repel = TRUE, check_overlap = TRUE, size = 3       ) + theme(aspect.ratio = 1,                 panel.background = element_blank(),         panel.grid.major = element_blank(),         panel.grid.minor = element_blank(),         axis.line = element_line(colour = \"black\"),         panel.border = element_rect(colour = \"black\", fill=NA, size=0.5)) vine_dat <- list(igr_obj1, igr_obj2, igr_obj3, igr_obj4) p_vine <- cowplot::plot_grid(p1 + ggtitle(\"CD14+ monocyte\"), p2 + ggtitle(\"B cell\"), p3 + ggtitle(\"Regulatory T cell\"), p4 + ggtitle(\"Naive cytotoxic T cell\"), nrow = 1, align = \"hv\") p_vine"},{"path":"/articles/scDesign3-copulaCompare-vignette.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Compare gaussian copula and vine copula","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Ubuntu 20.04.6 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0 #>  #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Los_Angeles #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] rvinecopulib_0.6.3.1.1      lubridate_1.9.2             #>  [3] forcats_1.0.0               stringr_1.5.0               #>  [5] purrr_1.0.1                 readr_2.1.4                 #>  [7] tidyr_1.3.0                 tibble_3.2.1                #>  [9] tidyverse_2.0.0             igraph_1.5.0.1              #> [11] dplyr_1.1.2                 scran_1.28.1                #> [13] ggrepel_0.9.3               tidygraph_1.2.3             #> [15] scater_1.28.0               ggplot2_3.4.2               #> [17] scuttle_1.10.1              SingleCellExperiment_1.22.0 #> [19] SummarizedExperiment_1.30.2 Biobase_2.60.0              #> [21] GenomicRanges_1.52.0        GenomeInfoDb_1.36.1         #> [23] IRanges_2.34.1              S4Vectors_0.38.1            #> [25] BiocGenerics_0.46.0         MatrixGenerics_1.12.2       #> [27] matrixStats_1.0.0           DuoClustering2018_1.18.0    #> [29] scDesign3_0.99.6            BiocStyle_2.28.0            #>  #> loaded via a namespace (and not attached): #>   [1] splines_4.3.1                 later_1.3.1                   #>   [3] bitops_1.0-7                  filelock_1.0.2                #>   [5] polyclip_1.10-4               gamlss.data_6.0-2             #>   [7] lifecycle_1.0.3               edgeR_3.42.4                  #>   [9] rprojroot_2.0.3               lattice_0.21-8                #>  [11] vroom_1.6.3                   MASS_7.3-60                   #>  [13] magrittr_2.0.3                limma_3.56.2                  #>  [15] sass_0.4.7                    rmarkdown_2.23                #>  [17] jquerylib_0.1.4               yaml_2.3.7                    #>  [19] metapod_1.8.0                 httpuv_1.6.11                 #>  [21] cowplot_1.1.1                 DBI_1.1.3                     #>  [23] zlibbioc_1.46.0               ggraph_2.1.0                  #>  [25] kde1d_1.0.5                   RCurl_1.98-1.12               #>  [27] tweenr_2.0.2                  rappdirs_0.3.3                #>  [29] GenomeInfoDbData_1.2.10       irlba_2.3.5.1                 #>  [31] dqrng_0.3.0                   pkgdown_2.0.7                 #>  [33] DelayedMatrixStats_1.22.1     codetools_0.2-19              #>  [35] DelayedArray_0.26.6           ggforce_0.4.1                 #>  [37] tidyselect_1.2.0              farver_2.1.1                  #>  [39] randtoolbox_2.0.4             ScaledMatrix_1.8.1            #>  [41] viridis_0.6.4                 BiocFileCache_2.8.0           #>  [43] jsonlite_1.8.7                BiocNeighbors_1.18.0          #>  [45] ellipsis_0.3.2                survival_3.5-5                #>  [47] systemfonts_1.0.4             tools_4.3.1                   #>  [49] ragg_1.2.5                    Rcpp_1.0.11                   #>  [51] glue_1.6.2                    gridExtra_2.3                 #>  [53] xfun_0.39                     mgcv_1.9-0                    #>  [55] ggthemes_4.2.4                withr_2.5.0                   #>  [57] BiocManager_1.30.21.1         fastmap_1.1.1                 #>  [59] bluster_1.10.0                fansi_1.0.4                   #>  [61] digest_0.6.33                 rsvd_1.0.5                    #>  [63] gamlss_5.4-12                 timechange_0.2.0              #>  [65] R6_2.5.1                      mime_0.12                     #>  [67] textshaping_0.3.6             colorspace_2.1-0              #>  [69] RSQLite_2.3.1                 utf8_1.2.3                    #>  [71] generics_0.1.3                graphlayouts_1.0.0            #>  [73] httr_1.4.6                    S4Arrays_1.0.4                #>  [75] rngWELL_0.10-9                pkgconfig_2.0.3               #>  [77] gtable_0.3.3                  blob_1.2.4                    #>  [79] XVector_0.40.0                htmltools_0.5.5               #>  [81] bookdown_0.34                 scales_1.2.1                  #>  [83] png_0.1-8                     knitr_1.43                    #>  [85] tzdb_0.4.0                    reshape2_1.4.4                #>  [87] nlme_3.1-162                  curl_5.0.1                    #>  [89] cachem_1.0.8                  BiocVersion_3.17.1            #>  [91] parallel_4.3.1                vipor_0.4.5                   #>  [93] AnnotationDbi_1.62.2          desc_1.4.2                    #>  [95] pillar_1.9.0                  grid_4.3.1                    #>  [97] vctrs_0.6.3                   promises_1.2.0.1              #>  [99] BiocSingular_1.16.0           dbplyr_2.3.3                  #> [101] beachmat_2.16.0               xtable_1.8-4                  #> [103] cluster_2.1.4                 beeswarm_0.4.0                #> [105] gamlss.dist_6.0-5             evaluate_0.21                 #> [107] mvtnorm_1.2-2                 cli_3.6.1                     #> [109] locfit_1.5-9.8                compiler_4.3.1                #> [111] rlang_1.1.1                   crayon_1.5.2                  #> [113] labeling_0.4.2                mclust_6.0.0                  #> [115] plyr_1.8.8                    fs_1.6.3                      #> [117] ggbeeswarm_0.7.2              stringi_1.7.12                #> [119] viridisLite_0.4.2             BiocParallel_1.34.2           #> [121] assertthat_0.2.1              munsell_0.5.0                 #> [123] Biostrings_2.68.1             Matrix_1.6-0                  #> [125] ExperimentHub_2.8.1           hms_1.1.3                     #> [127] sparseMatrixStats_1.12.2      bit64_4.0.5                   #> [129] KEGGREST_1.40.0               statmod_1.5.0                 #> [131] shiny_1.7.4.1                 highr_0.10                    #> [133] interactiveDisplayBase_1.38.0 AnnotationHub_3.8.0           #> [135] memoise_2.0.1                 bslib_0.5.0                   #> [137] bit_4.0.5"},{"path":"/articles/scDesign3-introduction-vignette.html","id":"read-in-the-reference-data","dir":"Articles","previous_headings":"","what":"Read in the reference data","title":"scDesign3 Introduction","text":"raw data scvelo, describes pancreatic endocrinogenesis. pre-select top 1000 highly variable genes filter cell types ensure single trajectory. save computational time, use top 100 genes.","code":"example_sce <- readRDS((url(\"https://figshare.com/ndownloader/files/40581992\"))) print(example_sce) #> class: SingleCellExperiment  #> dim: 1000 2087  #> metadata(5): clusters_coarse_colors clusters_colors day_colors #>   neighbors pca #> assays(6): X spliced ... cpm logcounts #> rownames(1000): Pyy Iapp ... Eya2 Kif21a #> rowData names(1): highly_variable_genes #> colnames(2087): AAACCTGAGAGGGATA AAACCTGGTAAGTGGC ... TTTGTCAAGTGACATA #>   TTTGTCAAGTGTGGCA #> colData names(7): clusters_coarse clusters ... sizeFactor pseudotime #> reducedDimNames(4): X_pca X_umap PCA UMAP #> mainExpName: NULL #> altExpNames(0): example_sce <- example_sce[1:100, ]"},{"path":"/articles/scDesign3-introduction-vignette.html","id":"simulation","dir":"Articles","previous_headings":"","what":"Simulation","title":"scDesign3 Introduction","text":"function scdesign3() one-shot function can generate new dataset. create SingleCellExperiment objects using new count matrix generated store logcounts.","code":"set.seed(123) example_simu <- scdesign3(     sce = example_sce,     assay_use = \"counts\",     celltype = \"cell_type\",     pseudotime = \"pseudotime\",     spatial = NULL,     other_covariates = NULL,     mu_formula = \"s(pseudotime, k = 10, bs = 'cr')\",     sigma_formula = \"s(pseudotime, k = 5, bs = 'cr')\",     family_use = \"nb\",     n_cores = 2,     usebam = FALSE,     corr_formula = \"1\",     copula = \"gaussian\",     DT = TRUE,     pseudo_obs = FALSE,     return_model = FALSE,     nonzerovar = FALSE   ) logcounts(example_sce) <- log1p(counts(example_sce)) simu_sce <- SingleCellExperiment(list(counts = example_simu$new_count), colData = example_simu$new_covariate) logcounts(simu_sce) <- log1p(counts(simu_sce))"},{"path":"/articles/scDesign3-introduction-vignette.html","id":"visualization","dir":"Articles","previous_headings":"","what":"Visualization","title":"scDesign3 Introduction","text":"","code":"set.seed(123) compare_figure <- plot_reduceddim(ref_sce = example_sce,                                    sce_list = list(simu_sce),                                    name_vec = c(\"Reference\", \"scDesign3\"),                                   assay_use = \"logcounts\",                                    if_plot = TRUE,                                    color_by = \"pseudotime\",                                    n_pc = 20) plot(compare_figure$p_umap)"},{"path":"/articles/scDesign3-introduction-vignette.html","id":"step-by-step-functions","dir":"Articles","previous_headings":"","what":"Step-by-step functions","title":"scDesign3 Introduction","text":"Alternatively, can run following steps generate new dataset. code exactly thing one-shot function . Construct input dataset. Fit regression models feature based specification. Fit copula, obtain AIC BIC. Extract estimated parameters can make modifications use modified parameters generate new data needed. can extract following parameters: cell--gene mean matrix cell--gene matrix \\(\\frac{1}{\\phi}\\) negative binomial distribution cell--gene matrix standard deviation \\(\\sigma\\) Gaussian distribution cell--gene matrix 1 poisson distribution cell--gene matrix zero probabilities zero-inflated negative binomial zero-inflated poisson distributions zero matrix negative binomial, Gaussian, poisson distributions Simulate new count matrix. , can create SinglecellExperiment object using synthetic count matrix store logcounts input synthetic SinglecellExperiment objects.","code":"PANCREAS_data <- construct_data(     sce = example_sce,     assay_use = \"counts\",     celltype = \"cell_type\",     pseudotime = \"pseudotime\",     spatial = NULL,     other_covariates = NULL,     corr_by = \"1\"   ) PANCREAS_marginal <- fit_marginal(     data = PANCREAS_data,     predictor = \"gene\",     mu_formula = \"s(pseudotime, k = 10, bs = 'cr')\",     sigma_formula = \"s(pseudotime, k = 5, bs = 'cr')\",     family_use = \"nb\",     n_cores = 2,     usebam = FALSE   ) set.seed(123) PANCREAS_copula <- fit_copula(     sce = example_sce,     assay_use = \"counts\",     marginal_list = PANCREAS_marginal,     family_use = \"nb\",     copula = \"gaussian\",     n_cores = 2,     input_data = PANCREAS_data$dat,     important_feature = \"auto\"   ) PANCREAS_para <- extract_para(     sce = example_sce,     marginal_list = PANCREAS_marginal,     n_cores = 1,     family_use = \"nb\",     new_covariate = NULL,     data = PANCREAS_data$dat   ) set.seed(123)  PANCREAS_newcount <- simu_new(     sce = example_sce,     mean_mat = PANCREAS_para$mean_mat,     sigma_mat = PANCREAS_para$sigma_mat,     zero_mat = PANCREAS_para$zero_mat,     quantile_mat = NULL,     copula_list = PANCREAS_copula$copula_list,     n_cores = 1,     family_use = \"nb\",     input_data = PANCREAS_data$dat,     new_covariate = PANCREAS_data$newCovariate,     important_feature = PANCREAS_copula$important_feature,     filtered_gene = PANCREAS_data$filtered_gene   ) simu_sce <- SingleCellExperiment(list(counts = PANCREAS_newcount), colData = PANCREAS_data$newCovariate) logcounts(simu_sce) <- log1p(counts(simu_sce))"},{"path":"/articles/scDesign3-introduction-vignette.html","id":"visualization-1","dir":"Articles","previous_headings":"","what":"Visualization","title":"scDesign3 Introduction","text":"","code":"set.seed(123) compare_figure <- plot_reduceddim(ref_sce = example_sce,                                    sce_list = list(simu_sce),                                    name_vec = c(\"Reference\", \"scDesign3\"),                                   assay_use = \"logcounts\",                                    if_plot = TRUE,                                    color_by = \"pseudotime\",                                    n_pc = 20) plot(compare_figure$p_umap)"},{"path":"/articles/scDesign3-introduction-vignette.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"scDesign3 Introduction","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Ubuntu 20.04.6 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0 #>  #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Los_Angeles #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2 #>  [3] Biobase_2.60.0              GenomicRanges_1.52.0        #>  [5] GenomeInfoDb_1.36.1         IRanges_2.34.1              #>  [7] S4Vectors_0.38.1            BiocGenerics_0.46.0         #>  [9] MatrixGenerics_1.12.2       matrixStats_1.0.0           #> [11] ggplot2_3.4.2               scDesign3_0.99.6            #> [13] BiocStyle_2.28.0            #>  #> loaded via a namespace (and not attached): #>  [1] tidyselect_1.2.0        viridisLite_0.4.2       farver_2.1.1            #>  [4] dplyr_1.1.2             viridis_0.6.4           bitops_1.0-7            #>  [7] fastmap_1.1.1           RCurl_1.98-1.12         digest_0.6.33           #> [10] lifecycle_1.0.3         survival_3.5-5          gamlss.dist_6.0-5       #> [13] magrittr_2.0.3          compiler_4.3.1          rlang_1.1.1             #> [16] sass_0.4.7              tools_4.3.1             utf8_1.2.3              #> [19] yaml_2.3.7              knitr_1.43              labeling_0.4.2          #> [22] askpass_1.1             S4Arrays_1.0.4          mclust_6.0.0            #> [25] reticulate_1.30         DelayedArray_0.26.6     withr_2.5.0             #> [28] purrr_1.0.1             desc_1.4.2              grid_4.3.1              #> [31] fansi_1.0.4             colorspace_2.1-0        scales_1.2.1            #> [34] MASS_7.3-60             cli_3.6.1               mvtnorm_1.2-2           #> [37] rmarkdown_2.23          crayon_1.5.2            ragg_1.2.5              #> [40] generics_0.1.3          umap_0.2.10.0           RSpectra_0.16-1         #> [43] cachem_1.0.8            stringr_1.5.0           zlibbioc_1.46.0         #> [46] splines_4.3.1           parallel_4.3.1          BiocManager_1.30.21.1   #> [49] XVector_0.40.0          vctrs_0.6.3             Matrix_1.6-0            #> [52] jsonlite_1.8.7          bookdown_0.34           gamlss_5.4-12           #> [55] irlba_2.3.5.1           systemfonts_1.0.4       jquerylib_0.1.4         #> [58] glue_1.6.2              pkgdown_2.0.7           stringi_1.7.12          #> [61] gtable_0.3.3            munsell_0.5.0           tibble_3.2.1            #> [64] pillar_1.9.0            htmltools_0.5.5         openssl_2.1.0           #> [67] gamlss.data_6.0-2       GenomeInfoDbData_1.2.10 R6_2.5.1                #> [70] textshaping_0.3.6       rprojroot_2.0.3         evaluate_0.21           #> [73] lattice_0.21-8          highr_0.10              png_0.1-8               #> [76] memoise_2.0.1           bslib_0.5.0             Rcpp_1.0.11             #> [79] gridExtra_2.3           nlme_3.1-162            mgcv_1.9-0              #> [82] xfun_0.39               fs_1.6.3                pkgconfig_2.0.3"},{"path":"/articles/scDesign3-librarySize-vignette.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Simulate datasets with cell library size","text":"tutorial, show use scDesign3 simulate datasets adjusted cell library size. purpose tutorial show including library size modeling marginal distribution gene can help cells synthetic data similar library sizes cells real data.","code":""},{"path":"/articles/scDesign3-librarySize-vignette.html","id":"read-in-the-reference-data","dir":"Articles","previous_headings":"","what":"Read in the reference data","title":"Simulate datasets with cell library size","text":"raw data R package DuoClustering2018 contain set datasets true cell type labels. calculate library size cell.","code":"sce <- get(\"sce_filteredExpr10_Zhengmix4eq\")(metadata = FALSE) colData(sce)$cell_type = as.factor(colData(sce)$phenoid) colData(sce)$library = colSums(counts(sce))"},{"path":"/articles/scDesign3-librarySize-vignette.html","id":"simulation","dir":"Articles","previous_headings":"","what":"Simulation","title":"Simulate datasets with cell library size","text":", set mu_formula cell_type offsetted cell library size generate new dataset adjusted library size. library size log-transformed link function \\(\\mu\\) negative binomial distribution GAMLSS \\(\\log\\). , can create SinglecellExperiment object using synthetic count matrix store logcounts input synthetic SinglecellExperiment objects.","code":"set.seed(123) example_simu <- scdesign3(     sce = sce,     assay_use = \"counts\",     celltype = \"cell_type\",     pseudotime = NULL,     spatial = NULL,     other_covariates = \"library\",     mu_formula = \"cell_type + offset(log(library))\",     sigma_formula = \"1\",     family_use = \"nb\",     n_cores = 2,     usebam = FALSE,     corr_formula = \"1\",     copula = \"gaussian\",     DT = TRUE,     pseudo_obs = FALSE,     return_model = FALSE,     nonzerovar = FALSE,     parallelization = \"pbmcmapply\",     important_feature = \"auto\"   ) logcounts(sce) <- log1p(counts(sce)) simu_sce <- SingleCellExperiment(list(counts = example_simu$new_count), colData = example_simu$new_covariate) logcounts(simu_sce) <- log1p(counts(simu_sce)) colData(simu_sce)$library <- colSums(counts(simu_sce))"},{"path":"/articles/scDesign3-librarySize-vignette.html","id":"visualization","dir":"Articles","previous_headings":"","what":"Visualization","title":"Simulate datasets with cell library size","text":"violin plot shows cells simulated dataset similar library size cells reference dataset.","code":"set.seed(123) compare_figure <- plot_reduceddim(ref_sce = sce,                                    sce_list = list(simu_sce),                                    name_vec = c(\"Reference\", \"scDesign3\"),                                   assay_use = \"logcounts\",                                    if_plot = TRUE,                                    color_by = \"cell_type\",                                    n_pc = 20) plot(compare_figure$p_umap) df1 = colData(sce) %>% as_tibble() %>% select(library) %>% mutate(Method = \"Reference\") df2 = colData(simu_sce) %>% as_tibble()  %>% select(library) %>% mutate(Method = \"scDesign3\") df = rbind(df1,df2) ggplot(df, aes(x = Method, y = library, color = Method)) +      geom_violin() + theme(aspect.ratio=1)"},{"path":"/articles/scDesign3-librarySize-vignette.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Simulate datasets with cell library size","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Ubuntu 20.04.6 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0 #>  #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Los_Angeles #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] lubridate_1.9.2             forcats_1.0.0               #>  [3] stringr_1.5.0               dplyr_1.1.2                 #>  [5] purrr_1.0.1                 readr_2.1.4                 #>  [7] tidyr_1.3.0                 tibble_3.2.1                #>  [9] tidyverse_2.0.0             scran_1.28.1                #> [11] scuttle_1.10.1              DuoClustering2018_1.18.0    #> [13] ggplot2_3.4.2               SingleCellExperiment_1.22.0 #> [15] SummarizedExperiment_1.30.2 Biobase_2.60.0              #> [17] GenomicRanges_1.52.0        GenomeInfoDb_1.36.1         #> [19] IRanges_2.34.1              S4Vectors_0.38.1            #> [21] BiocGenerics_0.46.0         MatrixGenerics_1.12.2       #> [23] matrixStats_1.0.0           scDesign3_0.99.6            #> [25] BiocStyle_2.28.0            #>  #> loaded via a namespace (and not attached): #>   [1] jsonlite_1.8.7                umap_0.2.10.0                 #>   [3] magrittr_2.0.3                farver_2.1.1                  #>   [5] rmarkdown_2.23                fs_1.6.3                      #>   [7] zlibbioc_1.46.0               ragg_1.2.5                    #>   [9] vctrs_0.6.3                   memoise_2.0.1                 #>  [11] DelayedMatrixStats_1.22.1     RCurl_1.98-1.12               #>  [13] askpass_1.1                   htmltools_0.5.5               #>  [15] S4Arrays_1.0.4                AnnotationHub_3.8.0           #>  [17] curl_5.0.1                    BiocNeighbors_1.18.0          #>  [19] sass_0.4.7                    bslib_0.5.0                   #>  [21] desc_1.4.2                    plyr_1.8.8                    #>  [23] cachem_1.0.8                  igraph_1.5.0.1                #>  [25] mime_0.12                     lifecycle_1.0.3               #>  [27] pkgconfig_2.0.3               rsvd_1.0.5                    #>  [29] Matrix_1.6-0                  R6_2.5.1                      #>  [31] fastmap_1.1.1                 GenomeInfoDbData_1.2.10       #>  [33] shiny_1.7.4.1                 digest_0.6.33                 #>  [35] colorspace_2.1-0              AnnotationDbi_1.62.2          #>  [37] rprojroot_2.0.3               RSpectra_0.16-1               #>  [39] dqrng_0.3.0                   irlba_2.3.5.1                 #>  [41] ExperimentHub_2.8.1           textshaping_0.3.6             #>  [43] RSQLite_2.3.1                 beachmat_2.16.0               #>  [45] labeling_0.4.2                filelock_1.0.2                #>  [47] timechange_0.2.0              fansi_1.0.4                   #>  [49] mgcv_1.9-0                    httr_1.4.6                    #>  [51] compiler_4.3.1                bit64_4.0.5                   #>  [53] withr_2.5.0                   BiocParallel_1.34.2           #>  [55] viridis_0.6.4                 DBI_1.1.3                     #>  [57] highr_0.10                    MASS_7.3-60                   #>  [59] openssl_2.1.0                 rappdirs_0.3.3                #>  [61] DelayedArray_0.26.6           bluster_1.10.0                #>  [63] tools_4.3.1                   interactiveDisplayBase_1.38.0 #>  [65] httpuv_1.6.11                 glue_1.6.2                    #>  [67] nlme_3.1-162                  promises_1.2.0.1              #>  [69] grid_4.3.1                    cluster_2.1.4                 #>  [71] reshape2_1.4.4                generics_0.1.3                #>  [73] gtable_0.3.3                  tzdb_0.4.0                    #>  [75] hms_1.1.3                     metapod_1.8.0                 #>  [77] BiocSingular_1.16.0           ScaledMatrix_1.8.1            #>  [79] utf8_1.2.3                    XVector_0.40.0                #>  [81] BiocVersion_3.17.1            pillar_1.9.0                  #>  [83] limma_3.56.2                  later_1.3.1                   #>  [85] splines_4.3.1                 BiocFileCache_2.8.0           #>  [87] lattice_0.21-8                survival_3.5-5                #>  [89] bit_4.0.5                     gamlss.data_6.0-2             #>  [91] tidyselect_1.2.0              locfit_1.5-9.8                #>  [93] Biostrings_2.68.1             knitr_1.43                    #>  [95] gridExtra_2.3                 bookdown_0.34                 #>  [97] edgeR_3.42.4                  xfun_0.39                     #>  [99] statmod_1.5.0                 stringi_1.7.12                #> [101] yaml_2.3.7                    evaluate_0.21                 #> [103] codetools_0.2-19              BiocManager_1.30.21.1         #> [105] cli_3.6.1                     reticulate_1.30               #> [107] pbmcapply_1.5.1               xtable_1.8-4                  #> [109] systemfonts_1.0.4             munsell_0.5.0                 #> [111] jquerylib_0.1.4               Rcpp_1.0.11                   #> [113] dbplyr_2.3.3                  png_0.1-8                     #> [115] parallel_4.3.1                ellipsis_0.3.2                #> [117] pkgdown_2.0.7                 blob_1.2.4                    #> [119] mclust_6.0.0                  sparseMatrixStats_1.12.2      #> [121] bitops_1.0-7                  gamlss.dist_6.0-5             #> [123] mvtnorm_1.2-2                 viridisLite_0.4.2             #> [125] ggthemes_4.2.4                scales_1.2.1                  #> [127] gamlss_5.4-12                 crayon_1.5.2                  #> [129] rlang_1.1.1                   KEGGREST_1.40.0"},{"path":"/articles/scDesign3-marginal-vignette.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"scDesign3 marginal distribution for genes","text":"tutorial, explain different forms function can used fitting marginal distribution gene.","code":""},{"path":"/articles/scDesign3-marginal-vignette.html","id":"notation","dir":"Articles","previous_headings":"","what":"Notation","title":"scDesign3 marginal distribution for genes","text":"following notations used: \\({\\mathbf{Y}} = [Y_{ij}] \\\\mathbb{R}^{n \\times m}\\): cell--feature matrix \\(n\\) cells rows, \\(m\\) features columns, \\(Y_{ij}\\) measurement feature \\(j\\) cell \\(\\); single-cell sequencing data, \\({\\mathbf{Y}}\\) often count matrix. \\(\\mathbf{X} = [\\mathbf{x}_1, \\cdots, \\mathbf{x}_n]^T \\\\mathbb{R}^{n\\times p}\\): cell--state-covariate matrix \\(n\\) cells rows \\(p\\) cell-state covariates columns; example covariates cell type, cell pseudotime, cell spatial locations. \\(\\mathbf{Z} = [\\mathbf{b}, \\mathbf{c}]\\): \\(\\mathbf{b} = (b_1, \\ldots, b_n)^T\\) \\(b_i \\\\{1, \\ldots, B \\}\\) representing cell \\(\\)’s batch, \\(\\mathbf{c} = (c_1, \\ldots, c_n)^T\\) \\(c_i \\\\{1, \\ldots, C \\}\\) representing cell \\(\\)’s condition. feature \\(j=1,\\ldots,m\\) every cell \\(=1,\\ldots,n\\), measurement \\(Y_{ij}\\)—conditional cell \\(\\)’s state covariates \\(\\mathbf{x_i}\\) design covariates \\(\\mathbf{z}_i = (b_i, c_i)^T\\)—assumed follow distribution \\(F_{j}( \\cdot~|~\\mathbf{x}_i, \\mathbf{z}_i~;~\\mu_{ij}, \\sigma_{ij}, p_{ij})\\), specified generalized additive model location, scale shape (GAMLSS). various specifications \\(f_{jc_i}(\\cdot)\\), \\(g_{jc_i}(\\cdot)\\), \\(h_{jc_i}(\\cdot)\\) summarized next section. \\[\\begin{equation} \\begin{cases}             Y_{ij}~|~\\mathbf{x}_i, \\mathbf{z}_i &\\overset{\\mathrm{ind}}{\\sim} F_{j}( \\cdot~|~\\mathbf{x}_i, \\mathbf{z}_i~;~\\mu_{ij}, \\sigma_{ij}, p_{ij})\\\\             \\theta_{j}(\\mu_{ij}) &= \\alpha_{j0} + \\alpha_{jb_i} + \\alpha_{jc_i} + f_{jc_i}(\\mathbf{x}_i) \\\\             \\log(\\sigma_{ij}) &= \\beta_{j0}+ \\beta_{jb_i} + \\beta_{jc_i} + g_{jc_i}(\\mathbf{x}_i) \\\\             \\operatorname{logit}(p_{ij}) &= \\gamma_{j0} + \\gamma_{jb_i}+ \\gamma_{jc_i}+ h_{jc_i}(\\mathbf{x}_i) \\\\ \\end{cases} \\, \\end{equation}\\]","code":""},{"path":[]},{"path":"/articles/scDesign3-multiomics-vignette.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Simulate multi-omics data from single-omic data","text":"tutorial, show use scDesign3 simulate multi-omics (RNA expression + DNA methylation) data learning real data single modality. example data aligned low-dimensional embeddings Pamona.","code":""},{"path":"/articles/scDesign3-multiomics-vignette.html","id":"read-in-the-reference-data","dir":"Articles","previous_headings":"","what":"Read in the reference data","title":"Simulate multi-omics data from single-omic data","text":"first combine cell-level data scRNA-seq data DNA methylation data.","code":"SCGEMMETH_sce <- readRDS((url(\"https://figshare.com/ndownloader/files/40581998\"))) SCGEMRNA_sce <-readRDS((url(\"https://figshare.com/ndownloader/files/40582001\"))) print(SCGEMMETH_sce) print(SCGEMRNA_sce) coldata_bind <- bind_rows(as_tibble(colData(SCGEMRNA_sce)) %>% dplyr::mutate(Tech = \"RNA\"), as_tibble(colData(SCGEMMETH_sce)) %>% dplyr::mutate(Tech = \"Methylation\")) head(coldata_bind)"},{"path":"/articles/scDesign3-multiomics-vignette.html","id":"simulation","dir":"Articles","previous_headings":"","what":"Simulation","title":"Simulate multi-omics data from single-omic data","text":"first use step--step functions fit genes’ marginal models, copulas, extract simulation parameters separately scRNA-seq data DNA methylation data. Note actually treat 2D aligned UMAPs kind “pseudo”-spatial data. use tensor regression spline fit two ref datasets seperately.","code":"set.seed(123) RNA_data <- scDesign3::construct_data(   SCGEMRNA_sce,    assay_use = \"logcounts\",    celltype = \"cell_type\",    pseudotime = NULL,    spatial = c(\"UMAP1_integrated\", \"UMAP2_integrated\"),    other_covariates = NULL,    corr_by = \"1\"   ) METH_data <- scDesign3::construct_data(   SCGEMMETH_sce,    assay_use = \"counts\",    celltype = \"cell_type\",    pseudotime = NULL,    spatial = c(\"UMAP1_integrated\", \"UMAP2_integrated\"),    other_covariates = NULL,    corr_by = \"1\") RNA_marginal <- scDesign3::fit_marginal(   data = RNA_data,    predictor = \"gene\",    mu_formula = \"te(UMAP1_integrated, UMAP2_integrated, bs = 'cr', k = 10)\",    sigma_formula = \"te(UMAP1_integrated, UMAP2_integrated, bs = 'cr', k = 5)\",    family_use = \"gaussian\",    n_cores = 1,    usebam = FALSE)  METH_marginal <- scDesign3::fit_marginal(   data = METH_data,    predictor = \"gene\",    mu_formula = \"te(UMAP1_integrated, UMAP2_integrated, bs = 'cr', k = 10)\",    sigma_formula = \"1\",    family_use = \"binomial\",    n_cores = 1,    usebam = FALSE) RNA_copula <- scDesign3::fit_copula(     sce = SCGEMRNA_sce,     assay_use = \"logcounts\",     marginal_list = RNA_marginal,     family_use = \"gaussian\",     copula = \"vine\",     n_cores = 1,     input_data = RNA_data$dat   )  METH_copula <- scDesign3::fit_copula(     sce = SCGEMMETH_sce,     assay_use = \"counts\",     marginal_list = METH_marginal,     family_use = \"binomial\",     copula = \"vine\",     n_cores = 1,     input_data = METH_data$dat   ) RNA_para <- extract_para(     sce = SCGEMRNA_sce,     assay_use = \"logcounts\",     marginal_list = RNA_marginal,     n_cores = 1,     family_use = \"gaussian\",     new_covariate = rbind(RNA_data$dat, METH_data$dat),     data = RNA_data$dat   )  METH_para <- extract_para(     sce = SCGEMMETH_sce,     marginal_list = METH_marginal,     n_cores = 1,     family_use = \"binomial\",     new_covariate = rbind(RNA_data$dat, METH_data$dat),     data = METH_data$dat   )"},{"path":"/articles/scDesign3-multiomics-vignette.html","id":"simulate-new-datasets","dir":"Articles","previous_headings":"Simulation","what":"Simulate New Datasets","title":"Simulate multi-omics data from single-omic data","text":", combined cell covariates scRNA-seq data DNA methylation data new covariate simulate two new datasets parameters scRNA-seq data DNA methylation data separately.","code":"RNA_res <- simu_new(     sce = SCGEMRNA_sce,     assay_use = \"logcounts\",     mean_mat = RNA_para$mean_mat,     sigma_mat = RNA_para$sigma_mat,     zero_mat = RNA_para$zero_mat,     quantile_mat = NULL,     copula_list = RNA_copula$copula_list,     n_cores = 1,     family_use = \"gaussian\",     input_data = RNA_data$dat,     new_covariate = rbind(RNA_data$dat, METH_data$dat),     important_feature = RNA_copula$important_feature,     filtered_gene = RNA_data$filtered_gene   ) METH_res <- simu_new(     sce = SCGEMMETH_sce,     mean_mat = METH_para$mean_mat,     sigma_mat = METH_para$sigma_mat,     zero_mat = METH_para$zero_mat,     quantile_mat = NULL,     copula_list = METH_copula$copula_list,     n_cores = 1,     family_use = \"binomial\",     input_data = METH_data$dat,     new_covariate = rbind(RNA_data$dat, METH_data$dat),     important_feature = METH_copula$important_feature,     filtered_gene = METH_data$filtered_gene   )"},{"path":"/articles/scDesign3-multiomics-vignette.html","id":"visualization","dir":"Articles","previous_headings":"","what":"Visualization","title":"Simulate multi-omics data from single-omic data","text":"combine two synthetic datasets obtain UMAP embeddings combined dataset. , reformat UMAP embeddings inputted scRNA-seq data, DNA methylation data, combined synthetic data visualize UMAP embeddings.","code":"count_combine <- rbind(RNA_res, METH_res) count_combine_pca <- irlba::prcomp_irlba(t(count_combine), 5, scale. = TRUE)  count_combine_umap <- umap::umap(count_combine_pca$x, n_neighbors=30, min_dist=0.7)$layout colnames(count_combine_umap) <- c(\"UMAP1\", \"UMAP2\")  SCGEMNEW_sce <- SingleCellExperiment::SingleCellExperiment(list(logcounts = count_combine)) reducedDims(SCGEMNEW_sce) <- list(PCA = count_combine_pca$x, UMAP = count_combine_umap) SCGEMRNA_umap <- umap::umap(colData(SCGEMRNA_sce) %>% as_tibble() %>% dplyr::select(paste0(\"X\", 1:5)), n_neighbors=30, min_dist=0.7) SCGEMRNA_umap <- SCGEMRNA_umap$layout colnames(SCGEMRNA_umap) <- c(\"UMAP1\", \"UMAP2\") reducedDim(SCGEMRNA_sce, \"UMAP\") <- SCGEMRNA_umap SCGEMMETH_umap <- umap::umap(colData(SCGEMMETH_sce) %>% as_tibble() %>% dplyr::select(paste0(\"X\", 1:5)), n_neighbors=30, min_dist=0.7) SCGEMMETH_umap <- SCGEMMETH_umap$layout colnames(SCGEMMETH_umap) <- c(\"UMAP1\", \"UMAP2\") reducedDim(SCGEMMETH_sce, \"UMAP\") <- SCGEMMETH_umap dat_RNA <- SCGEMRNA_umap %>% as_tibble() %>% dplyr::mutate(Method = \"Real data: RNA\") dat_METH <- SCGEMMETH_umap %>% as_tibble() %>% dplyr::mutate(Method = \"Real data: Methylation\") dat_NEW <- reducedDim(SCGEMNEW_sce, \"UMAP\") %>% as_tibble() %>% dplyr::mutate(Method = \"scDesign3: RNA + Meythlation\") SCGEM_dat <- bind_rows(list(dat_RNA, dat_METH, dat_NEW)) design <- matrix(c(2,3,1,3), 2, 2) %>% t() dat_text_SCGEM <- tibble(Method = c(\"Real data: RNA\", \"Real data: Methylation\", \"scDesign3: RNA + Meythlation\"), label = c(\"32 Features*177 Cells\", \"27 Features*142 Cells\", \"59 Features*319 Cells\")) %>% as.data.frame() SCGEM_dat <- SCGEM_dat %>% dplyr::mutate(Method = factor(Method, levels = c(\"Real data: RNA\", \"scDesign3: RNA + Meythlation\", \"Real data: Methylation\"))) %>% dplyr::mutate(UMAP1 = if_else(Method == \"Real data: RNA\", -UMAP1, UMAP1), UMAP2 = if_else(Method == \"Real data: RNA\", -UMAP2, UMAP2))  p_merge_modals <- ggplot(SCGEM_dat, aes(UMAP1, UMAP2, colour = Method)) + ggrastr::rasterize(geom_point(size = 0.5), dpi = 300) +   guides(colour = \"none\") + scale_color_brewer(palette = \"Set2\") + theme_bw() + theme(aspect.ratio = 1,     panel.grid.minor = element_blank(),     panel.grid.major = element_blank(),     axis.text.x=element_blank(),     axis.ticks.x=element_blank(),     axis.text.y=element_blank(),     axis.ticks.y=element_blank()) + facet_manual(~Method, design = design, widths = c(1, 2), heights = c(1, 1), respect = TRUE, scales = \"free\")+ geom_text(   data    = dat_text_SCGEM,   mapping = aes(x = Inf, y = -Inf, label = label), vjust = -6, hjust = 1, color = \"black\", size = 3) p_merge_modals"},{"path":"/articles/scDesign3-multiomics-vignette.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Simulate multi-omics data from single-omic data","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Ubuntu 20.04.6 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0 #>  #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Los_Angeles #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] umap_0.2.10.0               ggh4x_0.2.5                 #>  [3] ggplot2_3.4.2               dplyr_1.1.2                 #>  [5] SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2 #>  [7] Biobase_2.60.0              GenomicRanges_1.52.0        #>  [9] GenomeInfoDb_1.36.1         IRanges_2.34.1              #> [11] S4Vectors_0.38.1            BiocGenerics_0.46.0         #> [13] MatrixGenerics_1.12.2       matrixStats_1.0.0           #> [15] scDesign3_0.99.6            BiocStyle_2.28.0            #>  #> loaded via a namespace (and not attached): #>  [1] tidyselect_1.2.0        farver_2.1.1            vipor_0.4.5             #>  [4] bitops_1.0-7            kde1d_1.0.5             fastmap_1.1.1           #>  [7] RCurl_1.98-1.12         digest_0.6.33           lifecycle_1.0.3         #> [10] Cairo_1.6-0             survival_3.5-5          gamlss.dist_6.0-5       #> [13] magrittr_2.0.3          compiler_4.3.1          rlang_1.1.1             #> [16] sass_0.4.7              tools_4.3.1             utf8_1.2.3              #> [19] yaml_2.3.7              knitr_1.43              labeling_0.4.2          #> [22] askpass_1.1             S4Arrays_1.0.4          mclust_6.0.0            #> [25] reticulate_1.30         DelayedArray_0.26.6     RColorBrewer_1.1-3      #> [28] withr_2.5.0             purrr_1.0.1             rvinecopulib_0.6.3.1.1  #> [31] desc_1.4.2              grid_4.3.1              fansi_1.0.4             #> [34] colorspace_2.1-0        scales_1.2.1            MASS_7.3-60             #> [37] cli_3.6.1               rmarkdown_2.23          crayon_1.5.2            #> [40] ragg_1.2.5              generics_0.1.3          RSpectra_0.16-1         #> [43] ggbeeswarm_0.7.2        cachem_1.0.8            stringr_1.5.0           #> [46] zlibbioc_1.46.0         splines_4.3.1           assertthat_0.2.1        #> [49] parallel_4.3.1          ggrastr_1.0.2           BiocManager_1.30.21.1   #> [52] XVector_0.40.0          vctrs_0.6.3             Matrix_1.6-0            #> [55] jsonlite_1.8.7          bookdown_0.34           gamlss_5.4-12           #> [58] beeswarm_0.4.0          irlba_2.3.5.1           systemfonts_1.0.4       #> [61] jquerylib_0.1.4         glue_1.6.2              pkgdown_2.0.7           #> [64] rngWELL_0.10-9          stringi_1.7.12          gtable_0.3.3            #> [67] randtoolbox_2.0.4       munsell_0.5.0           tibble_3.2.1            #> [70] pillar_1.9.0            htmltools_0.5.5         openssl_2.1.0           #> [73] gamlss.data_6.0-2       GenomeInfoDbData_1.2.10 R6_2.5.1                #> [76] textshaping_0.3.6       rprojroot_2.0.3         evaluate_0.21           #> [79] lattice_0.21-8          highr_0.10              png_0.1-8               #> [82] memoise_2.0.1           bslib_0.5.0             Rcpp_1.0.11             #> [85] nlme_3.1-162            mgcv_1.9-0              xfun_0.39               #> [88] fs_1.6.3                pkgconfig_2.0.3"},{"path":"/articles/scDesign3-multipleLineages-vignette.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Simulate datasets with multiple lineages","text":"tutorial, show use scDesign3 simulate multiple lineages single-cell data.","code":""},{"path":"/articles/scDesign3-multipleLineages-vignette.html","id":"read-in-the-reference-data","dir":"Articles","previous_headings":"","what":"Read in the reference data","title":"Simulate datasets with multiple lineages","text":"raw data GEO ID GSE72859, describes myeloid progenitors mouse bone marrow. pre-select top 1000 highly variable genes. save computational time, use top 100 genes. can see, example dataset two sets pseudotime, thus two lineages. variables pseudotime1 pseudotime2 contain corresponding pseudotime cell. variables l1 l2 indicate whether particular cell belong first /second lineages.","code":"example_sce <- readRDS((url(\"https://figshare.com/ndownloader/files/40581980\"))) print(example_sce) #> class: SingleCellExperiment  #> dim: 1000 2660  #> metadata(0): #> assays(3): counts cpm logcounts #> rownames(1000): Prtn3 Elane ... Rnf144a Fabp5 #> rowData names(1): gene_short_name #> colnames(2660): W31105 W31106 ... W39167 W39168 #> colData names(27): Seq_batch_ID Amp_batch_ID ... l1 l2 #> reducedDimNames(1): UMAP #> mainExpName: NULL #> altExpNames(0): example_sce <- example_sce[1:100, ] head(colData(example_sce))[,c(\"pseudotime1\",\"pseudotime2\",\"l1\",\"l2\")] #> DataFrame with 6 rows and 4 columns #>        pseudotime1 pseudotime2       l1       l2 #>          <numeric>   <numeric> <factor> <factor> #> W31105    0.950862    0.568357    TRUE     TRUE  #> W31106    9.168276   -1.000000    TRUE     FALSE #> W31107   -1.000000    7.981990    FALSE    TRUE  #> W31108   11.394132   -1.000000    TRUE     FALSE #> W31109   -1.000000    8.080133    FALSE    TRUE  #> W31110   11.398502   -1.000000    TRUE     FALSE"},{"path":"/articles/scDesign3-multipleLineages-vignette.html","id":"simulation","dir":"Articles","previous_headings":"","what":"Simulation","title":"Simulate datasets with multiple lineages","text":", can use multiple-lineage dataset generate new data setting parameter mu_formula two smooth terms lineage. , can create SinglecellExperiment object using synthetic count matrix store logcounts input synthetic SinglecellExperiment objects.","code":"set.seed(123) example_simu <- scdesign3(     sce = example_sce,     assay_use = \"counts\",     celltype = \"cell_type\",     pseudotime = c(\"pseudotime1\", \"pseudotime2\", \"l1\", \"l2\"),     spatial = NULL,     other_covariates = NULL,     mu_formula = \"s(pseudotime1, k = 10, by = l1, bs = 'cr') + s(pseudotime2, k = 10, by = l2, bs = 'cr')\",     sigma_formula = \"1\",     family_use = \"nb\",     n_cores = 2,     usebam = FALSE,     corr_formula = \"1\",     copula = \"gaussian\",     DT = TRUE,     pseudo_obs = FALSE,     return_model = FALSE,     nonzerovar = FALSE   ) logcounts(example_sce) <- log1p(counts(example_sce)) simu_sce <- SingleCellExperiment(list(counts = example_simu$new_count), colData = example_simu$new_covariate) logcounts(simu_sce) <- log1p(counts(simu_sce))"},{"path":"/articles/scDesign3-multipleLineages-vignette.html","id":"visualization","dir":"Articles","previous_headings":"","what":"Visualization","title":"Simulate datasets with multiple lineages","text":"","code":"set.seed(123) compare_figure <- plot_reduceddim(ref_sce = example_sce,                                    sce_list = list(simu_sce),                                    name_vec = c(\"Reference\", \"scDesign3\"),                                   assay_use = \"logcounts\",                                    if_plot = TRUE,                                    color_by =  \"pseudotime1\",                                   n_pc = 20) compare_figure2 <- plot_reduceddim(ref_sce = example_sce,                                    sce_list = list(simu_sce),                                    name_vec = c(\"Reference\", \"scDesign3\"),                                   assay_use = \"logcounts\",                                    if_plot = TRUE,                                    color_by =  \"pseudotime2\",                                    n_pc = 20) grid.arrange(compare_figure$p_umap, compare_figure2$p_umap)"},{"path":"/articles/scDesign3-multipleLineages-vignette.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Simulate datasets with multiple lineages","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Ubuntu 20.04.6 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0 #>  #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Los_Angeles #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] gridExtra_2.3               useful_1.2.6                #>  [3] ggplot2_3.4.2               SingleCellExperiment_1.22.0 #>  [5] SummarizedExperiment_1.30.2 Biobase_2.60.0              #>  [7] GenomicRanges_1.52.0        GenomeInfoDb_1.36.1         #>  [9] IRanges_2.34.1              S4Vectors_0.38.1            #> [11] BiocGenerics_0.46.0         MatrixGenerics_1.12.2       #> [13] matrixStats_1.0.0           scDesign3_0.99.6            #> [15] BiocStyle_2.28.0            #>  #> loaded via a namespace (and not attached): #>  [1] tidyselect_1.2.0        viridisLite_0.4.2       farver_2.1.1            #>  [4] dplyr_1.1.2             viridis_0.6.4           bitops_1.0-7            #>  [7] fastmap_1.1.1           RCurl_1.98-1.12         digest_0.6.33           #> [10] lifecycle_1.0.3         survival_3.5-5          gamlss.dist_6.0-5       #> [13] magrittr_2.0.3          compiler_4.3.1          rlang_1.1.1             #> [16] sass_0.4.7              tools_4.3.1             utf8_1.2.3              #> [19] yaml_2.3.7              knitr_1.43              labeling_0.4.2          #> [22] askpass_1.1             S4Arrays_1.0.4          mclust_6.0.0            #> [25] reticulate_1.30         DelayedArray_0.26.6     plyr_1.8.8              #> [28] withr_2.5.0             purrr_1.0.1             desc_1.4.2              #> [31] grid_4.3.1              fansi_1.0.4             colorspace_2.1-0        #> [34] scales_1.2.1            MASS_7.3-60             cli_3.6.1               #> [37] mvtnorm_1.2-2           rmarkdown_2.23          crayon_1.5.2            #> [40] ragg_1.2.5              generics_0.1.3          umap_0.2.10.0           #> [43] RSpectra_0.16-1         cachem_1.0.8            stringr_1.5.0           #> [46] zlibbioc_1.46.0         splines_4.3.1           parallel_4.3.1          #> [49] BiocManager_1.30.21.1   XVector_0.40.0          vctrs_0.6.3             #> [52] Matrix_1.6-0            jsonlite_1.8.7          bookdown_0.34           #> [55] gamlss_5.4-12           irlba_2.3.5.1           systemfonts_1.0.4       #> [58] jquerylib_0.1.4         glue_1.6.2              pkgdown_2.0.7           #> [61] stringi_1.7.12          gtable_0.3.3            munsell_0.5.0           #> [64] tibble_3.2.1            pillar_1.9.0            htmltools_0.5.5         #> [67] openssl_2.1.0           gamlss.data_6.0-2       GenomeInfoDbData_1.2.10 #> [70] R6_2.5.1                textshaping_0.3.6       rprojroot_2.0.3         #> [73] evaluate_0.21           lattice_0.21-8          highr_0.10              #> [76] png_0.1-8               memoise_2.0.1           bslib_0.5.0             #> [79] Rcpp_1.0.11             nlme_3.1-162            mgcv_1.9-0              #> [82] xfun_0.39               fs_1.6.3                pkgconfig_2.0.3"},{"path":"/articles/scDesign3-parallelization-vignette.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Parallelization in scDesign3","text":"tutorial, demonstrate use parallelization functions three packages: parallel, pbmcapply,BiocParallel. demonstration purpose, use one-shot function scdesign3 show adjust parameter use different parallelization functions. Although show change parallelization functions one-shot function scdesign3, logic holds methods package parameters parallelization BPPARAM. Linux/Mac users: possible parallel methods include mcmapply, pbmcmapply bpmapply, parallelization functions parallel, pbmcapply,BiocParallel, respectively. using bpmapply method, give parameter BPPARAM scdesign3 output MulticoreParam SnowParam, two functions BiocParallel. Windows users: choice choose bpmapply method run function using BPPARAM parameter scdesign3 output SnowParam function BiocParallel. Setting 1 core allowed methods.","code":""},{"path":"/articles/scDesign3-parallelization-vignette.html","id":"read-in-the-reference-data","dir":"Articles","previous_headings":"","what":"Read in the reference data","title":"Parallelization in scDesign3","text":"raw data scvelo, describes pancreatic endocrinogenesis. pre-select top 1000 highly variable genes filter cell types ensure single trajectory. save computational time, use top 100 genes.","code":"example_sce <- readRDS((url(\"https://figshare.com/ndownloader/files/40581992\"))) print(example_sce) #> Loading required package: SingleCellExperiment #> Loading required package: SummarizedExperiment #> Loading required package: MatrixGenerics #> Loading required package: matrixStats #>  #> Attaching package: 'MatrixGenerics' #> The following objects are masked from 'package:matrixStats': #>  #>     colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse, #>     colCounts, colCummaxs, colCummins, colCumprods, colCumsums, #>     colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs, #>     colMads, colMaxs, colMeans2, colMedians, colMins, colOrderStats, #>     colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds, #>     colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads, #>     colWeightedMeans, colWeightedMedians, colWeightedSds, #>     colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet, #>     rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods, #>     rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps, #>     rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins, #>     rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks, #>     rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars, #>     rowWeightedMads, rowWeightedMeans, rowWeightedMedians, #>     rowWeightedSds, rowWeightedVars #> Loading required package: GenomicRanges #> Loading required package: stats4 #> Loading required package: BiocGenerics #>  #> Attaching package: 'BiocGenerics' #> The following objects are masked from 'package:stats': #>  #>     IQR, mad, sd, var, xtabs #> The following objects are masked from 'package:base': #>  #>     anyDuplicated, aperm, append, as.data.frame, basename, cbind, #>     colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find, #>     get, grep, grepl, intersect, is.unsorted, lapply, Map, mapply, #>     match, mget, order, paste, pmax, pmax.int, pmin, pmin.int, #>     Position, rank, rbind, Reduce, rownames, sapply, setdiff, sort, #>     table, tapply, union, unique, unsplit, which.max, which.min #> Loading required package: S4Vectors #>  #> Attaching package: 'S4Vectors' #> The following object is masked from 'package:utils': #>  #>     findMatches #> The following objects are masked from 'package:base': #>  #>     expand.grid, I, unname #> Loading required package: IRanges #> Loading required package: GenomeInfoDb #> Loading required package: Biobase #> Welcome to Bioconductor #>  #>     Vignettes contain introductory material; view with #>     'browseVignettes()'. To cite Bioconductor, see #>     'citation(\"Biobase\")', and for packages 'citation(\"pkgname\")'. #>  #> Attaching package: 'Biobase' #> The following object is masked from 'package:MatrixGenerics': #>  #>     rowMedians #> The following objects are masked from 'package:matrixStats': #>  #>     anyMissing, rowMedians #> class: SingleCellExperiment  #> dim: 1000 2087  #> metadata(5): clusters_coarse_colors clusters_colors day_colors #>   neighbors pca #> assays(6): X spliced ... cpm logcounts #> rownames(1000): Pyy Iapp ... Eya2 Kif21a #> rowData names(1): highly_variable_genes #> colnames(2087): AAACCTGAGAGGGATA AAACCTGGTAAGTGGC ... TTTGTCAAGTGACATA #>   TTTGTCAAGTGTGGCA #> colData names(7): clusters_coarse clusters ... sizeFactor pseudotime #> reducedDimNames(4): X_pca X_umap PCA UMAP #> mainExpName: NULL #> altExpNames(0): example_sce <- example_sce[1:100, ]"},{"path":"/articles/scDesign3-parallelization-vignette.html","id":"paralleization-function-from-parallel","dir":"Articles","previous_headings":"","what":"Paralleization function from parallel","title":"Parallelization in scDesign3","text":"parameter parallelization scdesign3 set use mcmapply R package parallel default. Therefore, want use parallelization function parallel, need modify parameter parallelization scdesign3.","code":"set.seed(123) example_simu <- scdesign3(     sce = example_sce,     assay_use = \"counts\",     celltype = \"cell_type\",     pseudotime = \"pseudotime\",     spatial = NULL,     other_covariates = NULL,     mu_formula = \"s(pseudotime, k = 10, bs = 'cr')\",     sigma_formula = \"1\",     family_use = \"nb\",     n_cores = 2,     usebam = FALSE,     corr_formula = \"1\",     copula = \"gaussian\",     DT = TRUE,     pseudo_obs = FALSE,     return_model = FALSE,     nonzerovar = FALSE   )"},{"path":"/articles/scDesign3-parallelization-vignette.html","id":"paralleization-function-from-pbmcapply","dir":"Articles","previous_headings":"","what":"Paralleization function from pbmcapply","title":"Parallelization in scDesign3","text":"pbmcmapply function R package pbmcapply gives users progress bar paralleilization. use pbmcmapply, need set parameter paralleilization “pbmcmapply”.","code":"set.seed(123) example_simu <- scdesign3(     sce = example_sce,     assay_use = \"counts\",     celltype = \"cell_type\",     pseudotime = \"pseudotime\",     spatial = NULL,     other_covariates = NULL,     mu_formula = \"s(pseudotime, k = 10, bs = 'cr')\",     sigma_formula = \"1\",     family_use = \"nb\",     n_cores = 2,     usebam = FALSE,     corr_formula = \"1\",     copula = \"gaussian\",     DT = TRUE,     pseudo_obs = FALSE,     return_model = FALSE,     nonzerovar = FALSE,     parallelization = \"pbmcmapply\"   )"},{"path":"/articles/scDesign3-parallelization-vignette.html","id":"paralleization-function-from-biocparallel","dir":"Articles","previous_headings":"","what":"Paralleization function from BiocParallel","title":"Parallelization in scDesign3","text":"pbmapply function R package BicoParallel another choice parallelization. use pbmapply, need set parameter parallelization “pbmapply” set parameter BPPARAM output function MulticoreParam() SnowParam() BiocParallel. detail documentation set parameter BPPARAM can found .","code":"set.seed(123) example_simu <- scdesign3(     sce = example_sce,     assay_use = \"counts\",     celltype = \"cell_type\",     pseudotime = \"pseudotime\",     spatial = NULL,     other_covariates = NULL,     mu_formula = \"s(pseudotime, k = 10, bs = 'cr')\",     sigma_formula = \"1\",     family_use = \"nb\",     n_cores = 2,     usebam = FALSE,     corr_formula = \"1\",     copula = \"gaussian\",     DT = TRUE,     pseudo_obs = FALSE,     return_model = FALSE,     nonzerovar = FALSE,     parallelization = \"pbmapply\",     BPPARAM = MulticoreParam()   ) set.seed(123) example_simu <- scdesign3(     sce = example_sce,     assay_use = \"counts\",     celltype = \"cell_type\",     pseudotime = \"pseudotime\",     spatial = NULL,     other_covariates = NULL,     mu_formula = \"s(pseudotime, k = 10, bs = 'cr')\",     sigma_formula = \"1\",     family_use = \"nb\",     n_cores = 2,     usebam = FALSE,     corr_formula = \"1\",     copula = \"gaussian\",     DT = TRUE,     pseudo_obs = FALSE,     return_model = FALSE,     nonzerovar = FALSE,     parallelization = \"pbmapply\",     BPPARAM = SnowParam()   )"},{"path":"/articles/scDesign3-pseudotimeGOF-vignette.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Evaluate pseudotime goodness-of-fit by scDesign3","text":"tutorial, show use scDesign3 evaluate pseudotime goodness--fit different pseudotime labels. true labels unavailable little prior knowledge, scDesign3 BIC can serve unsupervised metric. tutorial, first use R package dyngen generate dataset ground truth \"pseudotime\". , perturb ground truth pseudotime worsen quality use scDesign3’s BIC examine pseudotime goodness--fit.","code":""},{"path":"/articles/scDesign3-pseudotimeGOF-vignette.html","id":"generation-of-reference-dataset-simulation","dir":"Articles","previous_headings":"","what":"Generation of reference dataset & Simulation","title":"Evaluate pseudotime goodness-of-fit by scDesign3","text":"first use dyngen generate dataset ground truth “pseudotime”. Secondly, perturb pseudotime generating random numbers uniform distribution replacing various percentages original pseudotime random numbers. percentage ranges 0% 100%. code , generate 11 sets perturbed pseudotime percentage perturbation ranging 0% 100%. new set perturbed pseudotime, create new SingleCellExperiment object, storing original count matrix corresponding perturbed pseudotime. Thirdly, iteratively run function scdesign3; iteration uses different set pseudotime generated .","code":"set.seed(123) backbone <- backbone_linear_simple() config <-   initialise_model(     backbone = backbone,     num_cells = 500,     num_tfs = nrow(backbone$module_info),     num_targets = 100,     num_hks = 50,     verbose = FALSE   ) out <- generate_dataset(   config,   format = \"sce\",   make_plots = FALSE   ) example_sce <- out$dataset colData(example_sce)$pseudotime <- out$model$experiment$cell_info$time set.seed(123) example_sce_list <- lapply(0:10, function(x) {   perturb_prop <- x/10   n_cell <- round(dim(example_sce)[2]*perturb_prop)   cell_index <- sample(1:dim(example_sce)[2], n_cell)      new_pseudotime <- colData(example_sce)$pseudotime   new_pseudotime[cell_index] <- runif(n_cell)      curr_sce <- example_sce   colData(curr_sce)$pseudotime <- new_pseudotime   curr_sce }) set.seed(123) scDesign3_result <- lapply(example_sce_list, function(x) {   res <-  scdesign3(     sce = x,     assay_use = \"counts\",     celltype = NULL,     pseudotime = \"pseudotime\",     spatial = NULL,     other_covariates = NULL,     mu_formula = \"s(pseudotime, bs = 'cr', k = 10)\",     sigma_formula = \"1\",     corr_formula = \"ind\",     copula = \"gaussian\",     n_cores = 2   )   return(res) })"},{"path":"/articles/scDesign3-pseudotimeGOF-vignette.html","id":"visualization","dir":"Articles","previous_headings":"","what":"Visualization","title":"Evaluate pseudotime goodness-of-fit by scDesign3","text":"simulations, first extract scDesign3’s BIC, unsupervised metric evaluating goodness--fit pseudotime. Since also ground truth pseudotime, also calculate \\(r^2\\) ground truth pseudotime perturbed pseudotime. \\(r^2\\) supervised metric evaluate pseudotime qualities. figure demonstrates scDesign3’s BIC agrees \\(r^2\\).","code":"bic_list <- lapply(scDesign3_result, function(x){return(x$model_bic)}) bic_df <- data.frame(matrix(unlist(bic_list), nrow = length(bic_list), byrow = TRUE)) colnames(bic_df) <- names(bic_list[[1]]) bic_df #>    bic.marginal bic.copula bic.total #> 1      463280.2          0  463280.2 #> 2      499829.7          0  499829.7 #> 3      512349.0          0  512349.0 #> 4      516330.9          0  516330.9 #> 5      522417.5          0  522417.5 #> 6      525315.8          0  525315.8 #> 7      528644.0          0  528644.0 #> 8      532390.2          0  532390.2 #> 9      533014.4          0  533014.4 #> 10     534671.6          0  534671.6 #> 11     533596.2          0  533596.2 r2 <- sapply(example_sce_list, function(x){   cor(colData(example_sce_list[[1]])$pseudotime, colData(x)$pseudotime)^2 }) metric <- tibble(bic = bic_df$bic.marginal, r2 = r2, Method = paste0(\"perturb \",seq(0,100,by = 10), \"%\")) p_pseudotime_metric <- metric %>% ggplot(aes(x = r2, y = bic,label = Method)) + geom_point() + theme_bw() + theme(aspect.ratio = 1,     panel.grid.minor = element_blank(),     panel.grid.major = element_blank()) + ggpubr::stat_cor(method = \"spearman\", cor.coef.name = \"rho\", label.x.npc = \"left\", label.y.npc = 0.5) + ylab(\"scDesign3 BIC\") + xlab(\"R2 (truth vs pseudotime)\") p_pseudotime_metric"},{"path":"/articles/scDesign3-pseudotimeGOF-vignette.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Evaluate pseudotime goodness-of-fit by scDesign3","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Ubuntu 20.04.6 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0 #>  #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Los_Angeles #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] dplyr_1.1.2                 ggplot2_3.4.2               #>  [3] SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2 #>  [5] Biobase_2.60.0              GenomicRanges_1.52.0        #>  [7] GenomeInfoDb_1.36.1         IRanges_2.34.1              #>  [9] S4Vectors_0.38.1            BiocGenerics_0.46.0         #> [11] MatrixGenerics_1.12.2       matrixStats_1.0.0           #> [13] dyngen_1.0.5                scDesign3_0.99.6            #> [15] BiocStyle_2.28.0            #>  #> loaded via a namespace (and not attached): #>   [1] bitops_1.0-7            pbapply_1.7-2           gridExtra_2.3           #>   [4] remotes_2.4.2.1         rlang_1.1.1             magrittr_2.0.3          #>   [7] gamlss_5.4-12           compiler_4.3.1          mgcv_1.9-0              #>  [10] systemfonts_1.0.4       vctrs_0.6.3             stringr_1.5.0           #>  [13] pkgconfig_2.0.3         crayon_1.5.2            fastmap_1.1.1           #>  [16] backports_1.4.1         XVector_0.40.0          labeling_0.4.2          #>  [19] lmds_0.1.0              ggraph_2.1.0            utf8_1.2.3              #>  [22] rmarkdown_2.23          tzdb_0.4.0              ragg_1.2.5              #>  [25] purrr_1.0.1             xfun_0.39               zlibbioc_1.46.0         #>  [28] cachem_1.0.8            jsonlite_1.8.7          highr_0.10              #>  [31] DelayedArray_0.26.6     tweenr_2.0.2            broom_1.0.5             #>  [34] irlba_2.3.5.1           parallel_4.3.1          R6_2.5.1                #>  [37] bslib_0.5.0             stringi_1.7.12          car_3.1-2               #>  [40] jquerylib_0.1.4         Rcpp_1.0.11             bookdown_0.34           #>  [43] assertthat_0.2.1        knitr_1.43              readr_2.1.4             #>  [46] dynutils_1.0.11         Matrix_1.6-0            splines_4.3.1           #>  [49] igraph_1.5.0.1          tidyselect_1.2.0        abind_1.4-5             #>  [52] yaml_2.3.7              viridis_0.6.4           gamlss.dist_6.0-5       #>  [55] codetools_0.2-19        lattice_0.21-8          tibble_3.2.1            #>  [58] withr_2.5.0             evaluate_0.21           desc_1.4.2              #>  [61] survival_3.5-5          RcppParallel_5.1.7      polyclip_1.10-4         #>  [64] mclust_6.0.0            ggpubr_0.6.0            pillar_1.9.0            #>  [67] BiocManager_1.30.21.1   carData_3.0-5           generics_0.1.3          #>  [70] rprojroot_2.0.3         RCurl_1.98-1.12         hms_1.1.3               #>  [73] munsell_0.5.0           scales_1.2.1            RcppXPtrUtils_0.1.2     #>  [76] glue_1.6.2              proxyC_0.3.3            tools_4.3.1             #>  [79] ggsignif_0.6.4          fs_1.6.3                graphlayouts_1.0.0      #>  [82] tidygraph_1.2.3         GillespieSSA2_0.3.0     grid_4.3.1              #>  [85] tidyr_1.3.0             colorspace_2.1-0        nlme_3.1-162            #>  [88] GenomeInfoDbData_1.2.10 patchwork_1.1.2         ggforce_0.4.1           #>  [91] cli_3.6.1               textshaping_0.3.6       fansi_1.0.4             #>  [94] S4Arrays_1.0.4          viridisLite_0.4.2       gtable_0.3.3            #>  [97] rstatix_0.7.2           sass_0.4.7              digest_0.6.33           #> [100] gamlss.data_6.0-2       ggrepel_0.9.3           farver_2.1.1            #> [103] memoise_2.0.1           htmltools_0.5.5         pkgdown_2.0.7           #> [106] lifecycle_1.0.3         MASS_7.3-60"},{"path":"/articles/scDesign3-scATACseq-vignette.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Simulate single-cell ATAC-seq data","text":"tutorial, show use scDesign3 simulate peak cell matrix scATAC-seq data.","code":""},{"path":"/articles/scDesign3-scATACseq-vignette.html","id":"read-in-the-reference-data","dir":"Articles","previous_headings":"","what":"Read in the reference data","title":"Simulate single-cell ATAC-seq data","text":"raw data Signac, human peripheral blood mononuclear cells (PBMCs) provided 10x Genomics. pre-select differentially accessible peaks clusters. save time, subset 1000 cells.","code":"example_sce <- readRDS((url(\"https://figshare.com/ndownloader/files/40581962\"))) print(example_sce) #> class: SingleCellExperiment  #> dim: 1133 7034  #> metadata(0): #> assays(2): counts logcounts #> rownames(1133): chr6-44025105-44028184 chr2-113581628-113594911 ... #>   chr2-233174300-233175622 chr3-13015237-13015864 #> rowData names(0): #> colnames(7034): AAACGAAAGAGCGAAA-1 AAACGAAAGAGTTTGA-1 ... #>   TTTGTGTTCTACTTTG-1 TTTGTGTTCTTGTGCC-1 #> colData names(31): orig.ident nCount_peaks ... ident cell_type #> reducedDimNames(2): LSI UMAP #> mainExpName: peaks #> altExpNames(0): set.seed(123) example_sce <- example_sce[, sample(seq_len(dim(example_sce)[2]), 1000, replace = FALSE)]"},{"path":"/articles/scDesign3-scATACseq-vignette.html","id":"simulation","dir":"Articles","previous_headings":"","what":"Simulation","title":"Simulate single-cell ATAC-seq data","text":"choose Zero-inflated Poisson (ZIP) distribution due good empirical performance. Users may explore distributions (Poisson, NB, ZINB) since conclusion best distribution ATAC-seq. also run TF-IDF transformation.","code":"set.seed(123) example_simu <- scdesign3(         sce = example_sce,     assay_use = \"counts\",     celltype = \"cell_type\",     pseudotime = NULL,     spatial = NULL,     other_covariates = NULL,     mu_formula = \"cell_type\",     sigma_formula = \"1\",     family_use = \"zip\",     n_cores = 1,     usebam = FALSE,     corr_formula = \"cell_type\",     copula = \"gaussian\",     DT = TRUE,     pseudo_obs = FALSE,     return_model = FALSE,     nonzerovar = FALSE   ) tf_idf <- function(Y){   frequences <- colSums(Y)   nfreqs <- t(apply(Y, 1, function(x){x/frequences}))   nfreqs[is.na(nfreqs)] <- 0   idf <- log(1 + ncol(Y)) - log(rowSums(Y > 0) + 1) + 1   Y_idf <- apply(nfreqs, 2, function(x){x * idf})   return(Y_idf) } assay(example_sce, \"tfidf\") <- as.matrix(tf_idf(counts(example_sce))) simu_sce <- SingleCellExperiment(list(counts = example_simu$new_count), colData = example_simu$new_covariate) assay(simu_sce, \"tfidf\") <- as.matrix(tf_idf(counts(simu_sce)))"},{"path":"/articles/scDesign3-scATACseq-vignette.html","id":"visualization","dir":"Articles","previous_headings":"","what":"Visualization","title":"Simulate single-cell ATAC-seq data","text":"","code":"set.seed(123) compare_figure <- plot_reduceddim(ref_sce = example_sce,                                   sce_list = list(simu_sce),                                   name_vec = c(\"Reference\", \"scDesign3\"),                                   assay_use = \"tfidf\",                                   if_plot = TRUE,                                   color_by = \"cell_type\",                                   n_pc = 20) plot(compare_figure$p_umap)"},{"path":"/articles/scDesign3-scATACseq-vignette.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Simulate single-cell ATAC-seq data","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Ubuntu 20.04.6 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0 #>  #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Los_Angeles #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] ggplot2_3.4.2               SingleCellExperiment_1.22.0 #>  [3] SummarizedExperiment_1.30.2 Biobase_2.60.0              #>  [5] GenomicRanges_1.52.0        GenomeInfoDb_1.36.1         #>  [7] IRanges_2.34.1              S4Vectors_0.38.1            #>  [9] BiocGenerics_0.46.0         MatrixGenerics_1.12.2       #> [11] matrixStats_1.0.0           scDesign3_0.99.6            #> [13] BiocStyle_2.28.0            #>  #> loaded via a namespace (and not attached): #>  [1] tidyselect_1.2.0        farver_2.1.1            dplyr_1.1.2             #>  [4] bitops_1.0-7            fastmap_1.1.1           RCurl_1.98-1.12         #>  [7] digest_0.6.33           lifecycle_1.0.3         survival_3.5-5          #> [10] gamlss.dist_6.0-5       magrittr_2.0.3          compiler_4.3.1          #> [13] rlang_1.1.1             sass_0.4.7              tools_4.3.1             #> [16] utf8_1.2.3              yaml_2.3.7              knitr_1.43              #> [19] askpass_1.1             S4Arrays_1.0.4          labeling_0.4.2          #> [22] mclust_6.0.0            reticulate_1.30         DelayedArray_0.26.6     #> [25] withr_2.5.0             purrr_1.0.1             desc_1.4.2              #> [28] grid_4.3.1              fansi_1.0.4             colorspace_2.1-0        #> [31] scales_1.2.1            MASS_7.3-60             cli_3.6.1               #> [34] mvtnorm_1.2-2           rmarkdown_2.23          crayon_1.5.2            #> [37] ragg_1.2.5              generics_0.1.3          umap_0.2.10.0           #> [40] RSpectra_0.16-1         cachem_1.0.8            stringr_1.5.0           #> [43] zlibbioc_1.46.0         splines_4.3.1           parallel_4.3.1          #> [46] BiocManager_1.30.21.1   XVector_0.40.0          vctrs_0.6.3             #> [49] Matrix_1.6-0            jsonlite_1.8.7          bookdown_0.34           #> [52] gamlss_5.4-12           irlba_2.3.5.1           systemfonts_1.0.4       #> [55] jquerylib_0.1.4         glue_1.6.2              pkgdown_2.0.7           #> [58] stringi_1.7.12          gtable_0.3.3            munsell_0.5.0           #> [61] tibble_3.2.1            pillar_1.9.0            htmltools_0.5.5         #> [64] openssl_2.1.0           gamlss.data_6.0-2       GenomeInfoDbData_1.2.10 #> [67] R6_2.5.1                textshaping_0.3.6       rprojroot_2.0.3         #> [70] evaluate_0.21           lattice_0.21-8          highr_0.10              #> [73] png_0.1-8               memoise_2.0.1           bslib_0.5.0             #> [76] Rcpp_1.0.11             nlme_3.1-162            mgcv_1.9-0              #> [79] xfun_0.39               fs_1.6.3                pkgconfig_2.0.3"},{"path":"/articles/scDesign3-spatial-deconvolution.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Simulate spot-resolution spatial data for cell-type deconvolution","text":"tutorial, show use scDesign3 simulate spot-resolution spatial data, spot mix cells different cell types.","code":""},{"path":"/articles/scDesign3-spatial-deconvolution.html","id":"read-in-the-reference-data","dir":"Articles","previous_headings":"","what":"Read in the reference data","title":"Simulate spot-resolution spatial data for cell-type deconvolution","text":"paired scRNA-seq spatial data used CARD. pre-select top cell-type marker genes.","code":"MOBSC_sce <- readRDS((url(\"https://figshare.com/ndownloader/files/40581983\"))) MOBSP_sce <- readRDS((url(\"https://figshare.com/ndownloader/files/40581986\"))) print(MOBSC_sce) #> class: SingleCellExperiment  #> dim: 182 12640  #> metadata(0): #> assays(2): counts logcounts #> rownames(182): Grin2b Prkca ... Zic1 Tpi1 #> rowData names(1): rownames.count. #> colnames(12640): WT1_AAACCTGAGCTGCGAA WT1_AAACCTGGTTTGGCGC ... #>   OC2_TAGTTGGTCGCGATCG OC2_TTGCGTCAGGATCGCA #> colData names(4): cellType sampleInfo sizeFactor cell_type #> reducedDimNames(0): #> mainExpName: NULL #> altExpNames(0): print(MOBSP_sce) #> class: SingleCellExperiment  #> dim: 182 278  #> metadata(0): #> assays(1): counts #> rownames(182): Grin2b Prkca ... Zic1 Tpi1 #> rowData names(0): #> colnames(278): 16.918x16.996 18.017x17.034 ... 25.134x28.934 #>   29.961x18.97 #> colData names(2): spatial1 spatial2 #> reducedDimNames(0): #> mainExpName: NULL #> altExpNames(0): cell_type <- unique(colData(MOBSC_sce)$cellType)"},{"path":"/articles/scDesign3-spatial-deconvolution.html","id":"simulation","dir":"Articles","previous_headings":"","what":"Simulation","title":"Simulate spot-resolution spatial data for cell-type deconvolution","text":"first use scDesign3 estimate cell-type reference scRNA-seq data. Now get fitted models scRNA-seq spatial data. need extract mean parameters (.e., expected expression values). use CIBERSORT decompose spot’s expected expression cell-type proportions. step set true cell-type proportions. Please note can also use decomposition methods set proportion mannully design. can visualzie proportions pie-chart.  can simulate new spatial data spot sum 50 cells/5 (therefore average 10 cells per spot). Increasing number cells make spatial data smoother (closer expected spatial expression). Finally, can check simulated results. use four cell-type marker genes example.","code":"set.seed(123) MOBSC_data <- construct_data(   sce = MOBSC_sce,   assay_use = \"counts\",   celltype = \"cell_type\",   pseudotime = NULL,   spatial = NULL,   other_covariates = NULL,   corr_by = \"1\" )  MOBSC_marginal <- fit_marginal(   data = MOBSC_data,   predictor = \"gene\",   mu_formula = \"cell_type\",   sigma_formula = \"cell_type\",   family_use = \"nb\",   n_cores = 2,   usebam = FALSE,   parallelization = \"pbmcmapply\"  )  MOBSC_copula <- fit_copula(   sce = MOBSC_sce,   assay_use = \"counts\",   marginal_list = MOBSC_marginal,   family_use = \"nb\",   copula = \"gaussian\",   n_cores = 2,   input_data = MOBSC_data$dat )  MOBSC_para <- extract_para(   sce = MOBSC_sce,   marginal_list = MOBSC_marginal,   n_cores = 2,   family_use = \"nb\",   new_covariate = MOBSC_data$newCovariate,   data = MOBSC_data$dat )  MOBSC_newcount <- simu_new(   sce = MOBSC_sce,   mean_mat = MOBSC_para$mean_mat,   sigma_mat = MOBSC_para$sigma_mat,   zero_mat = MOBSC_para$zero_mat,   quantile_mat = NULL,   copula_list = MOBSC_copula$copula_list,   n_cores = 2,   family_use = \"nb\",   input_data = MOBSC_data$dat,   new_covariate = MOBSC_data$newCovariate,   filtered_gene = MOBSC_data$filtered_gene ) set.seed(123) MOBSP_data <- construct_data(   sce = MOBSP_sce,   assay_use = \"counts\",   celltype = NULL,   pseudotime = NULL,   spatial = c(\"spatial1\", \"spatial2\"),   other_covariates = NULL,   corr_by = \"1\" )  MOBSP_marginal <- fit_marginal(   data = MOBSP_data,   predictor = \"gene\",   mu_formula = \"s(spatial1, spatial2, bs = 'gp', k = 50, m = c(1, 2, 1))\",   sigma_formula = \"1\",   family_use = \"nb\",   n_cores = 2,   usebam = FALSE,    parallelization = \"pbmcmapply\"    )  MOBSP_copula <- fit_copula(   sce = MOBSP_sce,   assay_use = \"counts\",   marginal_list = MOBSP_marginal,   family_use = \"nb\",   copula = \"gaussian\",   n_cores = 2,   input_data = MOBSP_data$dat )  MOBSP_para <- extract_para(   sce = MOBSP_sce,   marginal_list = MOBSP_marginal,   n_cores = 2,   family_use = \"nb\",   new_covariate = MOBSP_data$newCovariate,   data = MOBSP_data$dat ) MOBSC_sig_matrix <- sapply(cell_type, function(x) {   rowMeans(t(MOBSC_para$mean_mat)[, colData(MOBSC_sce)$cellType %in% x]) })  MOBSP_matrix <- (t(MOBSP_para$mean_mat)) sig_matrix <- as.data.frame(MOBSC_sig_matrix) mixture_file <- as.data.frame(MOBSP_matrix)  proportion_mat <- IOBR::CIBERSORT(sig_matrix, mixture_file, QN = FALSE, absolute = FALSE, perm = 10) proportion_mat <- proportion_mat[, 1:4] colors_cell_type <- c(\"#E69F00\", \"#56B4E9\", \"#009E73\",                         \"#0072B2\") d_pie <- as_tibble(colData(MOBSP_sce), rownames = \"cell\") %>% bind_cols(as_tibble(proportion_mat)) %>% dplyr::mutate(region = seq_len(dim(MOBSP_sce)[2])) %>% dplyr::mutate(X= spatial1, Y = spatial2)  p_pie_plot <- ggplot() + geom_scatterpie(aes(x=X, y=Y, group=region), data=d_pie ,                            cols = cell_type, color=NA) + coord_fixed(ratio = 1) +                                  scale_fill_manual(values = colors_cell_type) + coord_equal()+ theme_bw() + theme(legend.position = \"left\")  + theme(     panel.grid.minor = element_blank(),     panel.grid.major = element_blank(),     axis.text.x=element_blank(),     axis.ticks.x=element_blank(),     axis.text.y=element_blank(),     axis.ticks.y=element_blank())+ guides(fill=guide_legend(title=\"Cell type\")) p_pie_plot set.seed(123) MOBSCSIM_sce <- MOBSC_sce counts(MOBSCSIM_sce) <- MOBSC_newcount  MOBSP_new_mixture <- (apply(proportion_mat, 1, function(x) {   n = 50   rowSums(sapply(cell_type, function(y) {     index <- sample(which(colData(MOBSCSIM_sce)$cell_type==y), size = n, replace = FALSE)     rowSums(MOBSC_newcount[, index])*x[y]   })) }))  MOBSP_new_mixture <- MOBSP_new_mixture/5  ### Ceiling to integer MOBSP_new_mixture <- ceiling(MOBSP_new_mixture)  MOBSPMIX_sce <- MOBSP_sce counts(MOBSPMIX_sce) <- as.matrix(MOBSP_new_mixture) MOBSC_sig_matrix <- sapply(cell_type, function(x) {   rowMeans(t(MOBSC_para$mean_mat)[, colData(MOBSC_sce)$cellType %in% x]) }) MOBSP_sc_mixture <- tcrossprod(as.matrix(MOBSC_sig_matrix), as.matrix(proportion_mat))  rownames(MOBSP_sc_mixture) <- rownames(MOBSP_new_mixture)  location <- colData(MOBSP_sce) MOBSP_real_tbl <- as_tibble(t(log1p(counts(MOBSP_sce)))) %>% dplyr::mutate(X = location$spatial1,                                              Y = location$spatial2) %>%   tidyr::pivot_longer(-c(\"X\", \"Y\"), names_to = \"Gene\", values_to = \"Expression\") %>% dplyr::mutate(Method = \"Real data\")  MOBSP_real_tbl <- transform(MOBSP_real_tbl, Expression=ave(Expression, Gene, FUN=scales::rescale))   MOBSP_mixture_tbl <- as_tibble(t(log1p(MOBSP_new_mixture))) %>% dplyr::mutate(X = location$spatial1,                                              Y = location$spatial2) %>%   tidyr::pivot_longer(-c(\"X\", \"Y\"), names_to = \"Gene\", values_to = \"Expression\") %>% dplyr::mutate(Method = \"scDesign3\")  MOBSP_mixture_tbl <- transform(MOBSP_mixture_tbl, Expression=ave(Expression, Gene, FUN=scales::rescale))  MOBSP_tbl <- bind_rows(list(MOBSP_real_tbl, MOBSP_mixture_tbl))  MOBSC_marker <- c(\"Penk\", \"Apold1\", \"Cdhr1\", \"S100a5\")  p_MOB_prop <- MOBSP_tbl %>% dplyr::filter(Gene %in% MOBSC_marker) %>% dplyr::mutate(Gene = factor(Gene, levels = MOBSC_marker)) %>% ggplot(aes(x = X, y = Y, color = Expression))  + ggrastr::rasterize(geom_point(size = 1), dpi = 300) + scale_colour_gradientn(colors = viridis_pal(option = \"B\", direction = -1)(10), limits=c(0, 1)) + coord_fixed(ratio = 1) + facet_grid(Method ~ Gene ) + theme_bw() + theme(legend.position = \"right\")  + theme(     panel.grid.minor = element_blank(),     panel.grid.major = element_blank(),     axis.text.x=element_blank(),     axis.ticks.x=element_blank(),     axis.text.y=element_blank(),     axis.ticks.y=element_blank()) p_MOB_prop"},{"path":"/articles/scDesign3-spatial-deconvolution.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Simulate spot-resolution spatial data for cell-type deconvolution","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Ubuntu 20.04.6 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0 #>  #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Los_Angeles #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] grid      stats4    stats     graphics  grDevices utils     datasets  #> [8] methods   base      #>  #> other attached packages: #>  [1] scatterpie_0.2.1            IOBR_0.99.9                 #>  [3] tidyHeatmap_1.8.1           ComplexHeatmap_2.16.0       #>  [5] survival_3.5-5              ggpubr_0.6.0                #>  [7] tibble_3.2.1                viridis_0.6.4               #>  [9] viridisLite_0.4.2           dplyr_1.1.2                 #> [11] ggplot2_3.4.2               SingleCellExperiment_1.22.0 #> [13] SummarizedExperiment_1.30.2 Biobase_2.60.0              #> [15] GenomicRanges_1.52.0        GenomeInfoDb_1.36.1         #> [17] IRanges_2.34.1              S4Vectors_0.38.1            #> [19] BiocGenerics_0.46.0         MatrixGenerics_1.12.2       #> [21] matrixStats_1.0.0           scDesign3_0.99.6            #> [23] BiocStyle_2.28.0            #>  #> loaded via a namespace (and not attached): #>   [1] splines_4.3.1             bitops_1.0-7              #>   [3] polyclip_1.10-4           preprocessCore_1.62.1     #>   [5] graph_1.78.0              XML_3.99-0.14             #>   [7] gamlss.data_6.0-2         lifecycle_1.0.3           #>   [9] rstatix_0.7.2             pbmcapply_1.5.1           #>  [11] doParallel_1.0.17         rprojroot_2.0.3           #>  [13] lattice_0.21-8            MASS_7.3-60               #>  [15] dendextend_1.17.1         backports_1.4.1           #>  [17] magrittr_2.0.3            limma_3.56.2              #>  [19] sass_0.4.7                rmarkdown_2.23            #>  [21] jquerylib_0.1.4           yaml_2.3.7                #>  [23] cowplot_1.1.1             DBI_1.1.3                 #>  [25] RColorBrewer_1.1-3        abind_1.4-5               #>  [27] zlibbioc_1.46.0           quadprog_1.5-8            #>  [29] purrr_1.0.1               RCurl_1.98-1.12           #>  [31] tweenr_2.0.2              circlize_0.4.15           #>  [33] GenomeInfoDbData_1.2.10   KMsurv_0.1-5              #>  [35] irlba_2.3.5.1             GSVA_1.48.2               #>  [37] annotate_1.78.0           pkgdown_2.0.7             #>  [39] DelayedMatrixStats_1.22.1 codetools_0.2-19          #>  [41] DelayedArray_0.26.6       ggforce_0.4.1             #>  [43] tidyselect_1.2.0          shape_1.4.6               #>  [45] farver_2.1.1              ScaledMatrix_1.8.1        #>  [47] jsonlite_1.8.7            GetoptLong_1.0.5          #>  [49] e1071_1.7-13              iterators_1.0.14          #>  [51] systemfonts_1.0.4         foreach_1.5.2             #>  [53] tools_4.3.1               ragg_1.2.5                #>  [55] Rcpp_1.0.11               glue_1.6.2                #>  [57] gridExtra_2.3             mgcv_1.9-0                #>  [59] xfun_0.39                 DESeq2_1.40.2             #>  [61] HDF5Array_1.28.1          withr_2.5.0               #>  [63] BiocManager_1.30.21.1     fastmap_1.1.1             #>  [65] rhdf5filters_1.12.1       fansi_1.0.4               #>  [67] digest_0.6.33             rsvd_1.0.5                #>  [69] gamlss_5.4-12             R6_2.5.1                  #>  [71] textshaping_0.3.6         colorspace_2.1-0          #>  [73] Cairo_1.6-0               lpSolve_5.6.18            #>  [75] RSQLite_2.3.1             utf8_1.2.3                #>  [77] tidyr_1.3.0               generics_0.1.3            #>  [79] data.table_1.14.8         class_7.3-22              #>  [81] httr_1.4.6                S4Arrays_1.0.4            #>  [83] pkgconfig_2.0.3           gtable_0.3.3              #>  [85] blob_1.2.4                XVector_0.40.0            #>  [87] survMisc_0.5.6            htmltools_0.5.5           #>  [89] carData_3.0-5             bookdown_0.34             #>  [91] GSEABase_1.62.0           clue_0.3-64               #>  [93] scales_1.2.1              tidyverse_2.0.0           #>  [95] png_0.1-8                 corrplot_0.92             #>  [97] ggfun_0.1.1               knitr_1.43                #>  [99] km.ci_0.5-6               rjson_0.2.21              #> [101] nlme_3.1-162              proxy_0.4-27              #> [103] cachem_1.0.8              zoo_1.8-12                #> [105] rhdf5_2.44.0              GlobalOptions_0.1.2       #> [107] stringr_1.5.0             vipor_0.4.5               #> [109] parallel_4.3.1            AnnotationDbi_1.62.2      #> [111] ggrastr_1.0.2             desc_1.4.2                #> [113] pillar_1.9.0              vctrs_0.6.3               #> [115] car_3.1-2                 BiocSingular_1.16.0       #> [117] beachmat_2.16.0           xtable_1.8-4              #> [119] cluster_2.1.4             beeswarm_0.4.0            #> [121] gamlss.dist_6.0-5         evaluate_0.21             #> [123] mvtnorm_1.2-2             cli_3.6.1                 #> [125] locfit_1.5-9.8            compiler_4.3.1            #> [127] rlang_1.1.1               crayon_1.5.2              #> [129] ggsignif_0.6.4            labeling_0.4.2            #> [131] survminer_0.4.9           mclust_6.0.0              #> [133] ggbeeswarm_0.7.2          fs_1.6.3                  #> [135] stringi_1.7.12            BiocParallel_1.34.2       #> [137] munsell_0.5.0             Biostrings_2.68.1         #> [139] limSolve_1.5.6            glmnet_4.1-7              #> [141] Matrix_1.6-0              patchwork_1.1.2           #> [143] sparseMatrixStats_1.12.2  bit64_4.0.5               #> [145] Rhdf5lib_1.22.0           KEGGREST_1.40.0           #> [147] highr_0.10                broom_1.0.5               #> [149] memoise_2.0.1             bslib_0.5.0               #> [151] bit_4.0.5"},{"path":"/articles/scDesign3-spatial-vignette.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Simulate spatial transcriptomic data","text":"tutorial, show use scDesign3 simulate single-cell spatial data.","code":""},{"path":"/articles/scDesign3-spatial-vignette.html","id":"read-in-the-reference-data","dir":"Articles","previous_headings":"","what":"Read in the reference data","title":"Simulate spatial transcriptomic data","text":"raw data Seurat, dataset generated Visium technology 10x Genomics. pre-select top spatial variable genes. save time, subset top 10 genes.","code":"example_sce <- readRDS((url(\"https://figshare.com/ndownloader/files/40582019\"))) print(example_sce) #> class: SingleCellExperiment  #> dim: 1000 2696  #> metadata(0): #> assays(2): counts logcounts #> rownames(1000): Calb2 Gng4 ... Fndc5 Gda #> rowData names(0): #> colnames(2696): AAACAAGTATCTCCCA-1 AAACACCAATAACTGC-1 ... #>   TTGTTTCACATCCAGG-1 TTGTTTCCATACAACT-1 #> colData names(12): orig.ident nCount_Spatial ... spatial2 cell_type #> reducedDimNames(0): #> mainExpName: NULL #> altExpNames(0): example_sce <- example_sce[1:10, ]"},{"path":"/articles/scDesign3-spatial-vignette.html","id":"simulation","dir":"Articles","previous_headings":"","what":"Simulation","title":"Simulate spatial transcriptomic data","text":", can use spatial dataset generate new data setting parameter mu_formula smooth terms spatial coordinates. , can create SinglecellExperiment object using synthetic count matrix store logcounts input synthetic SinglecellExperiment objects.","code":"set.seed(123) example_simu <- scdesign3(     sce = example_sce,     assay_use = \"counts\",     celltype = \"cell_type\",     pseudotime = NULL,     spatial = c(\"spatial1\", \"spatial2\"),     other_covariates = NULL,     mu_formula = \"s(spatial1, spatial2, bs = 'gp', k= 400)\",     sigma_formula = \"1\",     family_use = \"nb\",     n_cores = 2,     usebam = FALSE,     corr_formula = \"1\",     copula = \"gaussian\",     DT = TRUE,     pseudo_obs = FALSE,     return_model = FALSE,     nonzerovar = FALSE,     parallelization = \"pbmcapply\"   ) simu_sce <- SingleCellExperiment(list(counts = example_simu$new_count), colData = example_simu$new_covariate) logcounts(simu_sce) <- log1p(counts(simu_sce))"},{"path":"/articles/scDesign3-spatial-vignette.html","id":"visualization","dir":"Articles","previous_headings":"","what":"Visualization","title":"Simulate spatial transcriptomic data","text":"reformat reference data synthetic data visualize genes’ expressions spatial locations.","code":"VISIUM_dat_test <- data.frame(t(log1p(counts(example_sce)))) %>% as_tibble() %>% dplyr::mutate(X = colData(example_sce)$spatial1, Y = colData(example_sce)$spatial2) %>% tidyr::pivot_longer(-c(\"X\", \"Y\"), names_to = \"Gene\", values_to = \"Expression\") %>% dplyr::mutate(Method = \"Reference\") VISIUM_dat_scDesign3 <- data.frame(t(log1p(counts(simu_sce)))) %>% as_tibble() %>% dplyr::mutate(X = colData(simu_sce)$spatial1, Y = colData(simu_sce)$spatial2) %>% tidyr::pivot_longer(-c(\"X\", \"Y\"), names_to = \"Gene\", values_to = \"Expression\") %>% dplyr::mutate(Method = \"scDesign3\") VISIUM_dat <- bind_rows(VISIUM_dat_test, VISIUM_dat_scDesign3) %>% dplyr::mutate(Method = factor(Method, levels = c(\"Reference\", \"scDesign3\")))  VISIUM_dat %>% filter(Gene %in% rownames(example_sce)[1:5]) %>% ggplot(aes(x = X, y = Y, color = Expression)) + geom_point(size = 0.5) + scale_colour_gradientn(colors = viridis_pal(option = \"magma\")(10), limits=c(0, 8)) + coord_fixed(ratio = 1) + facet_grid(Method ~ Gene )+ theme_gray()"},{"path":"/articles/scDesign3-spatial-vignette.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Simulate spatial transcriptomic data","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Ubuntu 20.04.6 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0 #>  #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Los_Angeles #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] viridis_0.6.4               viridisLite_0.4.2           #>  [3] dplyr_1.1.2                 ggplot2_3.4.2               #>  [5] SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2 #>  [7] Biobase_2.60.0              GenomicRanges_1.52.0        #>  [9] GenomeInfoDb_1.36.1         IRanges_2.34.1              #> [11] S4Vectors_0.38.1            BiocGenerics_0.46.0         #> [13] MatrixGenerics_1.12.2       matrixStats_1.0.0           #> [15] scDesign3_0.99.6            BiocStyle_2.28.0            #>  #> loaded via a namespace (and not attached): #>  [1] gtable_0.3.3            xfun_0.39               bslib_0.5.0             #>  [4] lattice_0.21-8          gamlss_5.4-12           vctrs_0.6.3             #>  [7] tools_4.3.1             bitops_1.0-7            generics_0.1.3          #> [10] parallel_4.3.1          tibble_3.2.1            fansi_1.0.4             #> [13] highr_0.10              pkgconfig_2.0.3         Matrix_1.6-0            #> [16] desc_1.4.2              lifecycle_1.0.3         GenomeInfoDbData_1.2.10 #> [19] farver_2.1.1            compiler_4.3.1          stringr_1.5.0           #> [22] textshaping_0.3.6       munsell_0.5.0           htmltools_0.5.5         #> [25] sass_0.4.7              RCurl_1.98-1.12         yaml_2.3.7              #> [28] tidyr_1.3.0             crayon_1.5.2            pillar_1.9.0            #> [31] pkgdown_2.0.7           jquerylib_0.1.4         MASS_7.3-60             #> [34] DelayedArray_0.26.6     cachem_1.0.8            mclust_6.0.0            #> [37] nlme_3.1-162            tidyselect_1.2.0        digest_0.6.33           #> [40] mvtnorm_1.2-2           stringi_1.7.12          purrr_1.0.1             #> [43] bookdown_0.34           labeling_0.4.2          splines_4.3.1           #> [46] gamlss.dist_6.0-5       rprojroot_2.0.3         fastmap_1.1.1           #> [49] grid_4.3.1              gamlss.data_6.0-2       colorspace_2.1-0        #> [52] cli_3.6.1               magrittr_2.0.3          S4Arrays_1.0.4          #> [55] survival_3.5-5          utf8_1.2.3              withr_2.5.0             #> [58] scales_1.2.1            XVector_0.40.0          rmarkdown_2.23          #> [61] gridExtra_2.3           ragg_1.2.5              memoise_2.0.1           #> [64] evaluate_0.21           knitr_1.43              mgcv_1.9-0              #> [67] rlang_1.1.1             glue_1.6.2              BiocManager_1.30.21.1   #> [70] jsonlite_1.8.7          R6_2.5.1                zlibbioc_1.46.0         #> [73] systemfonts_1.0.4       fs_1.6.3"},{"path":"/articles/scDesign3.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"scDesign3 Quickstart","text":"scDesign3 unified probabilistic framework generates realistic silico high-dimensional single-cell omics data various cell states, including discrete cell types, continuous trajectories, spatial locations learning real datasets. Since functions scDesign3 comprehensive, introduce scDesign3 simulates scRNA-seq dataset one continuous developmental trajectory. information, please check Articles website: (https://songdongyuan1994.github.io/scDesign3/docs/index.html).","code":""},{"path":"/articles/scDesign3.html","id":"read-in-the-reference-data","dir":"Articles","previous_headings":"","what":"Read in the reference data","title":"scDesign3 Quickstart","text":"raw data scvelo, describes pancreatic endocrinogenesis. pre-select top 1000 highly variable genes filter cell types ensure single trajectory. save computational time, use top 100 genes.","code":"example_sce <- readRDS((url(\"https://figshare.com/ndownloader/files/40581992\"))) print(example_sce) #> class: SingleCellExperiment  #> dim: 1000 2087  #> metadata(5): clusters_coarse_colors clusters_colors day_colors #>   neighbors pca #> assays(6): X spliced ... cpm logcounts #> rownames(1000): Pyy Iapp ... Eya2 Kif21a #> rowData names(1): highly_variable_genes #> colnames(2087): AAACCTGAGAGGGATA AAACCTGGTAAGTGGC ... TTTGTCAAGTGACATA #>   TTTGTCAAGTGTGGCA #> colData names(7): clusters_coarse clusters ... sizeFactor pseudotime #> reducedDimNames(4): X_pca X_umap PCA UMAP #> mainExpName: NULL #> altExpNames(0): example_sce <- example_sce[1:100, ]"},{"path":"/articles/scDesign3.html","id":"simulation","dir":"Articles","previous_headings":"","what":"Simulation","title":"scDesign3 Quickstart","text":"function scdesign3() takes SinglecellExperiment object cell covariates (cell types, pesudotime, spatial coordinates) stored colData SinglecellExperiment object. output scdesign3() list includes: new_count: synthetic count matrix generated scdesign3(). parameter ncell set number different number cells input data, matrix new cell covariates used generating new data. parameter ncell default value, NULL. model_aic: vector include genes’ marginal models’ AIC, fitted copula’s AIC, total AIC, sum previous two AIC. model_bic: vector include genes’ marginal models’ BIC, fitted copula’s BIC, total BIC, sum previous two BIC. parameter return_model set TRUE, list contains fitted gam gamlss model genes input data. parameter return_model set default value FALSE, NULL. parameter return_model set TRUE, list contains either correlation matrix (copula = \"gaussian\") fitted vine copula (copula = \"vine) user specified correlation groups (based parameter corr_by). parameter return_model set default value FALSE, NULL. example, since change parameter ncell, synthetic count matrix dimension input count matrix. , can create SinglecellExperiment object using synthetic count matrix store logcounts input synthetic SinglecellExperiment objects.","code":"set.seed(123) example_simu <- scdesign3(     sce = example_sce,     assay_use = \"counts\",     celltype = \"cell_type\",     pseudotime = \"pseudotime\",     spatial = NULL,     other_covariates = NULL,     mu_formula = \"s(pseudotime, k = 10, bs = 'cr')\",     sigma_formula = \"1\", # If you want your dispersion also varies along pseudotime, use \"s(pseudotime, k = 5, bs = 'cr')\"     family_use = \"nb\",     n_cores = 2,     usebam = FALSE,     corr_formula = \"1\",     copula = \"gaussian\",     DT = TRUE,     pseudo_obs = FALSE,     return_model = FALSE,     nonzerovar = FALSE   ) dim(example_simu$new_count) #> [1]  100 2087 logcounts(example_sce) <- log1p(counts(example_sce)) simu_sce <- SingleCellExperiment(list(counts = example_simu$new_count), colData = example_simu$new_covariate) logcounts(simu_sce) <- log1p(counts(simu_sce))"},{"path":"/articles/scDesign3.html","id":"visualization","dir":"Articles","previous_headings":"","what":"Visualization","title":"scDesign3 Quickstart","text":"","code":"set.seed(123) compare_figure <- plot_reduceddim(ref_sce = example_sce,                                    sce_list = list(simu_sce),                                    name_vec = c(\"Reference\", \"scDesign3\"),                                   assay_use = \"logcounts\",                                    if_plot = TRUE,                                    color_by = \"pseudotime\",                                    n_pc = 20) plot(compare_figure$p_umap)"},{"path":"/articles/scDesign3.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"scDesign3 Quickstart","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Ubuntu 20.04.6 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0 #>  #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Los_Angeles #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] ggplot2_3.4.2               SingleCellExperiment_1.22.0 #>  [3] SummarizedExperiment_1.30.2 Biobase_2.60.0              #>  [5] GenomicRanges_1.52.0        GenomeInfoDb_1.36.1         #>  [7] IRanges_2.34.1              S4Vectors_0.38.1            #>  [9] BiocGenerics_0.46.0         MatrixGenerics_1.12.2       #> [11] matrixStats_1.0.0           scDesign3_0.99.6            #> [13] BiocStyle_2.28.0            #>  #> loaded via a namespace (and not attached): #>  [1] tidyselect_1.2.0        viridisLite_0.4.2       farver_2.1.1            #>  [4] dplyr_1.1.2             viridis_0.6.4           bitops_1.0-7            #>  [7] fastmap_1.1.1           RCurl_1.98-1.12         digest_0.6.33           #> [10] lifecycle_1.0.3         survival_3.5-5          gamlss.dist_6.0-5       #> [13] magrittr_2.0.3          compiler_4.3.1          rlang_1.1.1             #> [16] sass_0.4.7              tools_4.3.1             utf8_1.2.3              #> [19] yaml_2.3.7              knitr_1.43              labeling_0.4.2          #> [22] askpass_1.1             S4Arrays_1.0.4          mclust_6.0.0            #> [25] reticulate_1.30         DelayedArray_0.26.6     withr_2.5.0             #> [28] purrr_1.0.1             desc_1.4.2              grid_4.3.1              #> [31] fansi_1.0.4             colorspace_2.1-0        scales_1.2.1            #> [34] MASS_7.3-60             cli_3.6.1               mvtnorm_1.2-2           #> [37] rmarkdown_2.23          crayon_1.5.2            ragg_1.2.5              #> [40] generics_0.1.3          umap_0.2.10.0           RSpectra_0.16-1         #> [43] cachem_1.0.8            stringr_1.5.0           zlibbioc_1.46.0         #> [46] splines_4.3.1           parallel_4.3.1          BiocManager_1.30.21.1   #> [49] XVector_0.40.0          vctrs_0.6.3             Matrix_1.6-0            #> [52] jsonlite_1.8.7          bookdown_0.34           gamlss_5.4-12           #> [55] irlba_2.3.5.1           systemfonts_1.0.4       jquerylib_0.1.4         #> [58] glue_1.6.2              pkgdown_2.0.7           stringi_1.7.12          #> [61] gtable_0.3.3            munsell_0.5.0           tibble_3.2.1            #> [64] pillar_1.9.0            htmltools_0.5.5         openssl_2.1.0           #> [67] gamlss.data_6.0-2       GenomeInfoDbData_1.2.10 R6_2.5.1                #> [70] textshaping_0.3.6       rprojroot_2.0.3         evaluate_0.21           #> [73] lattice_0.21-8          highr_0.10              png_0.1-8               #> [76] memoise_2.0.1           bslib_0.5.0             Rcpp_1.0.11             #> [79] gridExtra_2.3           nlme_3.1-162            mgcv_1.9-0              #> [82] xfun_0.39               fs_1.6.3                pkgconfig_2.0.3"},{"path":"/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Dongyuan Song. Author, maintainer. Qingyang Wang. Author.","code":""},{"path":"/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Song, D., Wang, Q., Yan, G., Liu, T., & Li, J. J. (2022). unified framework realistic silico data generation statistical model inference single-cell spatial omics. bioRxiv, 2022-09.","code":"@Article{,   title = {A unified framework of realistic in silico data generation and statistical model inference for single-cell and spatial omics},   author = {Dongyuan Song and Qingyang Wang and Guanao Yan and Tianyang Liu and Jingyi Jessica Li},   journal = {bioRxiv},   pages = {2022--09},   year = {2022}, }"},{"path":"/index.html","id":"scdesign3","dir":"","previous_headings":"","what":"scDesign3","title":"A unified framework of realistic in silico data generation and statistical model inference for single-cell and spatial omics","text":"R package scDesign3 --one single-cell data simulation tool using reference datasets different cell states (cell types, trajectories spatial coordinates), different modalities (gene expression, chromatin accessibility, protein abundance, DNA methylation, etc), complex experimental designs. transparent parameters enable users alter models needed; model evaluation metrics (AIC, BIC) convenient visualization function help users select models.  Detailed tutorials illustrate various functionalities scDesign3 available website. following illustration figure summarizes usage scDesign3:  find details scDesign3, can check manuscript Nature Biotechnology: Song, D., Wang, Q., Yan, G. et al. scDesign3 generates realistic silico data multimodal single-cell spatial omics. Nat Biotechnol (2023). Please note parallel computing scDesign3 mainly designed UNIX OS; careful set n_cores.","code":""},{"path":"/index.html","id":"table-of-contents","dir":"","previous_headings":"","what":"A unified framework of realistic in silico data generation and statistical model inference for single-cell and spatial omics","title":"A unified framework of realistic in silico data generation and statistical model inference for single-cell and spatial omics","text":"Installation Quick Start Tutorials Contact Related Manuscripts","code":""},{"path":"/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"A unified framework of realistic in silico data generation and statistical model inference for single-cell and spatial omics","text":"install development version GitHub, please run: now working submitting Bioconductor provide link online.","code":"if (!require(\"devtools\", quietly = TRUE))     install.packages(\"devtools\") devtools::install_github(\"SONGDONGYUAN1994/scDesign3\")"},{"path":"/index.html","id":"quick-start","dir":"","previous_headings":"","what":"Quick Start","title":"A unified framework of realistic in silico data generation and statistical model inference for single-cell and spatial omics","text":"following code quick example running simulator. function scdesign3() takes SinglecellExperiment object cell covariates(cell types, pesudotime, spatial coordinates) stored colData SinglecellExperiment object. details SinlgeCellExperiment object, please check Bioconductor link. parameters scdesign3() : sce: SingleCellExperiment object. assay_use: string indicates assay use sce. Default ‘counts’. celltype: string column name cell type variable colData sce. Default ‘cell_type’. cell type variable colData sce factor variable. Use NULL column colData contains cell-type information. pseudotime: string string vector name pseudotime (exist) multiple lineages. Default NULL. data one lineage, parameter column name pesudotime variable colData sce. data multiple lingaes, parameter column names pseudotime variables lineage vaiables indicating lineage cell belongs . pseudotime variables continuous numeric variables. spatial: length-two string vector column names spatial coordinates colData sce. Defualt NULL. other_covariate: string string vector covariates colData sce want include data. example, can put column names batch variables /condition variables colData sce sce contains information want include variables inmu_formula sigma_formula corr_formula. mu_formula: string mu parameter formula fitting gene’s marginal distribution. sigma_formula: string sigma parameter formula fitting gene’s marginal distribution. family_use: string marginal distribution want use fitting gene’s marginal distribution. Must one ‘poisson’, ‘nb’, ‘zip’, ‘zinb’ ‘gaussian’. n_cores: integer. number cores use. usebam: logic variable. use bam (generalized additive models large datasets ) acceleration. corr_formula: string correlation structure. example, want obtain correlation structure cell type, parameter column name cell type variable colData sce. copula: string copula choice. Must one ‘gaussian’ ‘vine’. Default ‘gaussian’. Note vine copula may better modeling high-dimensions, can slow features >1000. fastmvn: logical variable. TRUE, sampling multivariate Gaussian done mvnfast, otherwise mvtnorm. Default FALSE. matters Gaussian copula. DT: logic variable. TRUE, perform distributional transformation make discrete data ‘continuous’. useful discrete distributions (e.g., Poisson, NB). Default TRUE. Note continuous data (e.g., Gaussian), DT make sense set FALSE. pseudo_obs: logic variable. TRUE, use empirical quantiles instead theoretical quantiles fitting copula. Default FALSE. family_set: string string vector bivariate copula families. Default c(“gauss”, “indep”). important_feature: string vector indicates whether gene used correlation estimation . string, string must “” “auto”, indicates genes used genes automatically selected based proportion zero expression across cells gene. Gene zero proportion greater 0.8 excluded form gene-gene correlation estimation. vector, logical vector length equal number genes sce. TRUE logical vector means corresponding gene included gene-gene correlation estimation FALSE logical vector means corresponding gene excluded gene-gene correlation estimation. default value “”. nonnegative: logical variable. TRUE, values < 0 synthetic data converted 0. Default TRUE (since expression matrix nonnegative). return_model: logic variable. TRUE, marginal models copula models returned. Default FALSE. nonzerovar: logical variable. TRUE, gene zero variance, cell replaced 1. designed avoiding potential errors, example, PCA. parallelization: string indicating specific parallelization function use. Must one ‘mcmapply’, ‘bpmapply’, ‘pbmcmapply’, corresponds parallelization function package parallel,BiocParallel, pbmcapply respectively. default value ‘mcmapply’. BPPARAM: MulticoreParam object NULL. parameter parallelization = ‘mcmapply’ ‘pbmcmapply’, parameter must NULL. parameter parallelization = ‘bpmapply’, parameter must one MulticoreParam object offered package ’BiocParallel. default value NULL. TRACE: logic variable. TRUE, warning/error log runtime gam/gamlss returned, FALSE otherwise. Default FALSE. output scdesign3() list includes: new_count: synthetic count matrix generated scdesign3(). parameter ncell set number different number cells input data, matrix new cell covariates used generating new data. parameter ncell default value, NULL. model_aic: vector include genes’ marginal models’ AIC, fitted copula’s AIC, total AIC, sum previous two. model_bic: vector include genes’ marginal models’ BIC, fitted copula’s BIC, total BIC, sum previous two. parameter return_model set TRUE, list contains fitted gam gamlss model genes input data. may greatly increase object size. parameter return_model set default value FALSE, NULL. parameter return_model set TRUE, list contains either correlation matrix (copula = \"gaussian\") fitted Vine copula (copula = \"vine\") user specified correlation groups (based parameter corr_by). parameter return_model set default value FALSE, NULL. details mu_formula sigma_formula formula specification, please check online materials package mgcv. Technically speaking, can try formulas long available mgcv.","code":"example_simu <- scdesign3(     sce = example_sce,     assay_use = \"counts\",     celltype = \"cell_type\",     pseudotime = \"pseudotime\",     spatial = NULL,     other_covariates = NULL,     mu_formula = \"s(pseudotime, k = 10, bs = 'cr')\",     sigma_formula = \"s(pseudotime, k = 5, bs = 'cr')\",     family_use = \"nb\",     n_cores = 2,     usebam = FALSE,     corr_formula = \"1\",     copula = \"gaussian\",     fastmvn = FALSE,     DT = TRUE,     pseudo_obs = FALSE,     family_set = c(\"gauss\", \"indep\"),     important_feature = \"all\",     nonnegative = TRUE,     return_model = FALSE,     nonzerovar = FALSE,     parallelization = \"mcmapply\",     BPPARAM = NULL,     trace = FALSE   )"},{"path":"/index.html","id":"tutorials","dir":"","previous_headings":"","what":"Tutorials","title":"A unified framework of realistic in silico data generation and statistical model inference for single-cell and spatial omics","text":"detailed tutorials, please check website. tutorials demonstrate applications scDesign3 following four perspectives: data simulation, model parameters, model selection, model alteration. Simulate datasets cell library size Simulate datasets multiple lineages Simulate spatial transcriptomic data Simulate spot-resolution spatial data cell-type deconvolution Simulate single-cell ATAC-seq data Simulate CITE-seq data Simulate multi-omics data multiple single-omic datasets scDesign3 introduction scDesign3 marginal distribution genes Compare Gaussian copula Vine copula Parallelization scDesign3 Evaluate clustering goodness--fit scDesign3 Evaluate pseudotime goodness--fit scDesign3 Simulate datasets /without batch effect Simulate datasets /without condition effect Simulate datasets DE test","code":""},{"path":"/index.html","id":"contact","dir":"","previous_headings":"","what":"Contact","title":"A unified framework of realistic in silico data generation and statistical model inference for single-cell and spatial omics","text":"questions suggestions scDesign3 welcomed! Please report issues, contact Dongyuan Song (dongyuansong@ucla.edu) Qingyang Wang (qw802@g.ucla.edu).","code":""},{"path":"/index.html","id":"related-manuscripts","dir":"","previous_headings":"","what":"Related Manuscripts","title":"A unified framework of realistic in silico data generation and statistical model inference for single-cell and spatial omics","text":"scDesign3: Song, D., Wang, Q., Yan, G. et al. scDesign3 generates realistic silico data multimodal single-cell spatial omics. Nat Biotechnol (2023). scDesign: Li, W. V., & Li, J. J. (2019). statistical simulator scDesign rational scRNA-seq experimental design. Bioinformatics, 35(14), i41-i50. scDesign2: Sun, T., Song, D., Li, W. V., & Li, J. J. (2021). scDesign2: transparent simulator generates high-fidelity single-cell gene expression count data gene correlations captured. Genome biology, 22(1), 1-37. scReadSim: Yan, G., Song, D., & Li, J. J. (2022). scReadSim: single-cell multi-omics read simulator. bioRxiv.","code":""},{"path":"/reference/ba.html","id":null,"dir":"Reference","previous_headings":"","what":"Functions from gamlss/gamlss.add with bugs fixed — ba","title":"Functions from gamlss/gamlss.add with bugs fixed — ba","text":"additive function used fitting GAMLSS models. interface bam() mgcv package.","code":""},{"path":"/reference/ba.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Functions from gamlss/gamlss.add with bugs fixed — ba","text":"","code":"ba(formula, control = ba.control(...), ...)"},{"path":"/reference/ba.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Functions from gamlss/gamlss.add with bugs fixed — ba","text":"formula formula model. control control model fitting. ... arguments.","code":""},{"path":"/reference/ba.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Functions from gamlss/gamlss.add with bugs fixed — ba","text":"xvar list.","code":""},{"path":"/reference/ba.html","id":"ba","dir":"Reference","previous_headings":"","what":"ba","title":"Functions from gamlss/gamlss.add with bugs fixed — ba","text":"NA","code":""},{"path":"/reference/ba.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Functions from gamlss/gamlss.add with bugs fixed — ba","text":"","code":"print(\"No example\") #> [1] \"No example\""},{"path":"/reference/construct_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Construct the input data (covaraite matrix and expression matrix) — construct_data","title":"Construct the input data (covaraite matrix and expression matrix) — construct_data","text":"function constructs input data fit_marginal.","code":""},{"path":"/reference/construct_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Construct the input data (covaraite matrix and expression matrix) — construct_data","text":"","code":"construct_data(   sce,   assay_use = \"counts\",   celltype,   pseudotime,   spatial,   other_covariates,   ncell = dim(sce)[2],   corr_by,   parallelization = \"mcmapply\",   BPPARAM = NULL )"},{"path":"/reference/construct_data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Construct the input data (covaraite matrix and expression matrix) — construct_data","text":"sce SingleCellExperiment object. assay_use string indicates assay use sce. Default 'counts'. celltype string name cell type variable colData sce. Default 'cell_type'. pseudotime string string vector name pseudotime (exist) multiple lineages. Default NULL. spatial length two string vector names spatial coordinates. Defualt NULL. other_covariates string string vector covaraites want include data. ncell number cell want simulate. Default dim(sce)[2] (number input data). arbitrary number provided, fucntion use Vine Copula simulate new covaraite matrix. corr_by string string vector indicates groups correlation structure. '1', cells one estimated corr. 'ind', corr (features independent). others, variable decides corr structures. parallelization string indicating specific parallelization function use. Must one 'mcmapply', 'bpmapply', 'pbmcmapply', corresponds parallelization function package parallel,BiocParallel, pbmcapply respectively. default value 'mcmapply'. BPPARAM MulticoreParam object NULL. parameter parallelization = 'mcmapply' 'pbmcmapply', parameter must NULL. parameter parallelization = 'bpmapply',  parameter must one MulticoreParam object offered package 'BiocParallel. default value NULL.","code":""},{"path":"/reference/construct_data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Construct the input data (covaraite matrix and expression matrix) — construct_data","text":"list components: count_mat expression matrix dat original covariate matrix newCovariate simulated new covariate matrix, NULL parameter ncell default filtered_gene genes excluded marginal copula fitting  steps genes express less two cells.","code":""},{"path":"/reference/construct_data.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Construct the input data (covaraite matrix and expression matrix) — construct_data","text":"function takes SingleCellExperiment object input. Based users' choice, constructs matrix covaraites (explainary variables) expression matrix (e.g., count matrix scRNA-seq).","code":""},{"path":"/reference/construct_data.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Construct the input data (covaraite matrix and expression matrix) — construct_data","text":"","code":"data(example_sce)   my_data <- construct_data(   sce = example_sce,   assay_use = \"counts\",   celltype = \"cell_type\",   pseudotime = \"pseudotime\",   spatial = NULL,   other_covariates = NULL,   corr_by = \"1\"   ) #> Loading required package: SingleCellExperiment #> Loading required package: SummarizedExperiment #> Loading required package: MatrixGenerics #> Loading required package: matrixStats #>  #> Attaching package: ‘MatrixGenerics’ #> The following objects are masked from ‘package:matrixStats’: #>  #>     colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse, #>     colCounts, colCummaxs, colCummins, colCumprods, colCumsums, #>     colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs, #>     colMads, colMaxs, colMeans2, colMedians, colMins, colOrderStats, #>     colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds, #>     colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads, #>     colWeightedMeans, colWeightedMedians, colWeightedSds, #>     colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet, #>     rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods, #>     rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps, #>     rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins, #>     rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks, #>     rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars, #>     rowWeightedMads, rowWeightedMeans, rowWeightedMedians, #>     rowWeightedSds, rowWeightedVars #> Loading required package: GenomicRanges #> Loading required package: stats4 #> Loading required package: BiocGenerics #>  #> Attaching package: ‘BiocGenerics’ #> The following objects are masked from ‘package:stats’: #>  #>     IQR, mad, sd, var, xtabs #> The following objects are masked from ‘package:base’: #>  #>     Filter, Find, Map, Position, Reduce, anyDuplicated, aperm, append, #>     as.data.frame, basename, cbind, colnames, dirname, do.call, #>     duplicated, eval, evalq, get, grep, grepl, intersect, is.unsorted, #>     lapply, mapply, match, mget, order, paste, pmax, pmax.int, pmin, #>     pmin.int, rank, rbind, rownames, sapply, setdiff, sort, table, #>     tapply, union, unique, unsplit, which.max, which.min #> Loading required package: S4Vectors #>  #> Attaching package: ‘S4Vectors’ #> The following object is masked from ‘package:utils’: #>  #>     findMatches #> The following objects are masked from ‘package:base’: #>  #>     I, expand.grid, unname #> Loading required package: IRanges #> Loading required package: GenomeInfoDb #> Loading required package: Biobase #> Welcome to Bioconductor #>  #>     Vignettes contain introductory material; view with #>     'browseVignettes()'. To cite Bioconductor, see #>     'citation(\"Biobase\")', and for packages 'citation(\"pkgname\")'. #>  #> Attaching package: ‘Biobase’ #> The following object is masked from ‘package:MatrixGenerics’: #>  #>     rowMedians #> The following objects are masked from ‘package:matrixStats’: #>  #>     anyMissing, rowMedians"},{"path":"/reference/example_sce.html","id":null,"dir":"Reference","previous_headings":"","what":"A SingelCellExperiment object containing both cell type and pseudotime — example_sce","title":"A SingelCellExperiment object containing both cell type and pseudotime — example_sce","text":"SingelCellExperiment object containing cell type pseudotime","code":""},{"path":"/reference/example_sce.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"A SingelCellExperiment object containing both cell type and pseudotime — example_sce","text":"","code":"data(\"example_sce\")"},{"path":"/reference/example_sce.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"A SingelCellExperiment object containing both cell type and pseudotime — example_sce","text":"dataset 10 rows (genes) 1289 cols (cells)","code":""},{"path":"/reference/example_sce.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"A SingelCellExperiment object containing both cell type and pseudotime — example_sce","text":"corresponding SingleCellExperiment object","code":""},{"path":"/reference/extract_para.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract the parameters of each cell's distribution — extract_para","title":"Extract the parameters of each cell's distribution — extract_para","text":"extract_para generates parameter matricies determine cell's distribution","code":""},{"path":"/reference/extract_para.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract the parameters of each cell's distribution — extract_para","text":"","code":"extract_para(   sce,   assay_use = \"counts\",   marginal_list,   n_cores,   family_use,   new_covariate,   parallelization = \"mcmapply\",   BPPARAM = NULL,   data )"},{"path":"/reference/extract_para.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract the parameters of each cell's distribution — extract_para","text":"sce SingleCellExperiment object. assay_use string indicates assay use sce. Default 'counts'. marginal_list list fitted regression models fit_marginal gene sce. n_cores integer. number cores use. family_use string marginal distribution. Must one 'poisson', 'nb', 'zip', 'zinb' 'gaussian', represent 'poisson distribution', 'negative binomial distribution', 'zero-inflated poisson distribution', 'zero-inflated negative binomail distribution', 'gaussian distribution' respectively. new_covariate data.frame contains covaraites targeted simulated data  construct_data correlation group assignment cell column 'corr_group'. parallelization string indicating specific parallelization function use. Must one 'mcmapply', 'bpmapply', 'pbmcmapply', corresponds parallelization function package parallel,BiocParallel, pbmcapply respectively. default value 'mcmapply'. BPPARAM MulticoreParam object NULL. parameter parallelization = 'mcmapply' 'pbmcmapply', parameter must NULL. parameter parallelization = 'bpmapply',  parameter must one MulticoreParam object offered package 'BiocParallel. default value NULL. data dataframe used fitting gamlss model","code":""},{"path":"/reference/extract_para.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract the parameters of each cell's distribution — extract_para","text":"list components: mean_mat cell feature matrix mean parameter. sigma_mat cell feature matrix sigma parameter (Gaussian, variance; NB, dispersion.). zero_mat cell feature matrix zero-inflation parameter (non-zero ZIP ZINB).","code":""},{"path":"/reference/extract_para.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Extract the parameters of each cell's distribution — extract_para","text":"function takes new covariate (use) construct_data marginal models fit_marginal.","code":""},{"path":"/reference/extract_para.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract the parameters of each cell's distribution — extract_para","text":"","code":"data(example_sce)   my_data <- construct_data(   sce = example_sce,   assay_use = \"counts\",   celltype = \"cell_type\",   pseudotime = \"pseudotime\",   spatial = NULL,   other_covariates = NULL,   corr_by = \"1\"   )   my_marginal <- fit_marginal(   data = my_data,   mu_formula = \"s(pseudotime, bs = 'cr', k = 10)\",   sigma_formula = \"1\",   family_use = \"nb\",   n_cores = 1,   usebam = FALSE   )   my_copula <- fit_copula(   sce = example_sce,   assay_use = \"counts\",   marginal_list = my_marginal,   family_use = c(rep(\"nb\", 5), rep(\"zip\", 5)),   copula = \"vine\",   n_cores = 1,   input_data = my_data$dat   ) #> Convert Residuals to Uniform #> Converting End #> Copula group 1 starts #> Vine Copula Estimation Starts #> Time difference of 0.3829157 secs #> Vine Copula Estimation Ends   my_para <- extract_para(     sce = example_sce,     marginal_list = my_marginal,     n_cores = 1,     family_use = c(rep(\"nb\", 5), rep(\"zip\", 5)),     new_covariate = my_data$new_covariate,     data = my_data$dat   )"},{"path":"/reference/fit_copula.html","id":null,"dir":"Reference","previous_headings":"","what":"Fit the copula model — fit_copula","title":"Fit the copula model — fit_copula","text":"fit_copula fits copula model.","code":""},{"path":"/reference/fit_copula.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Fit the copula model — fit_copula","text":"","code":"fit_copula(   sce,   assay_use,   input_data,   empirical_quantile = FALSE,   marginal_list,   family_use,   copula = \"gaussian\",   DT = TRUE,   pseudo_obs = FALSE,   epsilon = 1e-06,   family_set = c(\"gaussian\", \"indep\"),   important_feature = \"all\",   n_cores,   parallelization = \"mcmapply\",   BPPARAM = NULL )"},{"path":"/reference/fit_copula.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Fit the copula model — fit_copula","text":"sce SingleCellExperiment object. assay_use string indicates assay use sce. Default 'counts'. input_data input data, one output construct_data. empirical_quantile Please use clearly know happen! logic variable. TRUE, fit copula use EMPIRICAL CDF values original data; make simulated data fixed (randomness). Default FALSE. works ncell original data. marginal_list list fitted regression models fit_marginal. family_use string vector strings marginal distribution. Must one 'poisson', 'nb', 'zip', 'zinb' 'gaussian'. copula string copula choice. Must one 'gaussian' 'vine'. Default 'gaussian'. Note vine copula may better modeling high-dimensions, can slow features >1000. DT logic variable. TRUE, perform distributional transformation make discrete data 'continuous'. useful discrete distributions (e.g., Poisson, NB). Default TRUE. Note continuous data (e.g., Gaussian), DT make sense set FALSE. pseudo_obs logic variable. TRUE, use empirical quantiles instead theoretical quantiles fitting copula. Default FALSE. epsilon numeric variable preventing transformed quantiles collapse 0 1. family_set string string vector bivariate copula families. Default c(\"gaussian\", \"indep\"). important_feature string vector indicates whether gene used correlation estimation . string, string must either \"\" (using genes) \"auto\", indicates genes automatically selected based proportion zero expression across cells gene. Gene zero proportion greater 0.8 excluded form gene-gene correlation estimation. vector, logical vector length equal number genes sce. TRUE logical vector means corresponding gene included gene-gene correlation estimation FALSE logical vector means corresponding gene excluded gene-gene correlation estimation. default value \"\". n_cores integer. number cores use. parallelization string indicating specific parallelization function use. Must one 'mcmapply', 'bpmapply', 'pbmcmapply', corresponds parallelization function package parallel,BiocParallel, pbmcapply respectively. default value 'mcmapply'. BPPARAM MulticoreParam object NULL. parameter parallelization = 'mcmapply' 'pbmcmapply', parameter must NULL. parameter parallelization = 'bpmapply',  parameter must one MulticoreParam object offered package 'BiocParallel. default value NULL.","code":""},{"path":"/reference/fit_copula.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Fit the copula model — fit_copula","text":"list components: new_mvu matrix new multivariate uniform distribution copula. copula_list list fitted copula model. using Gaussian copula, list correlation matrices; vine, list vine objects. model_aic vector marginal AIC copula AIC. model_bic vector marginal BIC copula BIC.","code":""},{"path":"/reference/fit_copula.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Fit the copula model — fit_copula","text":"function takes result fit_marginal input fit copula model residuals.","code":""},{"path":"/reference/fit_copula.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Fit the copula model — fit_copula","text":"","code":"data(example_sce)   my_data <- construct_data(   sce = example_sce,   assay_use = \"counts\",   celltype = \"cell_type\",   pseudotime = \"pseudotime\",   spatial = NULL,   other_covariates = NULL,   corr_by = \"1\"   )   my_marginal <- fit_marginal(   data = my_data,   mu_formula = \"s(pseudotime, bs = 'cr', k = 10)\",   sigma_formula = \"1\",   family_use = \"nb\",   n_cores = 1,   usebam = FALSE   )   my_copula <- fit_copula(   sce = example_sce,   assay_use = \"counts\",   marginal_list = my_marginal,   family_use = c(rep(\"nb\", 5), rep(\"zip\", 5)),   copula = \"vine\",   n_cores = 1,   input_data = my_data$dat   ) #> Convert Residuals to Uniform #> Converting End #> Copula group 1 starts #> Vine Copula Estimation Starts #> Time difference of 0.3291762 secs #> Vine Copula Estimation Ends"},{"path":"/reference/fit_marginal.html","id":null,"dir":"Reference","previous_headings":"","what":"Fit the marginal models — fit_marginal","title":"Fit the marginal models — fit_marginal","text":"fit_marginal fits per-feature regression models.","code":""},{"path":"/reference/fit_marginal.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Fit the marginal models — fit_marginal","text":"","code":"fit_marginal(   data,   predictor = \"gene\",   mu_formula,   sigma_formula,   family_use,   n_cores,   usebam,   parallelization = \"mcmapply\",   BPPARAM = NULL,   trace = FALSE,   simplify = FALSE )"},{"path":"/reference/fit_marginal.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Fit the marginal models — fit_marginal","text":"data object construct_data. predictor string predictor gam/gamlss model. Default gene. essentially just name. mu_formula string mu parameter formula sigma_formula string sigma parameter formula family_use string vector strings marginal distribution. Must one 'binomial', 'poisson', 'nb', 'zip', 'zinb' 'gaussian', represent 'poisson distribution', 'negative binomial distribution', 'zero-inflated poisson distribution', 'zero-inflated negative binomail distribution', 'gaussian distribution' respectively. n_cores integer. number cores use. usebam logic variable. use bam acceleration. parallelization string indicating specific parallelization function use. Must one 'mcmapply', 'bpmapply', 'pbmcmapply', corresponds parallelization function package parallel,BiocParallel, pbmcapply respectively. default value 'mcmapply'. BPPARAM MulticoreParam object NULL. parameter parallelization = 'mcmapply' 'pbmcmapply', parameter must NULL. parameter parallelization = 'bpmapply',  parameter must one MulticoreParam object offered package 'BiocParallel. default value NULL. trace logic variable. TRUE, warning/error log runtime gam/gamlss returned, FALSE otherwise. Default FALSE. simplify logic variable. TRUE, fitted regression model keep essential contains predict. Default FALSE.","code":""},{"path":"/reference/fit_marginal.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Fit the marginal models — fit_marginal","text":"list fitted regression models. length equal total feature number.","code":""},{"path":"/reference/fit_marginal.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Fit the marginal models — fit_marginal","text":"function takes result construct_data input, fit regression models feature based users' specification.","code":""},{"path":"/reference/fit_marginal.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Fit the marginal models — fit_marginal","text":"","code":"data(example_sce)   my_data <- construct_data(   sce = example_sce,   assay_use = \"counts\",   celltype = \"cell_type\",   pseudotime = \"pseudotime\",   spatial = NULL,   other_covariates = NULL,   corr_by = \"1\"   )   my_marginal <- fit_marginal(   data = my_data,   mu_formula = \"s(pseudotime, bs = 'cr', k = 10)\",   sigma_formula = \"1\",   family_use = \"nb\",   n_cores = 1,   usebam = FALSE   )"},{"path":"/reference/ga.html","id":null,"dir":"Reference","previous_headings":"","what":"Functions from gamlss/gamlss.add with bugs fixed — ga","title":"Functions from gamlss/gamlss.add with bugs fixed — ga","text":"additive function used fitting GAMLSS models. interface gam() mgcv package.","code":""},{"path":"/reference/ga.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Functions from gamlss/gamlss.add with bugs fixed — ga","text":"","code":"ga(formula, envir, control = ga.control(...), ...)"},{"path":"/reference/ga.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Functions from gamlss/gamlss.add with bugs fixed — ga","text":"formula formula model. envir environment. control control model fitting. ... arguments.","code":""},{"path":"/reference/ga.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Functions from gamlss/gamlss.add with bugs fixed — ga","text":"xvar list.","code":""},{"path":"/reference/ga.html","id":"ga","dir":"Reference","previous_headings":"","what":"ga","title":"Functions from gamlss/gamlss.add with bugs fixed — ga","text":"NA","code":""},{"path":"/reference/ga.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Functions from gamlss/gamlss.add with bugs fixed — ga","text":"","code":"print(\"No example\") #> [1] \"No example\""},{"path":"/reference/gamlss.ba.html","id":null,"dir":"Reference","previous_headings":"","what":"Support for Function ba() — gamlss.ba","title":"Support for Function ba() — gamlss.ba","text":"support  smoother functions ba() interfaces Simon Woood's bam() functions package mgcv. intended called directly users. gamlss.add::gamlss.ba.","code":""},{"path":"/reference/gamlss.ba.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Support for Function ba() — gamlss.ba","text":"","code":"gamlss.ba(x, y, w, xeval = NULL, ...)"},{"path":"/reference/gamlss.ba.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Support for Function ba() — gamlss.ba","text":"x explanatory variables y Iterative y variable w Iterative weights xeval xeval=TRUE prediction used ... arguments","code":""},{"path":"/reference/gamlss.ba.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Support for Function ba() — gamlss.ba","text":"used","code":""},{"path":"/reference/gamlss.ba.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Support for Function ba() — gamlss.ba","text":"","code":"print(\"No example\") #> [1] \"No example\""},{"path":"/reference/gamlss.ga.html","id":null,"dir":"Reference","previous_headings":"","what":"Support for Function ga() — gamlss.ga","title":"Support for Function ga() — gamlss.ga","text":"support  smoother functions ga() interfaces Simon Woood's gam() functions package mgcv. intended called directly users. gamlss.add::gamlss.ga.","code":""},{"path":"/reference/gamlss.ga.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Support for Function ga() — gamlss.ga","text":"","code":"gamlss.ga(x, y, w, xeval = NULL, ...)"},{"path":"/reference/gamlss.ga.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Support for Function ga() — gamlss.ga","text":"x explanatory variables y Iterative y variable w Iterative weights xeval xeval=TRUE prediction used ... arguments","code":""},{"path":"/reference/gamlss.ga.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Support for Function ga() — gamlss.ga","text":"used","code":""},{"path":"/reference/gamlss.ga.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Support for Function ga() — gamlss.ga","text":"","code":"print(\"No example\") #> [1] \"No example\""},{"path":"/reference/perform_lrt.html","id":null,"dir":"Reference","previous_headings":"","what":"Perform the likelihood ratio test — perform_lrt","title":"Perform the likelihood ratio test — perform_lrt","text":"perform_lrt performs likelihood ratio test compare two list marginal models.","code":""},{"path":"/reference/perform_lrt.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Perform the likelihood ratio test — perform_lrt","text":"","code":"perform_lrt(alter_marginal, null_marginal)"},{"path":"/reference/perform_lrt.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Perform the likelihood ratio test — perform_lrt","text":"alter_marginal list marginal models alternative hypothesis. null_marginal list marginal models null hypothesis. must strictly nested alternative model.","code":""},{"path":"/reference/perform_lrt.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Perform the likelihood ratio test — perform_lrt","text":"data.frame LRT result.","code":""},{"path":"/reference/perform_lrt.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Perform the likelihood ratio test — perform_lrt","text":"function takes two lists marginal models (default, first list alternative second null) fit_marginal. Note LRT makes sense NESTED models. can quite tricky use penalized-splines (e.g., trajectory data).","code":""},{"path":"/reference/perform_lrt.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Perform the likelihood ratio test — perform_lrt","text":"","code":"data(example_sce) my_data <- construct_data( sce = example_sce, assay_use = \"counts\", celltype = \"cell_type\", pseudotime = \"pseudotime\", spatial = NULL, other_covariates = NULL, corr_by = \"cell_type\" )  my_data2 <- construct_data(   sce = example_sce,   assay_use = \"counts\",   celltype = \"cell_type\",   pseudotime = \"pseudotime\",   spatial = NULL,   other_covariates = NULL,   corr_by = \"pseudotime\",   ncell = 10000 )  my_marginal1 <- fit_marginal(   data = my_data,   mu_formula = \"1\",   sigma_formula = \"1\",   family_use = \"nb\",   n_cores = 1,   usebam = FALSE ) my_marginal2 <- fit_marginal(   data = my_data,   mu_formula = \"s(pseudotime, bs = 'cr', k = 10)\",   sigma_formula = \"1\",   family_use = \"nb\",   n_cores = 1,   usebam = FALSE ) my_fit1 <- lapply(my_marginal1, function(x)x$fit) my_fit2 <- lapply(my_marginal2, function(x)x$fit) my_pvalue <- perform_lrt(my_fit2, my_fit1)"},{"path":"/reference/plot_reduceddim.html","id":null,"dir":"Reference","previous_headings":"","what":"Dimensionality reduction and visualization — plot_reduceddim","title":"Dimensionality reduction and visualization — plot_reduceddim","text":"plot_reduceddim performs dimensionality reduction","code":""},{"path":"/reference/plot_reduceddim.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Dimensionality reduction and visualization — plot_reduceddim","text":"","code":"plot_reduceddim(   ref_sce,   sce_list,   name_vec,   assay_use = \"logcounts\",   pc_umap = TRUE,   n_pc = 50,   center = TRUE,   scale. = TRUE,   if_plot = TRUE,   shape_by = NULL,   color_by,   point_size = 1 )"},{"path":"/reference/plot_reduceddim.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Dimensionality reduction and visualization — plot_reduceddim","text":"ref_sce reference sce. sce_list list synthetic sce. name_vec vector names dataset. length length(sce_list) + 1, first name ref_sce. assay_use string indicates assay use sce. Default 'logcounts'. pc_umap logic value whether using PCs input UMAP. Default TRUE. n_pc integer number PCs. center logic value whether centering data PCA. Default TRUE. scale. logic value whether scaling data PCA. Default TRUE. if_plot logic value whether returning plot. FALSE, return reduced dimensions dataset. shape_by string indicates column colData used shape. color_by string indicates column colData used color. point_size numeric value point size final plot. Default 1.","code":""},{"path":"/reference/plot_reduceddim.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Dimensionality reduction and visualization — plot_reduceddim","text":"ggplot data.frame reduced dimensions.","code":""},{"path":"/reference/plot_reduceddim.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Dimensionality reduction and visualization — plot_reduceddim","text":"function takes reference sce list new sces, performs dimensionality reduction reference data,  projects synthetic datasets low dimensional space, visualize results.","code":""},{"path":"/reference/scdesign3.html","id":null,"dir":"Reference","previous_headings":"","what":"The wrapper for the whole scDesign3 pipeline — scdesign3","title":"The wrapper for the whole scDesign3 pipeline — scdesign3","text":"scdesign3 takes input data, fits model ","code":""},{"path":"/reference/scdesign3.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"The wrapper for the whole scDesign3 pipeline — scdesign3","text":"","code":"scdesign3(   sce,   assay_use = \"counts\",   celltype,   pseudotime,   spatial,   other_covariates,   ncell = dim(sce)[2],   mu_formula,   sigma_formula = \"1\",   family_use = \"nb\",   n_cores = 2,   usebam = FALSE,   corr_formula,   empirical_quantile = FALSE,   copula = \"gaussian\",   fastmvn = FALSE,   DT = TRUE,   pseudo_obs = FALSE,   family_set = c(\"gauss\", \"indep\"),   important_feature = \"all\",   nonnegative = TRUE,   nonzerovar = FALSE,   return_model = FALSE,   simplify = FALSE,   parallelization = \"mcmapply\",   BPPARAM = NULL,   trace = FALSE )"},{"path":"/reference/scdesign3.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"The wrapper for the whole scDesign3 pipeline — scdesign3","text":"sce SingleCellExperiment object. assay_use string indicates assay use sce. Default 'counts'. celltype string name cell type variable colData sce. Default 'cell_type'. pseudotime string string vector name pseudotime (exist) multiple lineages. Default NULL. spatial length two string vector names spatial coordinates. Defualt NULL. other_covariates string string vector covariates want include data. ncell number cell want simulate. Default dim(sce)[2] (number input data). mu_formula string mu parameter formula sigma_formula string sigma parameter formula family_use string marginal distribution. Must one 'poisson', 'nb', 'zip', 'zinb' 'gaussian'. n_cores integer. number cores use. usebam logic variable. use bam acceleration. corr_formula string correlation structure. empirical_quantile Please use clearly know happen! logic variable. TRUE, fit copula use EMPIRICAL CDF values original data; make simulated data fixed (randomness). Default FALSE. works ncell original data. copula string copula choice. Must one 'gaussian' 'vine'. Default 'gaussian'. Note vine copula may better modeling high-dimensions, can slow features >1000. fastmvn logical variable. TRUE, sampling multivariate Gaussian done mvnfast, otherwise mvtnorm. Default FALSE. matters Gaussian copula. DT logic variable. TRUE, perform distributional transformation make discrete data 'continuous'. useful discrete distributions (e.g., Poisson, NB). Default TRUE. Note continuous data (e.g., Gaussian), DT make sense set FALSE. pseudo_obs logic variable. TRUE, use empirical quantiles instead theoretical quantiles fitting copula. Default FALSE. family_set string string vector bivariate copula families. Default c(\"gauss\", \"indep\"). information please check package rvinecoplib. important_feature string vector indicates whether gene used correlation estimation . string, string must either \"\" (using genes) \"auto\", indicates genes automatically selected based proportion zero expression across cells gene. Gene zero proportion greater 0.8 excluded form gene-gene correlation estimation. vector, logical vector length equal number genes sce. TRUE logical vector means corresponding gene included gene-gene correlation estimation FALSE logical vector means corresponding gene excluded gene-gene correlation estimation. default value vector length equal number inputted genes every value equals TRUE. nonnegative logical variable. TRUE, values < 0 synthetic data converted 0. Default TRUE (since expression matrix nonnegative). nonzerovar logical variable. TRUE, gene zero variance, cell replaced 1. designed avoiding potential errors, example, PCA. Default FALSE. return_model logic variable. TRUE, marginal models copula models returned. Default FALSE. simplify logic variable. TRUE, fitted regression model keep essential contains predict, otherwise fitted models can large. Default FALSE. parallelization string indicating specific parallelization function use. Must one 'mcmapply', 'bpmapply', 'pbmcmapply', corresponds parallelization function package parallel,BiocParallel, pbmcapply respectively. default value 'mcmapply'. BPPARAM MulticoreParam object NULL. parameter parallelization = 'mcmapply' 'pbmcmapply', parameter must NULL. parameter parallelization = 'bpmapply',  parameter must one MulticoreParam object offered package 'BiocParallel. default value NULL. trace logic variable. TRUE, warning/error log runtime gam/gamlss returned, FALSE otherwise. Default FALSE.","code":""},{"path":"/reference/scdesign3.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"The wrapper for the whole scDesign3 pipeline — scdesign3","text":"list components: new_count matrix new simulated count (expression) matrix. new_covariate data.frame new covariate matrix. model_aic model AIC. marginal_list list marginal regression models return_model = TRUE. corr_list list correlation models (conditional copulas) return_model = TRUE.","code":""},{"path":"/reference/scdesign3.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"The wrapper for the whole scDesign3 pipeline — scdesign3","text":"","code":"data(example_sce) my_simu <- scdesign3( sce = example_sce, assay_use = \"counts\", celltype = \"cell_type\", pseudotime = \"pseudotime\", spatial = NULL, other_covariates = NULL, mu_formula = \"s(pseudotime, bs = 'cr', k = 10)\", sigma_formula = \"s(pseudotime, bs = 'cr', k = 3)\", family_use = c(rep(\"nb\", 5), rep(\"zip\", 5)), n_cores = 2, usebam = FALSE, corr_formula = \"pseudotime\", copula = \"vine\", DT = TRUE, pseudo_obs = FALSE, ncell = 1000, return_model = FALSE ) #> Input Data Construction Start #> Input Data Construction End #> Start Marginal Fitting #> Marginal Fitting End #> Start Copula Fitting #> Convert Residuals to Uniform #> Converting End #> Copula group 1 starts #> Vine Copula Estimation Starts #> Time difference of 0.06425762 secs #> Vine Copula Estimation Ends #> Copula group 2 starts #> Vine Copula Estimation Starts #> Time difference of 0.07923245 secs #> Vine Copula Estimation Ends #> Copula group 3 starts #> Vine Copula Estimation Starts #> Time difference of 0.09371328 secs #> Vine Copula Estimation Ends #> Copula group 4 starts #> Vine Copula Estimation Starts #> Time difference of 0.04615641 secs #> Vine Copula Estimation Ends #> Copula Fitting End #> Start Parameter Extraction #> Parameter #> Extraction End #> Start Generate New Data #> Use Copula to sample a multivariate quantile matrix #> Sample Copula group 1 starts #> Sample Copula group 2 starts #> Sample Copula group 3 starts #> Sample Copula group 4 starts #> New Data Generating End"},{"path":"/reference/simu_new.html","id":null,"dir":"Reference","previous_headings":"","what":"Simulate new data — simu_new","title":"Simulate new data — simu_new","text":"simu_new generates new simulated data based fitted marginal copula models.","code":""},{"path":"/reference/simu_new.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simulate new data — simu_new","text":"","code":"simu_new(   sce,   assay_use = \"counts\",   mean_mat,   sigma_mat,   zero_mat,   quantile_mat = NULL,   copula_list,   n_cores,   fastmvn = FALSE,   family_use,   nonnegative = TRUE,   nonzerovar = FALSE,   input_data,   new_covariate,   important_feature = \"all\",   parallelization = \"mcmapply\",   BPPARAM = NULL,   filtered_gene )"},{"path":"/reference/simu_new.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Simulate new data — simu_new","text":"sce SingleCellExperiment object. assay_use string indicates assay use sce. Default 'counts'. mean_mat cell feature matrix mean parameter. sigma_mat cell feature matrix sigma parameter. zero_mat cell feature matrix zero-inflation parameter. quantile_mat cell feature matrix multivariate quantile. copula_list list copulas generating multivariate quantile matrix. provided, quantile_mat must NULL. n_cores integer. number cores use. fastmvn logical variable. TRUE, sampling multivariate Gaussian done mvnfast, otherwise mvtnorm. Default FALSE. family_use string marginal distribution. Must one 'poisson', \"binomial\", 'nb', 'zip', 'zinb' 'gaussian'. nonnegative logical variable. TRUE, values < 0 synthetic data converted 0. Default TRUE (since expression matrix nonnegative). nonzerovar logical variable. TRUE, gene zero variance, cell replaced 1. designed avoiding potential errors, example, PCA. input_data input count matrix. new_covariate data.frame contains covariates targeted simulated data  construct_data. important_feature important_feature string vector indicates whether gene used correlation estimation . string, string must either \"\" (using genes) \"auto\", indicates genes automatically selected based proportion zero expression across cells gene. Gene zero proportion greater 0.8 excluded form gene-gene correlation estimation. vector, logical vector length equal number genes sce. TRUE logical vector means corresponding gene included gene-gene correlation estimation FALSE logical vector means corresponding gene excluded gene-gene correlation estimation. default value \"\". parallelization string indicating specific parallelization function use. Must one 'mcmapply', 'bpmapply', 'pbmcmapply', corresponds parallelization function package parallel,BiocParallel, pbmcapply respectively. default value 'mcmapply'. BPPARAM MulticoreParam object NULL. parameter parallelization = 'mcmapply' 'pbmcmapply', parameter must NULL. parameter parallelization = 'bpmapply',  parameter must one MulticoreParam object offered package 'BiocParallel. default value NULL. filtered_gene vector NULL contains genes excluded marginal copula fitting  steps genes express less two cells. can obtain  construct_data","code":""},{"path":"/reference/simu_new.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Simulate new data — simu_new","text":"feature cell matrix new simulated count (expression) matrix sparse matrix.","code":""},{"path":"/reference/simu_new.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Simulate new data — simu_new","text":"function takes new covariate (use) construct_data, parameter matricies extract_para multivariate Unifs fit_copula.","code":""},{"path":"/reference/simu_new.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Simulate new data — simu_new","text":"","code":"data(example_sce)   my_data <- construct_data(   sce = example_sce,   assay_use = \"counts\",   celltype = \"cell_type\",   pseudotime = \"pseudotime\",   spatial = NULL,   other_covariates = NULL,   corr_by = \"1\"   )   my_marginal <- fit_marginal(   data = my_data,   mu_formula = \"s(pseudotime, bs = 'cr', k = 10)\",   sigma_formula = \"1\",   family_use = \"nb\",   n_cores = 1,   usebam = FALSE   )   my_copula <- fit_copula(   sce = example_sce,   assay_use = \"counts\",   marginal_list = my_marginal,   family_use = c(rep(\"nb\", 5), rep(\"zip\", 5)),   copula = \"vine\",   n_cores = 1,   input_data = my_data$dat   ) #> Convert Residuals to Uniform #> Converting End #> Copula group 1 starts #> Vine Copula Estimation Starts #> Time difference of 0.3286741 secs #> Vine Copula Estimation Ends   my_para <- extract_para(     sce = example_sce,     marginal_list = my_marginal,     n_cores = 1,     family_use = c(rep(\"nb\", 5), rep(\"zip\", 5)),     new_covariate = my_data$new_covariate,     data = my_data$dat   )   my_newcount <- simu_new(   sce = example_sce,   mean_mat = my_para$mean_mat,   sigma_mat = my_para$sigma_mat,   zero_mat = my_para$zero_mat,   quantile_mat = NULL,   copula_list = my_copula$copula_list,   n_cores = 1,   family_use = c(rep(\"nb\", 5), rep(\"zip\", 5)),   input_data = my_data$dat,   new_covariate = my_data$new_covariate,   important_feature = my_copula$important_feature,   filtered_gene = my_data$filtered_gene   ) #> Use Copula to sample a multivariate quantile matrix #> Sample Copula group 1 starts"}]
