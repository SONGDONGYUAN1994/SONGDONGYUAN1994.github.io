[{"path":"https://songdongyuan1994.github.io/ClusterDE/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2023 ClusterDE authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-PBMC.html","id":"download-data","dir":"Articles","previous_headings":"","what":"Download data","title":"Perform ClusterDE on a PBMC dataset","text":"PBMC datasets SeuratData. use one (10x Chromium (v3) PBMC1 replicate). filtered lowly epxressed genes save computational time .","code":"InstallData(\"pbmcsca\") #> Warning: The following packages are already installed and will not be #> reinstalled: pbmcsca data(\"pbmcsca\") pbmc <- pbmcsca[, pbmcsca@meta.data$Method==\"10x Chromium (v3)\" & pbmcsca@meta.data$Experiment == \"pbmc1\"]  pbmc <- pbmc[Matrix::rowSums(pbmc@assays$RNA@counts) > 100, ]"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-PBMC.html","id":"run-the-regular-seurat-pipeline","dir":"Articles","previous_headings":"","what":"Run the regular Seurat pipeline","title":"Perform ClusterDE on a PBMC dataset","text":"perform default Seurat clustering. Note real data analysis, cell type label usually unknown.  vignette, interested cluster 2 vs 8, approximately represent CD14+/CD16+ monocytes. Please note ClusterDE designed 1 vs 1 comparison. Therefore, users may (1) choose two interested clusters manually based knowledge (2) use two closest clusters computation (e.g., BuildClusterTree Seurat).  perform DE test cluster 2 8. subset cluster 2 8 (pbmc_sub).","code":"RNGkind(\"L'Ecuyer-CMRG\") set.seed(123) pbmc <- NormalizeData(object = pbmc) pbmc <- FindVariableFeatures(object = pbmc) pbmc <- ScaleData(object = pbmc) #> Centering and scaling data matrix pbmc <- RunPCA(object = pbmc) #> PC_ 1  #> Positive:  IL32, CCL5, TRBC2, TRAC, CD69, CST7, RORA, CTSW, SPOCK2, ITM2A  #>     GZMM, CD247, TRBC1, C12orf75, IL7R, CD8A, CD2, LDHB, GZMA, CD7  #>     NKG7, CD6, GZMH, CD8B, BCL11B, PRF1, LYAR, LTB, FGFBP2, TCF7  #> Negative:  LYZ, FCN1, CLEC7A, CPVL, SERPINA1, SPI1, S100A9, AIF1, NAMPT, CSTA  #>     CTSS, MAFB, MPEG1, NCF2, VCAN, FGL2, S100A8, TYMP, CST3, LST1  #>     CYBB, CFD, FCER1G, SLC11A1, TGFBI, GRN, CD14, PSAP, SLC7A7, MS4A6A  #> PC_ 2  #> Positive:  RPL10, EEF1A1, TMSB10, RPS2, RPS12, RPL13, RPS18, RPS23, RPLP1, TPT1  #>     RPS8, IL32, S100A4, PFN1, RPLP0, NKG7, ARL4C, HSPA8, CST7, ZFP36L2  #>     ANXA1, CTSW, S100A6, LDHA, CORO1A, CD247, GZMA, CALR, S100A10, GZMM  #> Negative:  NRGN, PF4, SDPR, HIST1H2AC, MAP3K7CL, PPBP, GNG11, GPX1, TUBB1, SPARC  #>     CLU, PGRMC1, FTH1, RGS18, MARCH2, TREML1, HIST1H3H, AP003068.23, NCOA4, ACRBP  #>     TAGLN2, PRKAR2B, CD9, CA2, CMTM5, CTTN, MTURN, TMSB4X, HIST1H2BJ, TSC22D1  #> PC_ 3  #> Positive:  CD79A, HLA-DQA1, MS4A1, LINC00926, IGHM, BANK1, IGHD, TNFRSF13C, HLA-DQB1, CD74  #>     IGKC, HLA-DRA, BLK, CD83, CD37, CD22, ADAM28, JUND, NFKBID, HLA-DRB1  #>     P2RX5, CD79B, VPREB3, IGLC2, FCER2, RPS8, LTB, RPS23, TCOF1, GNG7  #> Negative:  CCL5, TMSB4X, SRGN, NKG7, ACTB, CST7, GZMH, FGFBP2, CTSW, PRF1  #>     GZMA, GZMB, C12orf75, S100A4, ANXA1, KLRD1, NRGN, GNLY, GZMM, IL32  #>     PF4, SDPR, PPBP, MYO1F, CD247, GAPDH, MAP3K7CL, HIST1H2AC, GNG11, TUBB1  #> PC_ 4  #> Positive:  FCGR3A, GZMB, FGFBP2, GZMH, NKG7, HLA-DPA1, PRF1, HLA-DPB1, CST7, GNLY  #>     KLRD1, HLA-DRB1, GZMA, CCL5, SPON2, ADGRG1, CTSW, ZEB2, PRSS23, IFITM2  #>     CCL4, CD74, KLRF1, RHOC, MTSS1, CDKN1C, CD79B, CEP78, HLA-DQA1, CLIC3  #> Negative:  IL7R, LEPROTL1, LTB, RCAN3, MAL, LEF1, TCF7, ZFP36L2, CAMK4, VIM  #>     LDHB, NOSIP, JUNB, SLC2A3, TRABD2A, RGCC, SATB1, TNFAIP3, TMEM123, SOCS3  #>     AQP3, BCL11B, NELL2, TNFRSF25, CD28, PABPC1, DNAJB1, TRAT1, OXNAD1, TRAC  #> PC_ 5  #> Positive:  CDKN1C, HES4, CSF1R, CKB, ZNF703, TCF7L2, CTSL, MS4A7, PAG1, FAM110A  #>     SIGLEC10, LRRC25, FCGR3A, LTB, RNASET2, CDH23, IL7R, RRAS, LINC01272, IFITM3  #>     LST1, LILRB2, PILRA, RHOC, SLC2A6, PECAM1, CAMK1, TAGLN, IFI30, BID  #> Negative:  VCAN, S100A12, S100A8, CD14, CSF3R, ITGAM, CST7, GZMB, MT-CO1, GNLY  #>     KLRD1, PRF1, MS4A6A, GZMH, FGFBP2, CD93, EGR1, NKG7, S100A9, MT-CO3  #>     IER3, THBS1, RNASE6, CLEC4E, MGST1, CTSW, SGK1, GZMA, RP11-1143G9.4, CH17-373J23.1 pbmc <- FindNeighbors(object = pbmc) #> Computing nearest neighbor graph #> Computing SNN pbmc <- FindClusters(object = pbmc, resolution = 0.3) #> Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck #>  #> Number of nodes: 3222 #> Number of edges: 108605 #>  #> Running Louvain algorithm... #> Maximum modularity in 10 random starts: 0.9363 #> Number of communities: 10 #> Elapsed time: 0 seconds pbmc <- RunUMAP(object = pbmc, dims = 1:10) #> Warning: The default method for RunUMAP has changed from calling Python UMAP via reticulate to the R-native UWOT using the cosine metric #> To use Python UMAP via reticulate, set umap.method to 'umap-learn' and metric to 'correlation' #> This message will be shown once per session #> 11:54:20 UMAP embedding parameters a = 0.9922 b = 1.112 #> 11:54:20 Read 3222 rows and found 10 numeric columns #> 11:54:20 Using Annoy for neighbor search, n_neighbors = 30 #> 11:54:20 Building Annoy index with metric = cosine, n_trees = 50 #> 0%   10   20   30   40   50   60   70   80   90   100% #> [----|----|----|----|----|----|----|----|----|----| #> **************************************************| #> 11:54:21 Writing NN index file to temp file /tmp/RtmpBgKPn5/file2a645179ffaf53 #> 11:54:21 Searching Annoy index using 1 thread, search_k = 3000 #> 11:54:22 Annoy recall = 100% #> 11:54:22 Commencing smooth kNN distance calibration using 1 thread with target n_neighbors = 30 #> 11:54:23 Initializing from normalized Laplacian + noise (using irlba) #> 11:54:24 Commencing optimization for 500 epochs, with 126446 positive edges #> 11:54:27 Optimization finished DimPlot(object = pbmc, reduction = \"umap\") + ggtitle(\"Clustering result\") + DimPlot(object = pbmc, reduction = \"umap\", group.by = \"CellType\") pbmc <- BuildClusterTree(pbmc) PlotClusterTree(pbmc) pbmc_sub <- subset(x = pbmc, idents = c(2, 8)) original_markers <- FindMarkers(pbmc_sub,                                  ident.1 = 2,                                  ident.2 = 8,                                  min.pct = 0,                                  logfc.threshold = 0)"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-PBMC.html","id":"generate-synthetic-null-data","dir":"Articles","previous_headings":"","what":"Generate synthetic null data","title":"Perform ClusterDE on a PBMC dataset","text":"first generate synthetic null data based target data (real subset data, pbmc_sub, contains two clusters interested ). can increase number cores speed . perform pipeline target data. Please note need two clusters , . straightforward clustering method predefined cluster numbers, e.g., K-means. louvain clustering used Seurat may manually adjust resolution parameter still get two clusters.  perform DE test synthetic null data. extract p-values original data synthetic null data, use ClusterDE “compare” . can check summary table. genes ranked “contrast score (cs)”. compare result naive Seurat pipeline ClusterDE, first visualize top 6 DE genes Seurat. Genes LST1 RPS19 highly expressed two clusters. addition, RPS19 reported stable housekeeping genes several studies. contrast, genes ClusterDE LST1 RPS19 anymore.","code":"count_mat <- GetAssayData(object = pbmc_sub, slot = \"counts\") set.seed(123) synthetic_null <- ClusterDE::constructNull(count_mat, nCores = 2) #> Input Data Construction Start #> Input Data Construction End #> Start Marginal Fitting #> Marginal Fitting End #> Start Copula Fitting #> Convert Residuals to Multivariate Gaussian #> Converting End #> Copula group 1 starts #> Copula Fitting End #> Start Parameter Extraction #> Parameter #> Extraction End #> Start Generate New Data #> Use Copula to sample a multivariate quantile matrix #> Sample Copula group 1 starts #> New Data Generating End pbmc_null <- CreateSeuratObject(counts = synthetic_null)  set.seed(123) pbmc_null <- NormalizeData(object = pbmc_null) pbmc_null <- FindVariableFeatures(object = pbmc_null) pbmc_null <- ScaleData(object = pbmc_null) #> Centering and scaling data matrix pbmc_null <- RunPCA(object = pbmc_null) #> PC_ 1  #> Positive:  RPS19, RPL10, FTL, LST1, B2M, RPS27, FTH1, AIF1, YBX1, NACA  #>     EEF1A1, RPL7A, RPL41, RPL11, RPS2, PFN1, RPL8, COTL1, RPL14, RPS3  #>     HLA-B, TMSB10, FCER1G, RPL19, ACTB, HLA-C, RPL15, TMSB4X, PTMA, RPL37A  #> Negative:  VCAN, S100A8, CSF3R, FOS, LYZ, S100A9, SLC2A3, S100A12, CD14, MS4A6A  #>     RGS2, THBS1, FOSB, ZFP36L1, SELL, DUSP6, RNASE6, IRF2BP2, CYP1B1, NR4A2  #>     CD36, TNFAIP3, FCN1, CEBPD, ITGAM, IER3, NCF1, CKAP4, CD93, SLC25A37  #> PC_ 2  #> Positive:  IFITM2, KLF2, FCGR3A, CDKN1C, RHOC, SIGLEC10, LST1, POU2F2, MALAT1, PKN1  #>     LYST, MS4A7, BID, UNC119, LINC01272, SLC2A6, SAT1, MTSS1, LRRC25, CLEC2B  #>     HN1, AP1M1, CSF1R, FAM110A, PTPN6, RNASET2, PIK3CG, SPN, DRAP1, ADGRE5  #> Negative:  TPT1, LYZ, RPS13, GAPDH, GPX1, S100A9, S100A10, RPS3A, RPLP1, S100A8  #>     CD14, VIM, VCAN, CD99, RPS6, GRN, RPS23, RPS18, RP11-1143G9.4, RPS12  #>     RPL28, RPL30, RPL18A, RPL3, RPS8, FCN1, HLA-DRA, AP1S2, FOS, CPVL  #> PC_ 3  #> Positive:  RGS2, HMGB2, SAMSN1, RPLP1, MGST1, GLRX, MNDA, H1FX, S100A9, PLBD1  #>     BCL2A1, RPS6KA1, TNFSF10, LYST, RPS3A, RBP7, RPL30, MARCH1, S100A8, ZFP36L2  #>     CHSY1, STK4, GNG2, ALOX5AP, MED10, RPS12, S100A12, RPS15A, RPL21, KLF6  #> Negative:  HLA-DRA, HLA-DPB1, HLA-DRB1, HLA-DPA1, CPVL, CD74, RGCC, RUNX3, SLC43A2, MAP3K8  #>     CD63, EMP3, BHLHE40, SF3A3, HLA-DMB, TIMP1, CST3, HLA-DMA, ID2, SMAD7  #>     EZR, CTNNB1, NOTCH1, IFI30, CXXC5, HMOX1, CLIC1, APOBEC3A, CD300E, SH3BP5  #> PC_ 4  #> Positive:  MNDA, MBD2, SNIP1, RHOB, MSH3, HERC5, CKB, CXCL8, MARCH1, SECTM1  #>     P2RX1, TNFSF10, GBP2, PPM1D, ISG15, DHX29, VPS37A, RNF181, HIC1, LIN52  #>     EMP3, TMEM43, CCM2, IRF1, ITGB2-AS1, LAP3, LYST, CHST15, ZCCHC2, CCNT1  #> Negative:  AES, PPP2R5C, KIAA1551, CXCR4, TSPAN14, NKG7, PINK1, SLC26A11, TRAC, HLA-B  #>     TMX4, HMGN3, TMEM70, ADD3, HHEX, TMCO1, CNOT6L, HERC2, ZNF544, ARL4C  #>     FAM78A, GOT2, RP3-477O4.14, TRPT1, DDIT4, TNKS, IL32, SCAF8, HAGH, CXXC5  #> PC_ 5  #> Positive:  ISG15, LTBR, MARCKS, CCR1, TMSB4X, STK38L, VAMP8, BLOC1S1, COX17, ACTB  #>     APOBEC3A, ARPC3, ZFR, PLSCR1, HUWE1, MYO9A, IFI44, IGSF6, PLGRKT, CD151  #>     TIMP1, PAXBP1, RBP7, DAAM1, DAD1, ALOX5AP, CYP20A1, PLAC8, ALDH9A1, TNFSF10  #> Negative:  ASH1L, KAT6A, FAM103A1, PRDM1, EPC2, HN1, TRIP11, RPL5, XYLT1, CXCL8  #>     RPL36AL, PHACTR1, CD3E, FAM32A, FAM49A, THAP7, SLC15A4, SIPA1, OSTF1, CCT3  #>     IRF1, TPR, MYLIP, FARS2, PRPF4B, AMPD2, CFAP20, CXXC5, RPL14, GTF2F1 pbmc_null <- FindNeighbors(object = pbmc_null) #> Computing nearest neighbor graph #> Computing SNN pbmc_null <- FindClusters(object = pbmc_null, resolution = 0.3) #> Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck #>  #> Number of nodes: 453 #> Number of edges: 18459 #>  #> Running Louvain algorithm... #> Maximum modularity in 10 random starts: 0.7193 #> Number of communities: 2 #> Elapsed time: 0 seconds pbmc_null <- RunUMAP(object = pbmc_null, dims = 1:10) #> 12:00:48 UMAP embedding parameters a = 0.9922 b = 1.112 #> 12:00:48 Read 453 rows and found 10 numeric columns #> 12:00:48 Using Annoy for neighbor search, n_neighbors = 30 #> 12:00:48 Building Annoy index with metric = cosine, n_trees = 50 #> 0%   10   20   30   40   50   60   70   80   90   100% #> [----|----|----|----|----|----|----|----|----|----| #> **************************************************| #> 12:00:48 Writing NN index file to temp file /tmp/RtmpBgKPn5/file2a64514d712564 #> 12:00:48 Searching Annoy index using 1 thread, search_k = 3000 #> 12:00:48 Annoy recall = 100% #> 12:00:50 Commencing smooth kNN distance calibration using 1 thread with target n_neighbors = 30 #> 12:00:51 Initializing from normalized Laplacian + noise (using irlba) #> 12:00:51 Commencing optimization for 500 epochs, with 17120 positive edges #> 12:00:52 Optimization finished DimPlot(object = pbmc_null, reduction = \"umap\") null_markers <- FindMarkers(pbmc_null,                              ident.1 = 0,                              ident.2 = 1,                              min.pct = 0,                              logfc.threshold = 0) original_pval <- original_markers$p_val names(original_pval) <- rownames(original_markers)  null_pval <- null_markers$p_val names(null_pval) <- rownames(null_markers)  res <- ClusterDE::callDE(original_pval, null_pval, nlogTrans = TRUE) head(res$summaryTable) #> # A tibble: 6 × 5 #>   Gene   target  null    cs       q #>   <chr>   <dbl> <dbl> <dbl>   <dbl> #> 1 FCGR3A   79.0 16.3   62.7 0.00855 #> 2 RHOC     65.8  9.76  56.0 0.00855 #> 3 CDKN1C   67.5 13.7   53.8 0.00855 #> 4 CD79B    53.1  8.47  44.7 0.00855 #> 5 CKB      44.6  1.66  42.9 0.00855 #> 6 TCF7L2   43.6  8.00  35.6 0.00855 FeaturePlot(pbmc, features = c(rownames(original_markers)[1:6]), ncol = 3) FeaturePlot(pbmc, features = c(res$summaryTable$Gene[1:6]), ncol = 3)"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-PBMC.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Perform ClusterDE on a PBMC dataset","text":"","code":"sessionInfo() #> R version 4.3.0 (2023-04-21) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Ubuntu 20.04.6 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0 #>  #> Random number generation: #>  RNG:     L'Ecuyer-CMRG  #>  Normal:  Inversion  #>  Sample:  Rejection  #>   #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Los_Angeles #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] Matrix_1.5-4.1              stxBrain.SeuratData_0.1.1   #>  [3] ssHippo.SeuratData_3.1.4    pbmcsca.SeuratData_3.0.0    #>  [5] pbmc3k.SeuratData_3.1.4     ifnb.SeuratData_3.1.0       #>  [7] SeuratData_0.2.2            patchwork_1.1.2             #>  [9] ggplot2_3.4.2               SingleCellExperiment_1.22.0 #> [11] SummarizedExperiment_1.30.2 Biobase_2.60.0              #> [13] GenomicRanges_1.52.0        GenomeInfoDb_1.36.1         #> [15] IRanges_2.34.1              S4Vectors_0.38.1            #> [17] BiocGenerics_0.46.0         MatrixGenerics_1.12.2       #> [19] matrixStats_1.0.0           SeuratObject_4.1.3          #> [21] Seurat_4.2.0                ClusterDE_0.99.0            #> [23] BiocStyle_2.28.0            #>  #> loaded via a namespace (and not attached): #>   [1] RcppAnnoy_0.0.20        splines_4.3.0           later_1.3.1             #>   [4] bitops_1.0-7            tibble_3.2.1            polyclip_1.10-4         #>   [7] gamlss.data_6.0-2       rpart_4.1.19            lifecycle_1.0.3         #>  [10] pbmcapply_1.5.1         rprojroot_2.0.3         globals_0.16.2          #>  [13] lattice_0.21-8          MASS_7.3-60             backports_1.4.1         #>  [16] magrittr_2.0.3          limma_3.56.2            Hmisc_5.1-0             #>  [19] plotly_4.10.2           sass_0.4.6              rmarkdown_2.22          #>  [22] jquerylib_0.1.4         yaml_2.3.7              httpuv_1.6.11           #>  [25] sctransform_0.3.5       spatstat.core_2.4-4     sp_1.6-1                #>  [28] spatstat.sparse_3.0-1   reticulate_1.30         rgeos_0.6-3             #>  [31] cowplot_1.1.1           pbapply_1.7-0           DBI_1.1.3               #>  [34] RColorBrewer_1.1-3      abind_1.4-5             zlibbioc_1.46.0         #>  [37] Rtsne_0.16              purrr_1.0.1             RCurl_1.98-1.12         #>  [40] nnet_7.3-19             rappdirs_0.3.3          GenomeInfoDbData_1.2.10 #>  [43] ggrepel_0.9.3           irlba_2.3.5.1           listenv_0.9.0           #>  [46] spatstat.utils_3.0-3    goftest_1.2-3           spatstat.random_3.1-5   #>  [49] fitdistrplus_1.1-11     parallelly_1.36.0       pkgdown_2.0.7           #>  [52] leiden_0.4.3            codetools_0.2-19        DelayedArray_0.26.6     #>  [55] tidyselect_1.2.0        farver_2.1.1            base64enc_0.1-3         #>  [58] jsonlite_1.8.7          ellipsis_0.3.2          progressr_0.13.0        #>  [61] Formula_1.2-5           ggridges_0.5.4          survival_3.5-5          #>  [64] systemfonts_1.0.4       tools_4.3.0             ragg_1.2.5              #>  [67] ica_1.0-3               Rcpp_1.0.10             glue_1.6.2              #>  [70] gridExtra_2.3           xfun_0.39               mgcv_1.8-42             #>  [73] scDesign3_0.99.5        dplyr_1.1.2             withr_2.5.0             #>  [76] BiocManager_1.30.21     fastmap_1.1.1           fansi_1.0.4             #>  [79] digest_0.6.31           gamlss_5.4-12           R6_2.5.1                #>  [82] mime_0.12               textshaping_0.3.6       colorspace_2.1-0        #>  [85] scattermore_1.2         tensor_1.5              spatstat.data_3.0-1     #>  [88] utf8_1.2.3              tidyr_1.3.0             generics_0.1.3          #>  [91] data.table_1.14.8       httr_1.4.6              htmlwidgets_1.6.2       #>  [94] S4Arrays_1.0.4          uwot_0.1.14             pkgconfig_2.0.3         #>  [97] gtable_0.3.3            lmtest_0.9-40           XVector_0.40.0          #> [100] htmltools_0.5.5         bookdown_0.34           scales_1.2.1            #> [103] png_0.1-8               knitr_1.43              rstudioapi_0.14         #> [106] reshape2_1.4.4          checkmate_2.2.0         nlme_3.1-162            #> [109] cachem_1.0.8            zoo_1.8-12              stringr_1.5.0           #> [112] KernSmooth_2.23-20      parallel_4.3.0          miniUI_0.1.1.1          #> [115] foreign_0.8-84          desc_1.4.2              pillar_1.9.0            #> [118] grid_4.3.0              vctrs_0.6.3             RANN_2.6.1              #> [121] promises_1.2.0.1        xtable_1.8-4            cluster_2.1.4           #> [124] htmlTable_2.4.1         gamlss.dist_6.0-5       evaluate_0.21           #> [127] mvtnorm_1.2-2           cli_3.6.1               compiler_4.3.0          #> [130] rlang_1.1.1             crayon_1.5.2            future.apply_1.11.0     #> [133] labeling_0.4.2          mclust_6.0.0            plyr_1.8.8              #> [136] fs_1.6.2                stringi_1.7.12          viridisLite_0.4.2       #> [139] deldir_1.0-9            munsell_0.5.0           lazyeval_0.2.2          #> [142] spatstat.geom_3.2-1     future_1.32.0           shiny_1.7.4             #> [145] highr_0.10              ROCR_1.0-11             igraph_1.5.0            #> [148] memoise_2.0.1           bslib_0.5.0             ape_5.7-1"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-cellline.html","id":"download-data","dir":"Articles","previous_headings":"","what":"Download data","title":"Perform ClusterDE on a cell line dataset","text":"download cell line data set H2228. original data Tian et al., Nature Methods 2019. Since data pure cell line, cell types, , course, cell type DE genes.","code":"sce <- readRDS(url(\"https://figshare.com/ndownloader/files/41395260\")) cellline <- Seurat::as.Seurat(sce) #> Warning: Keys should be one or more alphanumeric characters followed by an #> underscore, setting key from PC to PC_ #> Warning: All keys should be one or more alphanumeric characters followed by an #> underscore '_', setting key to PC_"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-cellline.html","id":"run-the-regular-seurat-pipeline","dir":"Articles","previous_headings":"","what":"Run the regular Seurat pipeline","title":"Perform ClusterDE on a cell line dataset","text":"perform default Seurat clustering. Please note ClusterDE designed 1 vs 1 comparison; therefore, set resolution 0.2 obtain two clusters illustration purpose. UMAP, two clusters seem dubious. Although expect existence cell types, perform Seurat DE test two clusters, get > 1000 genes FDR < 0.05. means double dipping introduces huge number discoveries.","code":"RNGkind(\"L'Ecuyer-CMRG\") set.seed(123) cellline <- NormalizeData(object = cellline) cellline <- FindVariableFeatures(object = cellline) cellline <- ScaleData(object = cellline) #> Centering and scaling data matrix cellline <- RunPCA(object = cellline) #> PC_ 1  #> Positive:  RPS14, RPL18AP3, RPL36, RPS23, RPL28, LRRC75A-AS1, AC079250.1, FTH1, ZFAS1, EEF2  #>     RPL7P9, RPL13A, RPS3AP26, EEF1A1P13, RPS16, RPS23P8, RPL13AP5, RPL29, FTH1P10, RPL13AP25  #>     SNHG5, FTH1P8, RPL4, RPS3AP6, AC064799.1, C6orf48, FTH1P7, C1orf56, RPL7AP6, TMSB4X  #> Negative:  PSMB2, PSMA7, U2AF1, NUDC, RBM8A, CALM1, BUB3, CLIC1, U2AF1L5, XRCC5  #>     VPS29, RBM8B, CACYBP, RPA3, SSBP1, PSMC5, MRPL47, PSMD8, BRIX1, CNIH4  #>     PCMT1, PSMD13, CYC1, PRDX2, SEPT7, S100A11, VDAC3, PSME2P2, ZWINT, HMGB1  #> PC_ 2  #> Positive:  NACA, RPL7AP6, SKP1, UBA52, BTF3, SSR2, RPL7A, ARPC3, RPL9P9, PPIA  #>     PSMD4, EIF1, RPL10, LGALS3BP, RPL10P16, SNRPB2, RPL10P9, S100A11, PPIB, ANXA5  #>     EEF2, PSME1, SSBP1, SSR4, RPL7P9, COPE, BSG, MGST1, VPS28, COPS6  #> Negative:  SIVA1, HNRNPAB, RPL39L, DEK, CDCA5, TMPO, FAM111A, ASF1B, CENPK, ESCO2  #>     BRCA1, H2AFV, RAD51AP1, MT-RNR2, ORC6, CENPX, SNRNP25, FBXO5, RRM1, DIAPH3  #>     USP1, CDCA4, TMEM106C, PGP, LSM4, C21orf58, CENPN, BRI3BP, SGO1, CHAF1A  #> PC_ 3  #> Positive:  RPL13AP5, RPL13AP25, AC024293.1, RPL29, RPSAP19, RPS5, RPL18, RPS3AP26, RPS3AP6, RPL15  #>     RPL28, DRAP1, RPS11, RPL9P9, RPL13AP7, RPS19, DCBLD2, FXYD5, FEN1, SLBP  #>     RPS15, COTL1, RPSA, FLNA, RPL7AP6, RPL36, C1orf21, CPA4, ORC6, RPS16  #> Negative:  SMIM22, TSPAN13, ST14, PERP, CRB3, MT-CO1, SERINC2, ATP1B1, CDH1, F11R  #>     B2M, MT-RNR2, SPINT1, NMB, PLA2G16, SPDEF, CD55, ADGRF1, TSPAN1, LIMA1  #>     ERBB3, ERO1A, ASS1, CDA, ALCAM, SYNGR2, MT-CO2, CDH3, C3, LSR  #> PC_ 4  #> Positive:  IFNGR1, NAMPT, NAP1L1, CPD, LMAN1, CALR, ITGA2, NAMPTP1, ITM2B, RRM1  #>     C3, RHOBTB3, CTHRC1, EEF2, HSD17B11, C1S, IFI16, SMC2, CPE, EPHX1  #>     DST, HLA-DMB, NUCB2, MT-ND6, TMEM45A, BRCA1, CDK5RAP2, HINT1, C1R, FAM111A  #> Negative:  S100A16, TMA7, TIMM8B, PFN1, SLIRP, GPX1, LAMC2, POLR2L, MRPL52, RPS19  #>     CDH1, TOMM40, ATP5MD, HSPE1, NAA10, GPX1P1, RPS16, MRPL12, MCRIP2, PDCD5  #>     RPL18, PLEC, S100A13, RPL36AL, LAD1, MGLL, BOLA2B, MISP, MRPL36, SEC61G  #> PC_ 5  #> Positive:  BTG1, PPP1R15A, EIF1, JUN, CEBPG, H3F3B, TMEM132A, C6orf48, HIST2H4B, SGK1  #>     KPNA4, PMEPA1, KLF6, CDKN1A, WARS, PEA15, GARS, MAP1LC3B, SNHG12, SERTAD1  #>     LAMC2, EPB41L4A-AS1, NAP1L1, SNHG5, KLF10, SLC7A5, KIF5B, ATP2B1, EIF5, ABL2  #> Negative:  HINT1, COX5B, TXN, SOD1, NDUFA4, NDUFS6, ATP5PO, ATP5MC3, S100A10, ATP6V0E1  #>     CYB5A, SLIRP, NDUFB4, ATP5MC1, HSPE1, TXNP6, POMP, POLR2L, RPS14, HSPE1P4  #>     RPS15, CBR1, NDUFB3, HSPE1P3, ATP5PD, COX7B, ADGRF1, PSMB9, AC079250.1, NDUFAB1 #> Warning: Cannot add objects with duplicate keys (offending key: PC_), setting #> key to 'pca_' cellline <- FindNeighbors(object = cellline) #> Computing nearest neighbor graph #> Computing SNN cellline <- FindClusters(object = cellline, resolution = 0.2) #> Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck #>  #> Number of nodes: 758 #> Number of edges: 24895 #>  #> Running Louvain algorithm... #> Maximum modularity in 10 random starts: 0.8257 #> Number of communities: 2 #> Elapsed time: 0 seconds cellline <- RunUMAP(object = cellline, dims = 1:10) #> Warning: The default method for RunUMAP has changed from calling Python UMAP via reticulate to the R-native UWOT using the cosine metric #> To use Python UMAP via reticulate, set umap.method to 'umap-learn' and metric to 'correlation' #> This message will be shown once per session #> 12:01:57 UMAP embedding parameters a = 0.9922 b = 1.112 #> 12:01:57 Read 758 rows and found 10 numeric columns #> 12:01:57 Using Annoy for neighbor search, n_neighbors = 30 #> 12:01:57 Building Annoy index with metric = cosine, n_trees = 50 #> 0%   10   20   30   40   50   60   70   80   90   100% #> [----|----|----|----|----|----|----|----|----|----| #> **************************************************| #> 12:01:57 Writing NN index file to temp file /tmp/Rtmp11Drhc/file2a662e6a663007 #> 12:01:57 Searching Annoy index using 1 thread, search_k = 3000 #> 12:01:57 Annoy recall = 100% #> 12:01:58 Commencing smooth kNN distance calibration using 1 thread with target n_neighbors = 30 #> 12:01:59 Initializing from normalized Laplacian + noise (using irlba) #> 12:01:59 Commencing optimization for 500 epochs, with 27914 positive edges #> 12:02:00 Optimization finished #> Warning: Cannot add objects with duplicate keys (offending key: UMAP_), setting #> key to 'umap_' DimPlot(object = cellline, reduction = \"umap\") + ggtitle(\"Clustering result\") original_markers <- FindMarkers(cellline,                                  ident.1 = 0,                                  ident.2 = 1,                                  min.pct = 0,                                  logfc.threshold = 0) print(sum(original_markers$p_val_adj < 0.05)) #> [1] 1023"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-cellline.html","id":"generate-synthetic-null-data","dir":"Articles","previous_headings":"","what":"Generate synthetic null data","title":"Perform ClusterDE on a cell line dataset","text":"first generate synthetic null data based target data (real data). can increase number cores speed . perform pipeline target data. Please note need two clusters , . straightforward clustering method predefined cluster numbers, e.g., K-means. louvain clustering used Seurat may manually adjust resolution parameter still get two clusters. perform DE test synthetic null data. extract p-values original data synthetic null data, use ClusterDE “compare” . discover DE genes. can also visualize distribution contrast scores (diff -log p-values real null). roughly symmetric around 0.","code":"count_mat <- GetAssayData(object = cellline, slot = \"counts\") set.seed(123) synthetic_null <- ClusterDE::constructNull(count_mat, nCores = 2) #> Input Data Construction Start #> Input Data Construction End #> Start Marginal Fitting #> Marginal Fitting End #> Start Copula Fitting #> Convert Residuals to Multivariate Gaussian #> Converting End #> Copula group 1 starts #> Copula Fitting End #> Start Parameter Extraction #> Parameter #> Extraction End #> Start Generate New Data #> Use Copula to sample a multivariate quantile matrix #> Sample Copula group 1 starts #> New Data Generating End cellline_null <- CreateSeuratObject(counts = synthetic_null)  set.seed(123) cellline_null <- NormalizeData(object = cellline_null) cellline_null <- FindVariableFeatures(object = cellline_null) cellline_null <- ScaleData(object = cellline_null) #> Centering and scaling data matrix cellline_null <- RunPCA(object = cellline_null) #> PC_ 1  #> Positive:  LRRC75A-AS1, RPL28, ZFAS1, RPL13A, EEF2, RPL29, AC116533.1, RPL13AP5, RPS3AP6, RPS16  #>     RPL13AP25, RPL10, RPL7AP6, SNHG5, FTH1, RPL10P16, RPS11, AHNAK2, C6orf48, RPS6  #>     RPL9P9, PNRC1, CEBPD, NOP53, BIRC3, RPL10P9, AC064799.1, RPL4, FTH1P10, EPB41L4A-AS1  #> Negative:  PSMB2, PSMA7, CALM1, VPS29, NUCKS1, U2AF1L5, U2AF1, XRCC5, NUDC, HMGB1  #>     CLIC1, RBM8A, CACYBP, CNIH4, RPA3, ATP5PD, ATP5MC3, BUB3, SSBP1, SKP1  #>     PSMC5, RBM8B, CHCHD2, ATP5PO, NDUFAB1, SLIRP, S100A11, CYC1, TAGLN2, EIF5  #> PC_ 2  #> Positive:  SIVA1, HNRNPAB, DEK, RPL39L, CENPX, ZDHHC12, TMPO, H2AFV, BRCA1, TMEM106C  #>     MT-ND4, CMC2, RRM1, TEX30, CENPK, USP1, LSM4, PGP, WDR34, CKLF  #>     DTYMK, MT-CO2, ATAD5, RANBP1, FAM111A, ASPH, CDCA4, CHCHD2, MIS18BP1, SVIP  #> Negative:  NACA, RPL10, RPL7AP6, RPL10P16, RPL10P9, SSR2, BTF3, RPL9P9, EEF2, PSMD4  #>     SKP1, EIF1, LGALS3BP, ARPC3, PPIA, PPA1, VPS28, SSBP1, PPIB, RPS11  #>     DECR1, SNRPB2, ANXA5, RPL18, RSL1D1, MGST1, RPL14, RPL15, CTSD, ZFAS1  #> PC_ 3  #> Positive:  RPL13AP25, RPL14, RPL13AP5, RPL29, RPL18, AC116533.1, RPL15, RPSAP19, RPS5, RPS11  #>     RPS3AP6, RPSA, FLNA, COTL1, SLBP, DRAP1, MSN, RPS16, RPL28, RHOA  #>     C19orf48, TMA7, CFL1, RPL9P9, DCBLD2, PFN1, PEBP1, SRSF2, PDCD5, SNRPD2  #> Negative:  MT-CO1, MTCO1P12, TSPAN13, SMIM22, PERP, ADGRF1, ATP1B1, B2M, C3, NMB  #>     GOLGB1, CPD, SQSTM1, TMED10, SPINT1, ASS1, CD55, MMP15, SERINC2, MT-CYB  #>     PPIC, ST14, CCDC186, SDC4, LMO7, C5orf15, GFPT1, CASP4, LGMN, PLA2G16  #> PC_ 4  #> Positive:  NAP1L1, RRM1, ITGA2, CDC5L, APLP2, CDK5RAP2, IFNGR1, TARS, USP1, GARS  #>     IFI16, SMC3, TMEM97, EZH2, BTG1, MT-ND6, DEK, EIF1, C6orf48, ATF4  #>     PDIA3P1, DNAJC9, GGH, CEBPG, MTHFD2, FAT1, NIFK, C1R, PSAP, C1S  #> Negative:  ATP5MC3, SLIRP, COX5B, NDUFS6, POLR2L, HSPE1, PFN1, COX7B, NDUFB3, HSPE1P3  #>     COX4I1, HSPE1P4, UQCRQ, S100A10, SEC61G, RPS15, SNRPF, NDUFB9, AURKAIP1, S100A16  #>     MCRIP2, RPL36AL, NDUFB10, MRPL36, MRPL41, GADD45GIP1, TRMT112, S100A13, RHOC, POMP  #> PC_ 5  #> Positive:  H3F3B, S100A16, SNHG15, LAMB3, RPL36AL, EIF6, BTG1, EIF5, HSPA9, RPS16  #>     RPL18, KPNA4, RPL15, MGLL, KIF5B, GSPT1, PFDN2, KLF6, JUN, SNRPG  #>     TOMM40, TCEA1, MYEOV, RNF145, LRIF1, SNHG7, EIF1, DDX21, NELFE, CEBPG  #> Negative:  NDUFA4, ATP6V0E1, HINT1, CARHSP1, IFNGR1, SOD1, TXN, CTHRC1, NAMPT, CPD  #>     H3F3AP4, ADGRF1, FTH1P8, ASPH, CASP4, H3F3AP6, CBR1, ITM2B, RHOBTB3, P4HB  #>     GCHFR, DBI, UQCRQ, MYL6, NPC2, TMEM205, H3F3A, NDUFS5, PPIA, TXNP6 cellline_null <- FindNeighbors(object = cellline_null) #> Computing nearest neighbor graph #> Computing SNN cellline_null <- FindClusters(object = cellline_null, resolution = 0.3) #> Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck #>  #> Number of nodes: 758 #> Number of edges: 30193 #>  #> Running Louvain algorithm... #> Maximum modularity in 10 random starts: 0.7090 #> Number of communities: 2 #> Elapsed time: 0 seconds cellline_null <- RunUMAP(object = cellline_null, dims = 1:10) #> 12:09:53 UMAP embedding parameters a = 0.9922 b = 1.112 #> 12:09:53 Read 758 rows and found 10 numeric columns #> 12:09:53 Using Annoy for neighbor search, n_neighbors = 30 #> 12:09:53 Building Annoy index with metric = cosine, n_trees = 50 #> 0%   10   20   30   40   50   60   70   80   90   100% #> [----|----|----|----|----|----|----|----|----|----| #> **************************************************| #> 12:09:53 Writing NN index file to temp file /tmp/Rtmp11Drhc/file2a662e39cd7b33 #> 12:09:53 Searching Annoy index using 1 thread, search_k = 3000 #> 12:09:54 Annoy recall = 100% #> 12:09:56 Commencing smooth kNN distance calibration using 1 thread with target n_neighbors = 30 #> 12:09:57 Initializing from normalized Laplacian + noise (using irlba) #> 12:09:57 Commencing optimization for 500 epochs, with 27652 positive edges #> 12:09:58 Optimization finished DimPlot(object = cellline_null, reduction = \"umap\") null_markers <- FindMarkers(cellline_null,                              ident.1 = 0,                              ident.2 = 1,                              min.pct = 0,                              logfc.threshold = 0) original_pval <- original_markers$p_val names(original_pval) <- rownames(original_markers)  null_pval <- null_markers$p_val names(null_pval) <- rownames(null_markers)  res <- ClusterDE::callDE(original_pval, null_pval, nlogTrans = TRUE) res$DEgenes #> character(0) ggplot(data = res$summaryTable, aes(x = cs)) + geom_histogram(fill = \"white\", color = \"black\") + theme_bw() + ggtitle(\"Distribution of constrast scores\") #> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`."},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-cellline.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Perform ClusterDE on a cell line dataset","text":"","code":"sessionInfo() #> R version 4.3.0 (2023-04-21) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Ubuntu 20.04.6 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3;  LAPACK version 3.9.0 #>  #> Random number generation: #>  RNG:     L'Ecuyer-CMRG  #>  Normal:  Inversion  #>  Sample:  Rejection  #>   #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Los_Angeles #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] ggplot2_3.4.2               SingleCellExperiment_1.22.0 #>  [3] SummarizedExperiment_1.30.2 Biobase_2.60.0              #>  [5] GenomicRanges_1.52.0        GenomeInfoDb_1.36.1         #>  [7] IRanges_2.34.1              S4Vectors_0.38.1            #>  [9] BiocGenerics_0.46.0         MatrixGenerics_1.12.2       #> [11] matrixStats_1.0.0           SeuratObject_4.1.3          #> [13] Seurat_4.2.0                ClusterDE_0.99.0            #> [15] BiocStyle_2.28.0            #>  #> loaded via a namespace (and not attached): #>   [1] RcppAnnoy_0.0.20        splines_4.3.0           later_1.3.1             #>   [4] bitops_1.0-7            tibble_3.2.1            polyclip_1.10-4         #>   [7] gamlss.data_6.0-2       rpart_4.1.19            lifecycle_1.0.3         #>  [10] pbmcapply_1.5.1         rprojroot_2.0.3         globals_0.16.2          #>  [13] lattice_0.21-8          MASS_7.3-60             backports_1.4.1         #>  [16] magrittr_2.0.3          limma_3.56.2            Hmisc_5.1-0             #>  [19] plotly_4.10.2           sass_0.4.6              rmarkdown_2.22          #>  [22] jquerylib_0.1.4         yaml_2.3.7              httpuv_1.6.11           #>  [25] sctransform_0.3.5       spatstat.core_2.4-4     sp_1.6-1                #>  [28] spatstat.sparse_3.0-1   reticulate_1.30         rgeos_0.6-3             #>  [31] cowplot_1.1.1           pbapply_1.7-0           DBI_1.1.3               #>  [34] RColorBrewer_1.1-3      abind_1.4-5             zlibbioc_1.46.0         #>  [37] Rtsne_0.16              purrr_1.0.1             RCurl_1.98-1.12         #>  [40] nnet_7.3-19             GenomeInfoDbData_1.2.10 ggrepel_0.9.3           #>  [43] irlba_2.3.5.1           listenv_0.9.0           spatstat.utils_3.0-3    #>  [46] goftest_1.2-3           spatstat.random_3.1-5   fitdistrplus_1.1-11     #>  [49] parallelly_1.36.0       pkgdown_2.0.7           leiden_0.4.3            #>  [52] codetools_0.2-19        DelayedArray_0.26.6     tidyselect_1.2.0        #>  [55] farver_2.1.1            base64enc_0.1-3         jsonlite_1.8.7          #>  [58] ellipsis_0.3.2          progressr_0.13.0        Formula_1.2-5           #>  [61] ggridges_0.5.4          survival_3.5-5          systemfonts_1.0.4       #>  [64] tools_4.3.0             ragg_1.2.5              ica_1.0-3               #>  [67] Rcpp_1.0.10             glue_1.6.2              gridExtra_2.3           #>  [70] xfun_0.39               mgcv_1.8-42             scDesign3_0.99.5        #>  [73] dplyr_1.1.2             withr_2.5.0             BiocManager_1.30.21     #>  [76] fastmap_1.1.1           fansi_1.0.4             digest_0.6.31           #>  [79] gamlss_5.4-12           R6_2.5.1                mime_0.12               #>  [82] textshaping_0.3.6       colorspace_2.1-0        scattermore_1.2         #>  [85] tensor_1.5              spatstat.data_3.0-1     utf8_1.2.3              #>  [88] tidyr_1.3.0             generics_0.1.3          data.table_1.14.8       #>  [91] httr_1.4.6              htmlwidgets_1.6.2       S4Arrays_1.0.4          #>  [94] uwot_0.1.14             pkgconfig_2.0.3         gtable_0.3.3            #>  [97] lmtest_0.9-40           XVector_0.40.0          htmltools_0.5.5         #> [100] bookdown_0.34           scales_1.2.1            png_0.1-8               #> [103] knitr_1.43              rstudioapi_0.14         reshape2_1.4.4          #> [106] checkmate_2.2.0         nlme_3.1-162            cachem_1.0.8            #> [109] zoo_1.8-12              stringr_1.5.0           KernSmooth_2.23-20      #> [112] parallel_4.3.0          miniUI_0.1.1.1          foreign_0.8-84          #> [115] desc_1.4.2              pillar_1.9.0            grid_4.3.0              #> [118] vctrs_0.6.3             RANN_2.6.1              promises_1.2.0.1        #> [121] xtable_1.8-4            cluster_2.1.4           htmlTable_2.4.1         #> [124] gamlss.dist_6.0-5       evaluate_0.21           mvtnorm_1.2-2           #> [127] cli_3.6.1               compiler_4.3.0          rlang_1.1.1             #> [130] crayon_1.5.2            future.apply_1.11.0     labeling_0.4.2          #> [133] mclust_6.0.0            plyr_1.8.8              fs_1.6.2                #> [136] stringi_1.7.12          viridisLite_0.4.2       deldir_1.0-9            #> [139] munsell_0.5.0           lazyeval_0.2.2          spatstat.geom_3.2-1     #> [142] Matrix_1.5-4.1          patchwork_1.1.2         future_1.32.0           #> [145] shiny_1.7.4             highr_0.10              ROCR_1.0-11             #> [148] igraph_1.5.0            memoise_2.0.1           bslib_0.5.0"},{"path":"https://songdongyuan1994.github.io/ClusterDE/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Dongyuan Song. Author, maintainer. Kexin Li. Author.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Song D, Li K (2023). ClusterDE: Post-clustering Differential Expression (DE) Method Solving Double Dipping. https://github.com/SONGDONGYUAN1994/ClusterDE, https://songdongyuan1994.github.io/ClusterDE/.","code":"@Manual{,   title = {ClusterDE: A Post-clustering Differential Expression (DE) Method For Solving Double Dipping},   author = {Dongyuan Song and Kexin Li},   year = {2023},   note = {https://github.com/SONGDONGYUAN1994/ClusterDE, https://songdongyuan1994.github.io/ClusterDE/}, }"},{"path":"https://songdongyuan1994.github.io/ClusterDE/index.html","id":"clusterde","dir":"","previous_headings":"","what":"ClusterDE","title":"A Post-clustering Differential Expression (DE) Method For Solving Double Dipping","text":"R package ClusterDE post-clustering DE method controlling false discovery rate (FDR) identified DE genes regardless clustering quality. core idea ClusterDE generate real-data-based synthetic null data one cluster, counterfactual contrast real data, evaluating whole procedure clustering followed DE test.  Detailed tutorials illustrate various functionalities ClusterDE available website. following illustration figure summarizes usage ClusterDE:  find details ClusterDE, can check manuscript bioRxiv.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"A Post-clustering Differential Expression (DE) Method For Solving Double Dipping","text":"install development version GitHub, please run: Please note ClusterDE actually wrapper ClusterDE. Therefore, can also directly use scDesign3 generate synthetic null data. better understand scDesign3, can check manuscript Nature Biotechnology: Song, D., Wang, Q., Yan, G. et al. scDesign3 generates realistic silico data multimodal single-cell spatial omics. Nat Biotechnol (2023).","code":"if (!require(\"devtools\", quietly = TRUE))     install.packages(\"devtools\") devtools::install_github(\"SONGDONGYUAN1994/scDesign3\") devtools::install_github(\"SONGDONGYUAN1994/ClusterDE\")"},{"path":"https://songdongyuan1994.github.io/ClusterDE/index.html","id":"quick-start","dir":"","previous_headings":"","what":"Quick Start","title":"A Post-clustering Differential Expression (DE) Method For Solving Double Dipping","text":"following code quick example generate synthetic null data. input data gene cell matrix containing two clusters want compare. input matrix count data, nb (Negative Binomial) usually appropriate choice. log-transformed data, please try gaussian. parameters constructNull() : mat: input gene cell matrix. can sparse matrix. family: string distribution want use fitting model. Must one ‘poisson’, ‘nb’, ‘zip’, ‘zinb’ ‘gaussian’. nCores: integer. number cores use. Increasing cores greatly speed computaion. parallelization: string indicating specific parallelization function use. Must one ‘mcmapply’, ‘bpmapply’, ‘pbmcmapply’, corresponds parallelization function package ‘parallel’, ‘BiocParallel’, ‘pbmcapply’ respectively. default value ‘pbmcmapply’. BPPARAM: MulticoreParam object NULL. parameter parallelization = ‘mcmapply’ ‘pbmcmapply’, parameter must NULL. parameter parallelization = ‘bpmapply’, parameter must one MulticoreParam object offered package ‘BiocParallel’. default value NULL. output constructNull() new gene cell matrix format input. obtaining synthetic null data, perform clustering procedure done real data get DE p-values (nullPvalues). Finally, compare p-values null p-values target data (real data) callDE(). illustration, use Uniform random numbers p-values. parameters callDE : targetScores: named numeric vector DE scores target data, e.g., p-values two clusters real data. nullScores: named numeric vector DE scores synthetic null data, e.g., p-values two clusters null data. nlogTrans: logical value. input scores p-values, take -log10 transformation since Clipper require larger scores represent significant DE. Default TRUE. FDR: numeric value target False Discovery Rate (FDR). Default 0.05. correct: logical value. TRUE, perform correction make distribution contrast scores approximately symmetric. Default FALSE. output callDE list target FDR, DE genes, detailed summary table.","code":"data(exampleCounts) nullData <- constructNull(mat = exampleCounts,                           family = \"nb\",                           nCores = 1,                           parallelization = \"pbmcmapply\",                           BPPARAM = NULL) set.seed(123) targetPvalues <- runif(10000) nullPvalues <- runif(10000) names(targetPvalues) <- names(nullPvalues) <- paste0(\"Gene\", 1:10000) res <- callDE(targetScores = targetPvalues,               nullScores = nullPvalues,               nlogTrans = TRUE,               FDR = 0.05,               correct = FALSE)"},{"path":"https://songdongyuan1994.github.io/ClusterDE/index.html","id":"tutorials","dir":"","previous_headings":"","what":"Tutorials","title":"A Post-clustering Differential Expression (DE) Method For Solving Double Dipping","text":"detailed tutorials, please check website. tutorials demonstrate applications ClusterDE two cases: cell line dataset (cell type exists) PBMC dataset. Perform ClusterDE cell line dataset Perform ClusterDE PBMC dataset","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/index.html","id":"contact","dir":"","previous_headings":"","what":"Contact","title":"A Post-clustering Differential Expression (DE) Method For Solving Double Dipping","text":"questions suggestions ClusterDE welcomed! Please report issues, contact Dongyuan Song (dongyuansong@ucla.edu).","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/index.html","id":"related-manuscripts","dir":"","previous_headings":"","what":"Related Manuscripts","title":"A Post-clustering Differential Expression (DE) Method For Solving Double Dipping","text":"scDesign3: Song, D., Wang, Q., Yan, G. et al. scDesign3 generates realistic silico data multimodal single-cell spatial omics. Nat Biotechnol (2023). Clipper: Ge, X., Chen, Y.E., Song, D. et al. Clipper: p-value-free FDR control high-throughput data two conditions. Genome Biology 22, 288 (2021).","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/callDE.html","id":null,"dir":"Reference","previous_headings":"","what":"Call differentially expressed (DE) genes by Clipper algorithm — callDE","title":"Call differentially expressed (DE) genes by Clipper algorithm — callDE","text":"callDE takes two vectors representing gene's significance. usually p-values target data synthetic null data.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/callDE.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Call differentially expressed (DE) genes by Clipper algorithm — callDE","text":"","code":"callDE(targetScores, nullScores, nlogTrans = TRUE, FDR = 0.05, correct = FALSE)"},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/callDE.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Call differentially expressed (DE) genes by Clipper algorithm — callDE","text":"targetScores named numeric vector DE scores target data, e.g., p-values two clusters real data. nullScores named numeric vector DE scores synthetic null data, e.g., p-values two clusters null data. nlogTrans logical value. input scores p-values, take -log10 transformation since Clipper require larger scores represent significant DE. Default TRUE. FDR numeric value target False Discovery Rate (FDR). Default 0.05. correct logical value. TRUE, perform correction make distribution contrast scores approximately symmetric. Default FALSE.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/callDE.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Call differentially expressed (DE) genes by Clipper algorithm — callDE","text":"function constructs contrast scores taking difference target DE scores null DE scores.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/callDE.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Call differentially expressed (DE) genes by Clipper algorithm — callDE","text":"","code":"targetScores <- runif(10000) nullScores <- runif(10000) names(targetScores) <- names(nullScores) <- paste0(\"Gene\", 1:10000) res <- callDE(targetScores, nullScores, correct = FALSE)"},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/constructNull.html","id":null,"dir":"Reference","previous_headings":"","what":"Construct the synthetic null data — constructNull","title":"Construct the synthetic null data — constructNull","text":"constructNull takes target data input returns corresponding synthetic null data.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/constructNull.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Construct the synthetic null data — constructNull","text":"","code":"constructNull(   mat,   family = \"nb\",   nCores = 1,   parallelization = \"pbmcmapply\",   BPPARAM = NULL )"},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/constructNull.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Construct the synthetic null data — constructNull","text":"mat expression matrix (gene cell). can regular matrix sparseMatrix. family string vector strings distribution data. Must one 'nb', 'binomial', 'poisson', 'zip', 'zinb' 'gaussian', represent 'poisson distribution', 'negative binomial distribution', 'zero-inflated poisson distribution', 'zero-inflated negative binomail distribution', 'gaussian distribution' respectively. UMI-counts data, usually use 'nb'. Default 'nb'. nCores integer. number cores use Parallel processing. parallelization string indicating specific parallelization function use. Must one 'mcmapply', 'bpmapply', 'pbmcmapply', corresponds parallelization function package parallel,BiocParallel, pbmcapply respectively. default value 'pbmcmapply'. BPPARAM MulticoreParam object NULL. parameter parallelization = 'mcmapply' 'pbmcmapply', parameter must NULL. parameter parallelization = 'bpmapply',  parameter must one MulticoreParam object offered package 'BiocParallel. default value NULL.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/constructNull.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Construct the synthetic null data — constructNull","text":"expression matrix synthetic null data.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/constructNull.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Construct the synthetic null data — constructNull","text":"function constructs synthetic null data based target data (real data). input expression matrix (gene cell); user specify distribution, usually Negative Binomial count matrix.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/constructNull.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Construct the synthetic null data — constructNull","text":"","code":"data(exampleCounts) nullData <- constructNull(mat = exampleCounts) #> Input Data Construction Start #> Input Data Construction End #> Start Marginal Fitting #> Marginal Fitting End #> Start Copula Fitting #> Convert Residuals to Multivariate Gaussian #> Converting End #> Copula group 1 starts #> Copula Fitting End #> Start Parameter Extraction #> Parameter #> Extraction End #> Start Generate New Data #> Use Copula to sample a multivariate quantile matrix #> Sample Copula group 1 starts #> New Data Generating End"},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/exampleCounts.html","id":null,"dir":"Reference","previous_headings":"","what":"A count matrix of 100 genes from the A549 cell line from Tian et al., Nature Methods, 2019. — exampleCounts","title":"A count matrix of 100 genes from the A549 cell line from Tian et al., Nature Methods, 2019. — exampleCounts","text":"count matrix 100 genes A549 cell line Tian et al., Nature Methods, 2019.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/exampleCounts.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"A count matrix of 100 genes from the A549 cell line from Tian et al., Nature Methods, 2019. — exampleCounts","text":"","code":"data(\"exampleCounts\")"},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/exampleCounts.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"A count matrix of 100 genes from the A549 cell line from Tian et al., Nature Methods, 2019. — exampleCounts","text":"dataset 100 rows (genes) 1256 cols (cells)","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/exampleCounts.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"A count matrix of 100 genes from the A549 cell line from Tian et al., Nature Methods, 2019. — exampleCounts","text":"corresponding count matrix object","code":""}]
